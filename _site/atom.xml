<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
 
 <title>æ³®</title>
 <link href="/atom.xml" rel="self"/>
 <link href=""/>
 <updated>2019-09-19T09:40:03+08:00</updated>
 <id>/</id>
 <author>
   <name></name>
 </author>

 
 <entry>
   <title>Jekyllåšå®¢éƒ¨ç½²è¿ç§»åˆ°Linuxï¼ˆCentos7ï¼‰ä¸”æ”¯æŒhttpsæ•™ç¨‹</title>
   <link href="/2019/09/15/jekyll-deploy-linux-with-https.html"/>
   <updated>2019-09-15T00:00:00+08:00</updated>
   <id>urn:uuid:85cd4b63-e9f0-4459-8ca7-fbdsdc2a2fad</id>
   <content type="html">&lt;p&gt;ä¹‹å‰ä¸€ç›´æŠŠåšå®¢æ‰˜ç®¡åˆ°Github pagesä¸Šï¼Œè™½ç„¶æ–¹ä¾¿ä½†æ˜¯ä¹Ÿæœ‰å‡ ä¸ªå¼Šç«¯ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;1.æœ‰æ—¶è®¿é—®é€Ÿåº¦è¿‡æ…¢&lt;/li&gt;
&lt;li&gt;2.å›½å†…çš„ä¸€äº›æœç´¢å¼•æ“æ— æ³•æ£€ç´¢åˆ°&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;åˆšå¥½è‡ªå·±æœ‰ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæ‰€ä»¥å‡†å¤‡å°†åšå®¢è¿ç§»åˆ°è‡ªå·±çš„æœåŠ¡å™¨ä¸Šï¼Œå½“ç„¶æ¨èå°†å†…å®¹åœ¨githubä¹Ÿä¿å­˜ä¸€ä»½ï¼Œä»¥é˜²ä¸‡ä¸€æ•°æ®ä¸¢å¤±ã€‚&lt;/p&gt;

&lt;p&gt;æ“ä½œå‰æï¼š&lt;/p&gt;

&lt;p&gt;1.ç”³è¯·ä¸€ä¸ªè‡ªå·±çš„æœåŠ¡å™¨å’ŒåŸŸå(å›½å†…çš„æœ‰äº›æœåŠ¡å™¨ç”¨80ç«¯å£éœ€è¦å¤‡æ¡ˆï¼Œå¦‚ä½¿ç”¨è¯·å…ˆå¤‡æ¡ˆ)
2.Jekyllåšå®¢å®‰è£…
3.æœ‰è‡ªå·±çš„github&lt;/p&gt;

&lt;h3&gt;æ­¥éª¤&lt;/h3&gt;

&lt;h4&gt;1.ç¼–è¯‘è‡ªå·±çš„åšå®¢&lt;/h4&gt;

&lt;p&gt;æ‰§è¡Œå‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-jekyll&quot; data-lang=&quot;jekyll&quot;&gt;jekyll build
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;jekyllå°†ç¼–è¯‘å®Œçš„æ–‡ä»¶æ”¾åœ¨å·¥ç¨‹çš„&lt;em&gt;_site&lt;/em&gt;ç›®å½•ä¸‹ï¼Œéƒ¨ç½²çš„æ—¶å€™å¯ä»¥å•ç‹¬ä¸Šä¼ è¿™ä¸ªæ–‡ä»¶å¤¹å°±è¡Œï¼Œä½†è¿™é‡Œæˆ‘ä»¬ä¼šå°†è‡ªå·±çš„åšå®¢å·¥ç¨‹å­˜å‚¨åœ¨githubä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å·¥ç¨‹çš„æ‰€æœ‰å†…å®¹éƒ½ä¸Šä¼ åˆ°githubä¸Šäº†ã€‚&lt;/p&gt;

&lt;h4&gt;2.ä¸Šä¼ åˆ°github&lt;/h4&gt;

&lt;p&gt;å¦‚ä½•è·Ÿå°†é¡¹ç›®è·Ÿgithubä¸Šçš„Repositoriesç»‘å®šè¯·è‡ªè¡Œå‚è€ƒgoogleã€‚&lt;/p&gt;

&lt;p&gt;æ‰§è¡Œå‘½ä»¤è¿›è¡Œä¸Šä¼ ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-git&quot; data-lang=&quot;git&quot;&gt;git add -f *
git commit -m &quot;update blog&quot;
git push
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;3.æœåŠ¡å™¨å®‰è£…gitå¹¶cloneå·¥ç¨‹é¡¹ç›®&lt;/h4&gt;

&lt;p&gt;æ‰§è¡Œå‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;yum install git

//cloneä½ è‡ªå·±çš„é¡¹ç›®

git clone https://github.com/godpan/godpan.github.io.git
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;4.å®‰è£…nginxå¹¶ä¿®æ”¹é…ç½®&lt;/h4&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;yum install nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä¿®æ”¹nginxé…ç½®&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;vi /etc/nginx/nginx.conf

//ä¿®æ”¹ä»¥ä¸‹å†…å®¹ï¼Œå…¶ä»–ä¸å˜

user root&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

server &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    listen       80 default_server&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    listen       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;::]:80 default_server&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    server_name  _&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    root         /root/godpan.github.io/_site&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#åšå®¢_siteæ–‡ä»¶ç›®å½•&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# Load configuration files for the default server block.&lt;/span&gt;
    include /etc/nginx/default.d/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;.conf&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    location / &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    error_page 404 /404.html&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        location &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /40x.html &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    error_page 500 502 503 504 /50x.html&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        location &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /50x.html &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä¿å­˜æ–‡ä»¶ï¼Œå¹¶å¯åŠ¨nginxå¹¶å¼€å¯80ç«¯å£&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;systemctl start nginx

firewall-cmd --add-port=80/tcp --permanent
firewall-cmd --reload
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ç„¶åç›´æ¥è®¿é—®ä½ æœåŠ¡å™¨çš„ipï¼Œä¸å‡ºæ„å¤–åº”è¯¥èƒ½ç›´æ¥çœ‹åˆ°ä½ è‡ªå·±åšå®¢çš„å†…å®¹äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å°†åŸŸåä¸ipç»‘å®šã€‚&lt;/p&gt;

&lt;h4&gt;5.ç»‘å®šåŸŸå&lt;/h4&gt;

&lt;p&gt;æˆ‘è¿™é‡Œæ“ä½œçš„æ˜¯é˜¿é‡Œäº‘ä¸Šçš„åŸŸåï¼Œä»…ä¾›å‚è€ƒï¼Œå…¶ä»–å¹³å°çš„è‡ªå·±æŒ‰ç…§è§„åˆ™è®¾ç½®ï¼Œé…ç½®å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/media/images/2019/09/domain-settings.png&quot; alt=&quot;domain-settings&quot;&gt;&lt;/p&gt;

&lt;p&gt;ç­‰åŸŸåç”Ÿæ•ˆï¼ˆé€šå¸¸ä¸è¶…è¿‡10åˆ†é’Ÿï¼‰å°±å¯ä»¥ç›´æ¥ç”¨åŸŸåè®¿é—®ä½ çš„åšå®¢äº†ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœä½ ä¸æƒ³ç»™ç½‘ç«™é…ç½®ä¸ºhttpsçš„è¯ï¼Œåˆ°è¿™é‡Œå°±å¤§åŠŸå‘Šæˆäº†ã€‚&lt;/p&gt;

&lt;h4&gt;6.é…ç½®https&lt;/h4&gt;

&lt;p&gt;è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨Certbotæ¥ç”Ÿæˆhttpséœ€è¦çš„è¯ä¹¦ï¼Œå…ˆå®‰è£…Certbotï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;yum install certbot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ç”Ÿæˆè¯ä¹¦ï¼š
&lt;code&gt;shell
certbot certonly --webroot -w /root/godpan.github.io/_site -d godpan.me -d www.godpan.me
&lt;/code&gt;
è¯ä¹¦ç”Ÿæˆçš„ç›®å½•åœ¨ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;/etc/letsencrypt/live/godpan.me  &lt;span class=&quot;c&quot;&gt;#åé¢ä¸ºä½ è‡ªå·±çš„åŸŸå&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä¿®æ”¹nginxå¯¹åº”çš„é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;vi /etc/nginx/nginx.conf

&lt;span class=&quot;c&quot;&gt;#ä¿®æ”¹443ç«¯å£å¯¹åº”çš„serverå†…å®¹ï¼š&lt;/span&gt;

server &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    listen       443 ssl http2 default_server&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    listen       &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;::]:443 ssl http2 default_server&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    server_name  _&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    root         /root/godpan.github.io/_site&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#åšå®¢_siteæ–‡ä»¶ç›®å½•&lt;/span&gt;

    ssl_certificate &lt;span class=&quot;s2&quot;&gt;&quot;/etc/letsencrypt/live/godpan.me/fullchain.pem&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;c&quot;&gt;#è¯ä¹¦çš„è·¯å¾„&lt;/span&gt;
    ssl_certificate_key &lt;span class=&quot;s2&quot;&gt;&quot;/etc/letsencrypt/live/godpan.me/privkey.pem&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#è¯ä¹¦å¯†é’¥çš„è·¯å¾„&lt;/span&gt;
    ssl_session_cache shared:SSL:1m&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    ssl_session_timeout  10m&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    ssl_ciphers HIGH:!aNULL:!MD5&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    ssl_prefer_server_ciphers on&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;# Load configuration files for the default server block.&lt;/span&gt;
    include /etc/nginx/default.d/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;.conf&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    location / &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    error_page 404 /404.html&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        location &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /40x.html &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    error_page 500 502 503 504 /50x.html&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        location &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /50x.html &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¼€å¯443ç«¯å£ï¼Œå¹¶é‡å¯nginxï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;firewall-cmd &lt;span class=&quot;nt&quot;&gt;--add-port&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;443/tcp &lt;span class=&quot;nt&quot;&gt;--permanent&lt;/span&gt;
firewall-cmd &lt;span class=&quot;nt&quot;&gt;--reload&lt;/span&gt;
systemctl restart nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¿™æ—¶å€™ä½ å°±å¯ä»¥ç”¨httpsè®¿é—®ä½ çš„ç½‘ç«™äº†ï¼Œæ¯”å¦‚https://godpan.meï¼Œä½†å› ä¸ºcertbotè¯ä¹¦æœ‰3ä¸ªæœˆçš„æœ‰æ•ˆæœŸï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®šæ—¶å»æ›´æ–°è¯ä¹¦ï¼Œä¸è¿‡å®ƒæä¾›äº†æ›´æ–°è¯ä¹¦çš„å‘½ä»¤ï¼š
&lt;code&gt;
certbot renew
&lt;/code&gt;
ä½†æ‰‹åŠ¨æ›´æ–°çš„è¯å¯ä»¥èƒ½ä¼šå¿˜ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ç³»ç»Ÿè‡ªèº«çš„å®šæ—¶ä»»åŠ¡å»æ›´æ–°ï¼š&lt;/p&gt;

&lt;p&gt;åˆ›å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;vi certbot-auto-renew-crontab

&lt;span class=&quot;c&quot;&gt;#è¾“å…¥ä»¥ä¸‹å†…å®¹è¿›è¡Œä¿å­˜ï¼Œå«ä¹‰æ˜¯æ¯ä¸ªæœˆç¬¬ä¸€å¤©çš„ä¸€ç‚¹å‡Œæ™¨ä¼šå»æ›´æ–°ä¸€æ¬¡è¯ä¹¦&lt;/span&gt;

0 1 1 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; certbot renew &lt;span class=&quot;nt&quot;&gt;--pre-hook&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;systemctl stop nginx&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--post-hook&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;systemctl start nginx&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æœ€åæˆ‘ä»¬crontabæ¥å¯åŠ¨è¿™ä¸ªä»»åŠ¡ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;crontab certbot-auto-renew-crontab
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è‡³æ­¤å¤§åŠŸå‘Šæˆï¼Œé™¤éä½ çš„æœåŠ¡å™¨å´©æºƒæˆ–è€…è¢«å°äº†ğŸ˜‚ğŸ˜‚ğŸ˜‚ã€‚&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Kafka producerå¼‚æ­¥å‘é€åœ¨æŸäº›æƒ…å†µä¼šé˜»å¡ä¸»çº¿ç¨‹</title>
   <link href="/2019/07/15/kafka-producer-send-async-bug.html"/>
   <updated>2019-07-15T00:00:00+08:00</updated>
   <id>urn:uuid:85cd4b63-e9f0-4459-8ca7-fbdsdc2a2fad</id>
   <content type="html">&lt;p&gt;æœ€è¿‘å‘ç°ä¸€ä¸ªKafka producerå¼‚æ­¥å‘é€åœ¨æŸäº›æƒ…å†µä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œåæ¥åœ¨æ’æŸ¥è§£å†³é—®é¢˜è¿‡ç¨‹ä¸­å‘ç°è¿™å¯ä»¥ç®—æ˜¯Kafkaçš„ä¸€ä¸ªè¯´æ˜ä¸æ°å½“çš„åœ°æ–¹ã€‚&lt;/p&gt;

&lt;h3&gt;é—®é¢˜è¯´æ˜&lt;/h3&gt;

&lt;p&gt;åœ¨å¾ˆå¤šåœºæ™¯ä¸‹æˆ‘ä»¬ä¼šä½¿ç”¨å¼‚æ­¥æ–¹å¼æ¥å‘é€Kafkaçš„æ¶ˆæ¯ï¼Œä¼šä½¿ç”¨KafkaProducerä¸­çš„ä»¥ä¸‹æ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Future&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RecordMetadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ProducerRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;V&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;record&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Callback&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æ ¹æ®&lt;a href=&quot;https://github.com/apache/kafka/blob/1f2d230bfdaafb34c9be12a370ab2eb4d3016039/clients/src/main/java/org/apache/kafka/clients/producer/KafkaProducer.java#L853&quot;&gt;æ–‡æ¡£çš„è¯´æ˜&lt;/a&gt;å®ƒæ˜¯ä¸€ä¸ªå¼‚æ­¥çš„å‘é€æ–¹æ³•ï¼ŒæŒ‰é“ç†ä¸ç®¡å¦‚ä½•å®ƒéƒ½ä¸åº”è¯¥é˜»å¡ä¸»çº¿ç¨‹ï¼Œä½†å®é™…ä¸­æŸäº›æƒ…å†µä¸‹ä¼šå‡ºç°é˜»å¡çº¿ç¨‹ï¼Œæ¯”å¦‚brokeræœªæ­£ç¡®è¿è¡Œï¼Œtopicæœªåˆ›å»ºç­‰æƒ…å†µï¼Œæœ‰äº›æ—¶å€™æˆ‘ä»¬ä¸éœ€è¦å¯¹å‘é€çš„ç»“æœåšä¿è¯ï¼Œä½†æ˜¯å¦‚æœå‡ºç°é˜»å¡çš„è¯ï¼Œä¼šå½±å“å…¶ä»–ä¸šåŠ¡é€»è¾‘ã€‚&lt;/p&gt;

&lt;h3&gt;é—®é¢˜å‡ºç°ç‚¹&lt;/h3&gt;

&lt;p&gt;ä»KafkaProducer sendè¿™ä¸ªæ–¹æ³•å£°æ˜ä¸Šçœ‹å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¥¹çš„å…·ä½“å®ç°ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Future&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RecordMetadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ProducerRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;V&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;record&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Callback&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// intercept the record, which can be potentially modified; this method does not throw exceptions&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ProducerRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;V&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;interceptedRecord&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;interceptors&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;onSend&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;record&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;doSend&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;interceptedRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/**
  * Implementation of asynchronously send a record to a topic.
  */&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Future&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RecordMetadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;doSend&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ProducerRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;V&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;record&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Callback&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;TopicPartition&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;throwIfProducerClosed&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// first make sure the metadata for the topic is available&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;ClusterAndWaitTime&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;clusterAndWaitTime&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;clusterAndWaitTime&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;waitOnMetadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;record&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;topic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;record&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;partition&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxBlockTimeMs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;//å‡ºç°é—®é¢˜çš„åœ°æ–¹&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;KafkaException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isClosed&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;())&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;KafkaException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Producer closed while send in progress&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ApiException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ClusterAndWaitTime&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;waitOnMetadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;topic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Integer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;partition&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxWaitMs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;InterruptedException&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// add topic to metadata topic list if it is not there already and reset expiry&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Cluster&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cluster&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;fetch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cluster&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;invalidTopics&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;contains&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;topic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;InvalidTopicException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;topic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;topic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;Integer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;partitionsCount&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cluster&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;partitionCountForTopic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;topic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Return cached metadata if we have it, and if the record's partition is either undefined&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// or within the known partition range&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;partitionsCount&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;partition&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;partition&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;partitionsCount&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ClusterAndWaitTime&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cluster&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;begin&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;milliseconds&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remainingWaitMs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxWaitMs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;elapsed&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;//ä¸€ç›´è·å–topicçš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œç›´åˆ°è·å–æˆåŠŸï¼Œè‹¥è·å–æ—¶é—´è¶…è¿‡maxWaitMsï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;partition&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;trace&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Requesting metadata update for partition {} of topic {}.&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;partition&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;topic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;trace&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Requesting metadata update for topic {}.&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;topic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;topic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;version&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;requestUpdate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;sender&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;wakeup&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;awaitUpdate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remainingWaitMs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TimeoutException&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// Rethrow with original maxWaitMs to prevent logging exception with remainingWaitMs&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;TimeoutException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Topic %s not present in metadata after %d ms.&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                            &lt;span class=&quot;n&quot;&gt;topic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxWaitMs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;cluster&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;fetch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;elapsed&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;milliseconds&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;begin&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;elapsed&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxWaitMs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;//åˆ¤æ–­æ‰§è¡Œæ—¶é—´æ˜¯å¦å¤§äºmaxWaitMs&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;TimeoutException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;partitionsCount&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;?&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Topic %s not present in metadata after %d ms.&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                            &lt;span class=&quot;n&quot;&gt;topic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxWaitMs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Partition %d of topic %s with partition count %d is not present in metadata after %d ms.&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                            &lt;span class=&quot;n&quot;&gt;partition&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;topic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;partitionsCount&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxWaitMs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;maybeThrowException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;remainingWaitMs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxWaitMs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;elapsed&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;partitionsCount&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cluster&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;partitionCountForTopic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;topic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;partitionsCount&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;partition&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;partition&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;partitionsCount&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ClusterAndWaitTime&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cluster&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;elapsed&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä»å®ƒçš„å®ç°æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡çš„åŸå› åœ¨äºä»¥ä¸‹è¿™ä¸ªé€»è¾‘ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ClusterAndWaitTime&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;waitOnMetadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;topic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Integer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;partition&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxWaitMs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;InterruptedException&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;é€šè¿‡KafkaProducer æ‰§è¡Œsendçš„è¿‡ç¨‹ä¸­éœ€è¦å…ˆè·å–Metadataï¼Œè€Œè¿™æ˜¯ä¸€ä¸ªä¸æ–­å¾ªç¯çš„æ“ä½œï¼Œç›´åˆ°è·å–æˆåŠŸï¼Œæˆ–è€…æŠ›å‡ºå¼‚å¸¸ã€‚&lt;/p&gt;

&lt;p&gt;å…¶å®Kafkaæœ¬æ„è¿™ä¹ˆå®ç°å¹¶æ²¡æœ‰é—®é¢˜ï¼Œå› ä¸ºä½ è¦å‘é€æ¶ˆæ¯çš„å‰æå°±æ˜¯èƒ½è·å–åˆ°borderå’Œtopicçš„ä¿¡æ¯ï¼Œé—®é¢˜åœ¨äºè¿™ä¸ªsendå¯¹å¤–æš´éœ²çš„æ˜¯Futureçš„æ–¹æ³•ï¼Œä½†æ˜¯å†…éƒ¨å®ç°å´æ˜¯æœ‰é˜»å¡çš„ï¼Œé‚£ä¹ˆåœ¨æœ‰äº›æ—¶å€™æ²¡æœ‰è€ƒè™‘åˆ°è¿™ç§æƒ…å†µï¼Œä¸€æ—¦å‡ºç°borderæˆ–è€…topicå¼‚å¸¸ï¼Œå°†ä¼šé˜»å¡ç³»ç»Ÿçº¿ç¨‹ï¼Œå¯¼è‡´ç³»ç»Ÿå“åº”å˜æ…¢ï¼Œç›´åˆ°å¥”æºƒã€‚&lt;/p&gt;

&lt;h3&gt;é—®é¢˜è§£å†³&lt;/h3&gt;

&lt;p&gt;å…¶å®è§£å†³è¿™ä¸ªé—®é¢˜å¾ˆç®€å•ï¼Œå°±æ˜¯å•ç‹¬åˆ›å»ºå‡ ä¸ªçº¿ç¨‹ç”¨äºæ¶ˆæ¯å‘é€ï¼Œè¿™æ ·å³ä½¿é‡åˆ°æ„å¤–æƒ…å†µï¼Œä¹Ÿåªä¼šé˜»å¡å‡ ä¸ªçº¿ç¨‹ï¼Œä¸ä¼šå¼•èµ·ç³»ç»Ÿçº¿ç¨‹å¤§é¢ç§¯é˜»å¡ï¼Œä¸å¯ç”¨ï¼Œå…·ä½“å®ç°ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-scala&quot; data-lang=&quot;scala&quot;&gt;&lt;span class=&quot;k&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;java.util.concurrent.Callable&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;java.util.concurrent.ExecutorService&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;java.util.concurrent.Executors&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.apache.kafka.clients.producer.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Callback&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;KafkaProducer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ProducerRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;RecordMetadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ProducerF&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;K&lt;/span&gt;,&lt;span class=&quot;kt&quot;&gt;V&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;](&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;kafkaProducer&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;KafkaProducer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;K&lt;/span&gt;,&lt;span class=&quot;kt&quot;&gt;V&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;executor&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;ExecutorService&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Executors&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;newScheduledThreadPool&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sendAsync&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;producerRecord&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;ProducerRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;K&lt;/span&gt;,&lt;span class=&quot;kt&quot;&gt;V&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Callback&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;executor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;submit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Callable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;RecordMetadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;call&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kafkaProducer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;producerRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;callback&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ç§å®ç°æ–¹å¼ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥è‡ªå·±ç»´æŠ¤ä¸€ä¸ªKafkaç‰ˆæœ¬ï¼Œä½†è¿™æ ·æˆ–è®¸æœ‰ç‚¹éº»çƒ¦ï¼Œå…·ä½“ç”¨ä»€ä¹ˆæ–¹å¼æ ¹æ®è‡ªå·±åœºæ™¯æ¥åšé€‰æ‹©ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ä¾‹å­:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-scala&quot; data-lang=&quot;scala&quot;&gt;&lt;span class=&quot;k&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;java.util.Properties&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.apache.kafka.clients.producer.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;KafkaProducer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ProducerRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;RecordMetadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;FixExample&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;App&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;props&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Properties&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;max.block.ms&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;3000&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;bootstrap.servers&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;localhost:9092&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;client.id&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;ProducerSendFixExample&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;key.serializer&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;org.apache.kafka.common.serialization.StringSerializer&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;value.serializer&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;org.apache.kafka.common.serialization.StringSerializer&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;producer&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;KafkaProducer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;](&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;topic&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;topic-trace-one&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;godpan&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;login wechat&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ProducerRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;](&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;topic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;startTime&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;currentTimeMillis&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;producerF&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ProducerF&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;producer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;producerF&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sendAsync&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;RecordMetadata&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exception&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;[producerF-sendAsync] data producerRecord: ${data}, exception: ${exception}&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;

  &lt;span class=&quot;c1&quot;&gt;// å¦‚æœæƒ³è¦å¾—åˆ°å‘é€ç»“æœï¼Œå¯ä»¥çº¿ç¨‹ç­‰å¾…4s
&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// Thread.sleep(4000)
&lt;/span&gt;  &lt;span class=&quot;nc&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ç›¸å…³ä»£ç å·²ç»ä¼ åˆ°githubä¸Šäº†ï¼Œåœ°å€ï¼š&lt;a href=&quot;https://github.com/godpan/kafka-send-async-bug-fix&quot;&gt;kafka-send-async-bug-fix&lt;/a&gt;ã€‚&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Gitæœ¬åœ°é¡¹ç›®æ¨é€åˆ°githubæ–°åˆ›å»ºä»“åº“ã€.gitignoreä¿®æ”¹åä¸èµ·æ•ˆæœ</title>
   <link href="/2018/10/06/git-init.html"/>
   <updated>2018-10-06T00:00:00+08:00</updated>
   <id>urn:uuid:85cc4ss3-e9f0-4454-8ca7-fbdsdc2a2fad</id>
   <content type="html">&lt;h3&gt;1.Gitæœ¬åœ°é¡¹ç›®æ¨é€åˆ°githubæ–°åˆ›å»ºä»“åº“&lt;/h3&gt;

&lt;p&gt;å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¼šå…ˆåœ¨æœ¬åœ°è¿›è¡Œé¡¹ç›®å¼€å‘ï¼Œç„¶åæƒ³æŠŠè¿™ä¸ªé¡¹ç›®çš„ä»£ç æ¨é€åˆ°githubä¸Šæ–°å»ºçš„ä»“åº“è¯¥æ€ä¹ˆåšï¼Ÿ&lt;/p&gt;

&lt;h4&gt;ç¬¬ä¸€æ­¥ï¼šåˆå§‹åŒ–git&lt;/h4&gt;

&lt;p&gt;æ‰§è¡Œå‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-git&quot; data-lang=&quot;git&quot;&gt;git init
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;ç¬¬äºŒæ­¥ï¼šåˆ›å»º.gitignoreæ–‡ä»¶&lt;/h4&gt;

&lt;p&gt;æ‰§è¡Œå‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;vi .gitignore
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¾“å…¥ä¸éœ€è¦ä¸Šä¼ çš„æ–‡ä»¶åŠæ–‡ä»¶å¤¹ã€‚&lt;/p&gt;

&lt;h4&gt;ç¬¬ä¸‰æ­¥ï¼šè¿æ¥è¿œç¨‹ä»“åº“&lt;/h4&gt;

&lt;p&gt;æ‰§è¡Œå‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-git&quot; data-lang=&quot;git&quot;&gt;git remote add origin xxx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¯ä»¥æ˜¯sshå½¢å¼æˆ–è€…httpå½¢å¼çš„ä»“åº“ã€‚&lt;/p&gt;

&lt;h4&gt;ç¬¬å››æ­¥ï¼šå°†æ–‡ä»¶åŠ åˆ°æš‚å­˜åŒº&lt;/h4&gt;

&lt;p&gt;æ‰§è¡Œå‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-git&quot; data-lang=&quot;git&quot;&gt;git add *
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æ ¹æ®éœ€æ±‚å“ªäº›æ–‡ä»¶è¦æ·»åŠ ã€‚&lt;/p&gt;

&lt;h4&gt;ç¬¬äº”æ­¥ï¼šæäº¤åˆ°åˆ†æ”¯&lt;/h4&gt;

&lt;p&gt;æ‰§è¡Œå‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-git&quot; data-lang=&quot;git&quot;&gt;git commit -m init
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;ç¬¬å…­æ­¥ï¼šæ¨é€åˆ°è¿œç¨‹åˆ†æ”¯&lt;/h4&gt;

&lt;p&gt;æ‰§è¡Œå‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-git&quot; data-lang=&quot;git&quot;&gt;git push origin master
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;2..gitignoreä¿®æ”¹åå¯¹ä»¥åŠä¸Šä¼ çš„æ–‡ä»¶ä¸èµ·æ•ˆæœ&lt;/h3&gt;

&lt;p&gt;æœ‰äº›æ—¶å€™æˆ‘ä»¬ä¸€å¼€å§‹ä¸Šä¼ ä»£ç åˆ°è¿œç¨‹ä»“åº“çš„æ—¶å€™ä¼šå¿˜äº†åˆ›å»º.gitignoreæ–‡ä»¶æˆ–è€…æ²¡æœ‰å®Œå…¨é…ç½®å¥½éœ€è¦å¿½ç•¥çš„æ–‡ä»¶åŠæ–‡ä»¶å¤¹ï¼Œä½†æ˜¯ç­‰æˆ‘ä»¬åæ¥åŠ ä¸Šçš„æ—¶å€™ï¼Œå´å‘ç°å¹¶æ²¡æœ‰æ•ˆæœï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ&lt;/p&gt;

&lt;p&gt;åŸå› æ˜¯è¿™äº›æ–‡ä»¶å¤¹ä»¥åŠæ–‡ä»¶å·²ç»è¢«ç‰ˆæœ¬æ§åˆ¶äº†ï¼Œå†ä¿®æ”¹.gitignoreæ–‡ä»¶æ— æ³•å¯¹å®ƒä»¬èµ·æ•ˆæœï¼Œé‚£ä¹ˆå¦‚ä½•è§£å†³é—®é¢˜ï¼š&lt;/p&gt;

&lt;p&gt;å¯ä»¥é€šè¿‡æ‰§è¡Œ &lt;code&gt;git rm --cached&lt;/code&gt; è¿™ä¸ªå‘½ä»¤è§£å†³ã€‚&lt;/p&gt;

&lt;p&gt;æ¯”å¦‚ä¸ä¸Šä¼ .ideaæ–‡ä»¶å¤¹ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-git&quot; data-lang=&quot;git&quot;&gt;git rm -r --cached .idea/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¦‚æœæ˜¯æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-git&quot; data-lang=&quot;git&quot;&gt;git rm --cached xxx.xml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content>
 </entry>
 
 <entry>
   <title>å¾®ä¿¡å°ç¨‹åºç¬¬ä¸‰æ–¹å¼€å‘éœ€è¦æ³¨æ„çš„ç‚¹</title>
   <link href="/2018/05/24/wx-miniprogram-tips.html"/>
   <updated>2018-05-24T00:00:00+08:00</updated>
   <id>urn:uuid:85cc4b63-e9f0-4454-8ca7-fbdsdc2a2ff</id>
   <content type="html">&lt;h3&gt;1.å…³äºå°ç¨‹åºä¸å…¬ä¼—å·unionidæ•°æ®äº’é€š&lt;/h3&gt;

&lt;p&gt;å°ç¨‹åºå’Œå…¬ä¼—å·å¿…é¡»ä¸ºåŒä¸€ä¸»ä½“ï¼Œè€Œä¸”å¿…é¡»ç»‘å®šåœ¨åŒä¸€ä¸ªå¼€æ”¾å¹³å°ä¸Šï¼Œå…¶ä¸­åˆåˆ†ä¸ºä¸¤ç‚¹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;1.å¼€æ”¾å¹³å°ä¸»åŠ¨åˆ›å»º
æ­¤æ—¶éœ€è¦æ‰‹åŠ¨å°†å°ç¨‹åºå’Œå…¬ä¼—å·ç»‘å®šåœ¨å¼€æ”¾å¹³å°ä¸Šï¼Œä¸å¯ä½¿ç”¨æ¥å£ç»‘å®šï¼›&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;2.å¼€æ”¾å¹³å°ç”±ç¬¬ä¸‰æ–¹æ¥å£åˆ›å»º
åœ¨å…¬ä¼—å·å’Œå°ç¨‹åºæˆæƒç¬¬ä¸‰æ–¹å¼€æ”¾å¹³å°ç®¡ç†æƒé™åï¼Œå¯ç”±æ¥å£è¿›è¡Œç»‘å®šï¼Œè‹¥è¦ç»‘å®šåœ¨åŒä¸€ä¸ªå¼€æ”¾å¹³å°ä¸Šï¼Œå‰ææ˜¯å…¬ä¼—å·å’Œå°ç¨‹åºçš„ä¸»ä½“ç›¸åŒï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒæ¥å£è§£é™¤ç»‘å®šï¼›&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;2.å…³äºå°ç¨‹åºext.json&lt;/h3&gt;

&lt;p&gt;å¼€å‘è¿‡ç¨‹ä¸­å¯åœ¨å°ç¨‹åºçš„æ ¹ç›®å½•ä¸‹æ·»åŠ ext.jsonæ–‡ä»¶æ¥è¿›è¡Œè°ƒè¯•ï¼Œæ¯”å¦‚åœ¨æ–‡ä»¶é‡Œæ·»åŠ ä»¥ä¸‹é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-json&quot; data-lang=&quot;json&quot;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;extEnable&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;extAppid&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;wx90d87655678517ee&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ext&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è®¾ç½®extEnableå±æ€§ä¸ºtrueï¼Œåç»­å°ç¨‹åºçš„é€»è¾‘å°†ä¾ç…§ext.jsonä¸­extAppidæ¥æ‰§è¡Œï¼Œå¹¶å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼æ¥è·å–extä¸­çš„å‚æ•°ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;c1&quot;&gt;//æ–¹å¼ä¸€&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;wx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getExtConfig&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;wx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getExtConfig&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;success&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;extConfig&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;//æ–¹å¼äºŒ&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;extConfig&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;wx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getExtConfigSync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;wx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getExtConfigSync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;extConfig&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¦å¤–ç¬¬ä¸‰æ–¹åœ¨å¸®åŠ©æˆæƒå°ç¨‹åºæäº¤ä»£ç çš„æ—¶å€™ä¹Ÿå¯ä»¥æŒ‡å®šextå­—æ®µï¼Œå…·ä½“æ–¹å¼å‚è€ƒï¼š&lt;a href=&quot;https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list&amp;t=resource/res_list&amp;verify=1&amp;id=open1489140610_Uavc4&amp;token=&amp;lang=zh_CN&quot;&gt;å¾®ä¿¡ç¬¬ä¸‰æ–¹ä»£å°ç¨‹åºå®ç°æ¥å£&lt;/a&gt;
å…¶ä¸­éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯&lt;code&gt;ext_json&lt;/code&gt;çš„æ ¼å¼è¦éå¸¸æ³¨æ„ï¼Œå› ä¸º&lt;code&gt;ext_json&lt;/code&gt;ç»“æ„å¾ˆæ¾æ•£ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™éœ€è¦æˆ‘ä»¬è‡ªå·±æ‹¼è£…è¿™ä¸ªå­—æ®µï¼Œé‚£ä¹ˆå®ƒéœ€è¦ä¸ºç±»ä¼¼ä»¥ä¸‹æ ¼å¼ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;&quot;{\&quot;extAppid\&quot;: \&quot;wx90d87655678517ee\&quot;,\&quot;ext\&quot;:{\&quot;id\&quot;:100}}&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¦å¤–é€šè¿‡æ¥å£æäº¤çš„&lt;code&gt;ext_json&lt;/code&gt;ä¼šè¦†ç›–é…ç½®çš„ext.jsonä¸­çš„å¯¹åº”ä¿¡æ¯ï¼Œä½†åœ¨å¼€å‘è€…å·¥å…·æ— æ³•è·å–æ¥å£æäº¤çš„&lt;code&gt;ext_json&lt;/code&gt;çš„ä¿¡æ¯ï¼Œåªèƒ½è·å–ext.jsonä¸­ä¿¡æ¯ï¼Œè¿™ç‚¹éœ€è¦æ³¨æ„ã€‚&lt;/p&gt;

&lt;h3&gt;3.mpvueç»“åˆext.json&lt;/h3&gt;

&lt;p&gt;ç›®å‰æœ€æ–°ç‰ˆæœ¬çš„mpvueå¥½åƒè¿˜ä¸æ”¯æŒåœ¨main.jsä¸­æ·»åŠ ext.jsonçš„é…ç½®ï¼Œæ‰€ä»¥è‹¥æ˜¯éœ€è¦ä½¿ç”¨å®ƒæœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;1.å†™ä¸€ä¸ªæ’ä»¶ï¼Œå°†srcä¸‹çš„ext.jsonç¼–è¯‘çš„distç›®å½•ä¸‹ï¼ˆmpvueç¼–è¯‘åçš„å°ç¨‹åºæºç ç›®å½•ï¼‰&lt;/li&gt;
&lt;li&gt;2.ç›´æ¥åœ¨distç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªext.jsonæ–‡ä»¶
ä½†è®°å¾—è¦å°†extEnableå±æ€§è®¾ç½®ä¸ºtrueã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;4.ç”¨æˆ·å°ç¨‹åºæˆæƒä¹‹åçš„è§£å¯†ç®—æ³•ï¼ˆjsç‰ˆï¼‰&lt;/h3&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;k&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;crypto&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'crypto-browserify'&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;WXBizDataCrypt&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;appId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;sessionKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//å°ç¨‹åºappidï¼Œç”¨æˆ·ç™»å½•åˆ©ç”¨codeä»æ¥å£è·å¾—çš„sessionKey&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;appId&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;appId&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;sessionKey&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;sessionKey&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;WXBizDataCrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;prototype&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;decryptData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;encryptedData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;iv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;// base64 decode&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;sessionKey&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;sessionKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'base64'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;encryptedData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;encryptedData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'base64'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;iv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Buffer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;iv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'base64'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
     &lt;span class=&quot;c1&quot;&gt;// è§£å¯†&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;decipher&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;crypto&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;createDecipheriv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'aes-128-cbc'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;sessionKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;iv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// è®¾ç½®è‡ªåŠ¨ padding ä¸º trueï¼Œåˆ é™¤å¡«å……è¡¥ä½&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;decipher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setAutoPadding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;decoded&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;decipher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;encryptedData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'binary'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'utf8'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;decoded&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;decipher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;final&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'utf8'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;decoded&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;JSON&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;parse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;decoded&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Illegal Buffer'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;decoded&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;watermark&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;appid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;appId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Illegal Buffer'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;decoded&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;DataCrypt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;getData&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;appId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;sessionKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;encryptedData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;iv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;pc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;WXBizDataCrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;appId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;sessionKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;pc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;decryptData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;encryptedData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;iv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;DataCrypt&lt;/span&gt;

&lt;span class=&quot;err&quot;&gt;ä½¿ç”¨æ–¹å¼ï¼š&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;DataCrypt&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;path/to/DataCrypt&quot;&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;DataCrypt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(...)&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content>
 </entry>
 
 <entry>
   <title>Kafkaå­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰ ï¼šåˆæ¢Kafka</title>
   <link href="/2018/03/24/learning-kafka-2.html"/>
   <updated>2018-03-24T00:00:00+08:00</updated>
   <id>urn:uuid:85cc4b63-e9f0-4454-8ca7-fbdsdc2a2fad</id>
   <content type="html">&lt;p&gt;çœ‹å®Œä¸Šä¸€ç¯‡ï¼Œç›¸ä¿¡å¤§å®¶å¯¹æ¶ˆæ¯ç³»ç»Ÿä»¥åŠKafkaçš„æ•´ä½“æ„æˆéƒ½æœ‰äº†åˆæ­¥äº†è§£ï¼Œå­¦ä¹ ä¸€ä¸ªä¸œè¥¿æœ€å¥½çš„åŠæ³•ï¼Œå°±æ˜¯å»ä½¿ç”¨å®ƒï¼Œä»Šå¤©å°±è®©æˆ‘ä»¬ä¸€èµ·çª¥æ¢ä¸€ä¸‹Kafkaï¼Œå¹¶å®Œæˆè‡ªå·±çš„å¤„å¥³ä½œã€‚&lt;/p&gt;

&lt;h2&gt;æ¶ˆæ¯åœ¨Kafkaä¸­çš„å†ç¨‹&lt;/h2&gt;

&lt;p&gt;è™½ç„¶æˆ‘ä»¬æŒæ¡ä¸œè¥¿è¦ä¸€æ­¥ä¸€æ­¥æ¥ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨å¤§è‡´äº†è§£äº†ä¸€ä¸ªä¸œè¥¿åï¼Œä¼šæœ‰åˆ©äºæˆ‘ä»¬å¯¹å®ƒçš„ç†è§£å’Œå­¦ä¹ ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆæ¥çœ‹ä¸€ä¸‹ä¸€æ¡æ¶ˆæ¯ä»å‘å‡ºåˆ°æœ€åè¢«æ¶ˆæ¯è€…æ¥æ”¶åˆ°åº•ç»å†äº†ä»€ä¹ˆï¼Ÿ&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/media/images/2018/03/message-flow.png&quot; alt=&quot;message-flow&quot;&gt;&lt;/p&gt;

&lt;p&gt;ä¸Šå›¾ç®€è¦çš„è¯´æ˜äº†æ¶ˆæ¯åœ¨Kafkaä¸­çš„æ•´ä¸ªæµè½¬è¿‡ç¨‹ï¼ˆå‡è®¾å·²ç»éƒ¨ç½²å¥½äº†æ•´ä¸ªKafkaç³»ç»Ÿï¼Œå¹¶åˆ›å»ºäº†ç›¸åº”çš„Topicï¼Œåˆ†åŒºç­‰ç»†èŠ‚åç»­å†å•ç‹¬è®²ï¼‰ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;1.æ¶ˆæ¯ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘å¸ƒåˆ°å…·ä½“çš„Topicï¼Œæ ¹æ®ä¸€å®šç®—æ³•æˆ–è€…éšæœºè¢«åˆ†å‘åˆ°å…·ä½“çš„åˆ†åŒºä¸­ï¼›&lt;/li&gt;
&lt;li&gt;2.æ ¹æ®å®é™…éœ€æ±‚ï¼Œæ˜¯å¦éœ€è¦å®ç°å¤„ç†æ¶ˆæ¯é€»è¾‘ï¼›&lt;/li&gt;
&lt;li&gt;3.è‹¥éœ€è¦ï¼Œåˆ™å®ç°å…·ä½“é€»è¾‘åå°†ç»“æœå‘å¸ƒåˆ°è¾“å‡ºTopicï¼›&lt;/li&gt;
&lt;li&gt;4.æ¶ˆè´¹è€…æ ¹æ®éœ€æ±‚è®¢é˜…ç›¸å…³Topicï¼Œå¹¶æ¶ˆè´¹æ¶ˆæ¯ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ€»çš„æ¥è¯´ï¼Œæ€ä¹ˆæµç¨‹è¿˜æ˜¯æ¯”è¾ƒæ¸…æ™°å’Œç®€å•çš„ï¼Œä¸‹é¢å°±è·Ÿæˆ‘ä¸€èµ·æ¥ç»ƒä¹ Kafkaçš„åŸºæœ¬æ“ä½œï¼Œæœ€åå®ç°ä¸€ä¸ªå•è¯è®¡æ•°çš„å°demoã€‚&lt;/p&gt;

&lt;h2&gt;åŸºç¡€æ“ä½œ&lt;/h2&gt;

&lt;p&gt;ä»¥ä¸‹ä»£ç åŠç›¸åº”æµ‹è¯•åœ¨ä»¥ä¸‹ç¯å¢ƒæµ‹è¯•é€šè¿‡ï¼šMac OS + JDK1.8ï¼ŒLinuxç³»ç»Ÿåº”è¯¥ä¹Ÿèƒ½è·‘é€šï¼ŒWindowsæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å»å®˜ç½‘ä¸‹è½½ç›¸åº”ç‰ˆæœ¬è¿›è¡Œç›¸åº”çš„æµ‹è¯•ç»ƒä¹ ã€‚&lt;/p&gt;

&lt;h3&gt;ä¸‹è½½Kafka&lt;/h3&gt;

&lt;p&gt;Macç³»ç»ŸåŒå­¦å¯ä»¥ä½¿ç”¨brewå®‰è£…ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;brew install kafka
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Linuxç³»ç»ŸåŒå­¦å¯ä»¥ä»å®˜ç½‘ä¸‹è½½æºç è§£å‹ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;cd 
&lt;/span&gt;mkdir test-kafka &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;test-kafka
curl &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; kafka_2.11-1.0.1.tgz https://mirrors.tuna.tsinghua.edu.cn/apache/kafka/1.0.1/kafka_2.11-1.0.1.tgz
&lt;span class=&quot;nb&quot;&gt;tar&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-xzf&lt;/span&gt; kafka_2.11-1.0.1.tgz
&lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;kafka_2.11-1.0.1

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;å¯åŠ¨&lt;/h3&gt;

&lt;p&gt;Kafkaä½¿ç”¨Zookeeperæ¥ç»´æŠ¤é›†ç¾¤ä¿¡æ¯ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å…ˆè¦å¯åŠ¨Zookeeperï¼ŒKafkaä¸Zookeeperçš„ç›¸å…³è”ç³»è·Ÿç»“åˆåç»­å†æ·±å…¥äº†è§£ï¼Œæ¯•ç«Ÿä¸èƒ½ä¸€å£åƒæˆä¸€ä¸ªèƒ–å­ã€‚&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;bin/zookeeper-server-start.sh config/zookeeper.properties
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æ¥ç€æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªKafka ServerèŠ‚ç‚¹ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;bin/kafka-server-start.sh config/server.properties
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¿™æ—¶å€™Kafkaç³»ç»Ÿå·²ç»ç®—æ˜¯å¯åŠ¨èµ·æ¥äº†ã€‚&lt;/p&gt;

&lt;h3&gt;åˆ›å»ºTopic&lt;/h3&gt;

&lt;p&gt;åœ¨ä¸€åˆ‡å°±ç»ªä¹‹åï¼Œæˆ‘ä»¬è¦å¼€å§‹åšæå…¶é‡è¦çš„ä¸€æ­¥ï¼Œé‚£å°±æ˜¯åˆ›å»ºTopicï¼ŒTopicæ˜¯æ•´ä¸ªç³»ç»Ÿæµè½¬çš„æ ¸å¿ƒï¼Œå¦å¤–Topicæœ¬èº«ä¹ŸåŒ…å«ç€å¾ˆå¤šå¤æ‚çš„å‚æ•°ï¼Œæ¯”å¦‚å¤åˆ¶å› å­ä¸ªæ•°ï¼Œåˆ†åŒºä¸ªæ•°ç­‰ï¼Œè¿™é‡Œä¸ºäº†ä»ç®€ï¼Œæˆ‘ä»¬å°†å¯¹åº”çš„å‚æ•°éƒ½è®¾ä¸º1ï¼Œæ–¹ä¾¿å¤§å®¶æµ‹è¯•ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;bin/kafka-topics.sh &lt;span class=&quot;nt&quot;&gt;--create&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--zookeeper&lt;/span&gt; localhost:2181 &lt;span class=&quot;nt&quot;&gt;--replication-factor&lt;/span&gt; 1 &lt;span class=&quot;nt&quot;&gt;--partitions&lt;/span&gt; 1 &lt;span class=&quot;nt&quot;&gt;--topic&lt;/span&gt; kakfa-test
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å…¶ä¸­å‚æ•°çš„å…·ä½“å«ä¹‰ï¼š&lt;/p&gt;

&lt;p&gt;å±æ€§|åŠŸèƒ½
---|---
--create | ä»£è¡¨åˆ›å»ºTopic
--zookeeper | zookeeperé›†ç¾¤ä¿¡æ¯
--replication-factor | å¤åˆ¶å› å­
--partitions | åˆ†åŒºä¿¡æ¯
--topic | Topicåç§°&lt;/p&gt;

&lt;p&gt;è¿™æ—¶å€™æˆ‘ä»¬å·²ç»åˆ›å»ºå¥½äº†ä¸€ä¸ªå«kakfa-testçš„Topicäº†ã€‚&lt;/p&gt;

&lt;h3&gt;å‘Topicå‘é€æ¶ˆæ¯&lt;/h3&gt;

&lt;p&gt;åœ¨æœ‰äº†Topicåæˆ‘ä»¬å°±å¯ä»¥å‘å…¶å‘é€æ¶ˆæ¯ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;bin/kafka-console-producer.sh &lt;span class=&quot;nt&quot;&gt;--broker-list&lt;/span&gt; localhost:9092 &lt;span class=&quot;nt&quot;&gt;--topic&lt;/span&gt; kakfa-test
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ç„¶åæˆ‘ä»¬å‘æ§åˆ¶å°è¾“å…¥ä¸€äº›æ¶ˆæ¯ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;this is my first test kafka
so good
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¿™æ—¶å€™æ¶ˆæ¯å·²ç»è¢«å‘å¸ƒåœ¨kakfa-testè¿™ä¸ªä¸»é¢˜ä¸Šäº†ã€‚&lt;/p&gt;

&lt;h3&gt;ä»Topicè·å–æ¶ˆæ¯&lt;/h3&gt;

&lt;p&gt;ç°åœ¨Topicä¸Šå·²ç»æœ‰æ¶ˆæ¯äº†ï¼Œç°åœ¨å¯ä»¥ä»ä¸­è·å–æ¶ˆæ¯è¢«æ¶ˆè´¹ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;bin/kafka-console-consumer.sh &lt;span class=&quot;nt&quot;&gt;--bootstrap-server&lt;/span&gt; localhost:9092 &lt;span class=&quot;nt&quot;&gt;--topic&lt;/span&gt; kafka-test &lt;span class=&quot;nt&quot;&gt;--from-beginning&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;this is my first &lt;span class=&quot;nb&quot;&gt;test &lt;/span&gt;kafka
so good
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è‡³æ­¤æˆ‘ä»¬å°±æµ‹è¯•äº†æœ€ç®€å•çš„Kafka Demoï¼Œå¸Œæœ›å¤§å®¶èƒ½è‡ªå·±åŠ¨æ‰‹å»è¯•è¯•ï¼Œè™½ç„¶å¾ˆç®€å•ï¼Œä½†æ˜¯è¿™èƒ½è®©ä½ å¯¹æ•´ä¸ªKafkaæµç¨‹èƒ½æ›´ç†Ÿæ‚‰ã€‚&lt;/p&gt;

&lt;h2&gt;WordCount&lt;/h2&gt;

&lt;p&gt;ä¸‹é¢æˆ‘ä»¬æ¥åˆ©ç”¨ä¸Šé¢çš„ä¸€äº›åŸºæœ¬æ“ä½œæ¥å®ç°ä¸€ä¸ªç®€å•WordCountç¨‹åºï¼Œå®ƒå…·å¤‡ä»¥ä¸‹åŠŸèƒ½ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;1.æ”¯æŒè¯ç»„æŒç»­è¾“å…¥ï¼Œå³ç”Ÿäº§è€…ä¸æ–­ç”Ÿæˆæ¶ˆæ¯ï¼›&lt;/li&gt;
&lt;li&gt;2.ç¨‹åºè‡ªåŠ¨ä»è¾“å…¥Topicä¸­è·å–åŸå§‹æ•°æ®ï¼Œç„¶åç»è¿‡å¤„ç†ï¼Œå°†å¤„ç†ç»“æœå‘å¸ƒåœ¨è®¡æ•°Topicä¸­ï¼›&lt;/li&gt;
&lt;li&gt;3.æ¶ˆè´¹è€…å¯ä»¥ä»è®¡æ•°Topicè·å–ç›¸åº”çš„WordCountçš„ç»“æœï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;1.å¯åŠ¨kafka&lt;/h3&gt;

&lt;p&gt;ä¸ä¸Šæ–‡çš„å¯åŠ¨ä¸€æ ·ï¼ŒæŒ‰ç…§å…¶æ“ä½œå³å¯ã€‚&lt;/p&gt;

&lt;h3&gt;2.åˆ›å»ºè¾“å…¥Topic&lt;/h3&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;bin/kafka-topics.sh &lt;span class=&quot;nt&quot;&gt;--zookeeper&lt;/span&gt; localhost:2181 &lt;span class=&quot;nt&quot;&gt;--create&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--topic&lt;/span&gt; kafka-word-count-input &lt;span class=&quot;nt&quot;&gt;--partitions&lt;/span&gt; 1 &lt;span class=&quot;nt&quot;&gt;--replication-factor&lt;/span&gt; 1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;3.å‘Topicè¾“å…¥æ¶ˆæ¯&lt;/h3&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;bin/kafka-console-producer.sh &lt;span class=&quot;nt&quot;&gt;--broker-list&lt;/span&gt; localhost:9092 &lt;span class=&quot;nt&quot;&gt;--topic&lt;/span&gt; kafka-word-count-input
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;4.æµå¤„ç†é€»è¾‘&lt;/h3&gt;

&lt;p&gt;è¿™éƒ¨åˆ†å†…å®¹æ˜¯æ•´ä¸ªä¾‹å­çš„æ ¸å¿ƒï¼Œè¿™éƒ¨åˆ†ä»£ç æœ‰Java 8+å’ŒScalaç‰ˆæœ¬ï¼Œä¸ªäººè®¤ä¸ºæµå¤„ç†ç”¨å‡½æ•°å¼è¯­æ³•è¡¨è¾¾çš„æ›´åŠ ç®€æ´æ¸…æ™°ï¼Œæ¨èå¤§å®¶ç”¨å‡½æ•°å¼çš„æ€ç»´å»å°è¯•å†™ä»¥ä¸‹ï¼Œå‘ç°è‡ªå·±å†ä¹Ÿä¸æƒ³å†™JavaåŒ¿åå†…éƒ¨ç±»è¿™ç§è¯­æ³•äº†ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªJava 8çš„ç‰ˆæœ¬:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;WordCount&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Properties&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;props&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Properties&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;StreamsConfig&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;APPLICATION_ID_CONFIG&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;kafka-word-count&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;StreamsConfig&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;BOOTSTRAP_SERVERS_CONFIG&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;localhost:9092&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;StreamsConfig&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;DEFAULT_KEY_SERDE_CLASS_CONFIG&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Serdes&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getClass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;StreamsConfig&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;DEFAULT_VALUE_SERDE_CLASS_CONFIG&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Serdes&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getClass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;

        &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;StreamsBuilder&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;builder&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;StreamsBuilder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;KStream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;source&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;builder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;kafka-word-count-input&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Pattern&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pattern&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Pattern&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;compile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;\\W+&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;source&lt;/span&gt;
           &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;flatMapValues&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Arrays&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;asList&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pattern&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toLowerCase&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Locale&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getDefault&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()))))&lt;/span&gt;
           &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;groupBy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
           &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Materialized&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Long&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;KeyValueStore&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Bytes&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[]&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;as&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;counts-store&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;mapValues&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Long&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
           &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toStream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
           &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;kafka-word-count-output&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;KafkaStreams&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;streams&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;KafkaStreams&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;builder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;streams&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æ˜¯ä¸æ˜¯å¾ˆæƒŠè®¶ï¼Œç”¨javaä¹Ÿèƒ½å†™å‡ºå¦‚æ­¤ç®€æ´çš„ä»£ç ï¼Œæ‰€ä»¥è¯´å¦‚æœæœ‰é€‚ç”¨åœºæ™¯ï¼Œæ¨èå¤§å®¶å°è¯•çš„ç”¨å‡½æ•°å¼çš„æ€ç»´å»å†™å†™javaä»£ç ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬å†æ¥çœ‹çœ‹Scalaç‰ˆæœ¬çš„ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-scala&quot; data-lang=&quot;scala&quot;&gt;
&lt;span class=&quot;k&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;WordCount&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Array&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Properties&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Properties&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;StreamsConfig&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;APPLICATION_ID_CONFIG&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;kafka-word-count&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;StreamsConfig&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;BOOTSTRAP_SERVERS_CONFIG&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;localhost:9092&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;StreamsConfig&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;DEFAULT_KEY_SERDE_CLASS_CONFIG&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Serdes&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getClass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;StreamsConfig&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;DEFAULT_VALUE_SERDE_CLASS_CONFIG&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Serdes&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getClass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;builder&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;StreamsBuilder&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;StreamsBuilder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;KStream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;builder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;kafka-word-count-input&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;source&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flatMapValues&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;textLine&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;textLine&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;toLowerCase&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;\\W+&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;toIterable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;asJava&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;groupBy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Materialized&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;as&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;kt&quot;&gt;Long&lt;/span&gt;, &lt;span class=&quot;kt&quot;&gt;KeyValueStore&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;Bytes&lt;/span&gt;, &lt;span class=&quot;kt&quot;&gt;Array&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;Byte&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]]](&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;counts-store&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;toStream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;kafka-word-count-output&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;streams&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;KafkaStreams&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;KafkaStreams&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;builder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;streams&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¯ä»¥å‘ç°ä½¿ç”¨Java 8å‡½æ•°å¼é£æ ¼ç¼–å†™çš„ä»£ç å·²ç»è·ŸScalaå¾ˆç›¸ä¼¼äº†ã€‚&lt;/p&gt;

&lt;h3&gt;5.å¯åŠ¨å¤„ç†é€»è¾‘&lt;/h3&gt;

&lt;p&gt;å¾ˆå¤šåŒå­¦ç”µè„‘ä¸Šå¹¶æ²¡æœ‰è£…sbtï¼Œæ‰€ä»¥è¿™é‡Œæ¼”ç¤ºçš„åˆ©ç”¨Mavenæ„å»ºçš„Javaç‰ˆæœ¬ï¼Œå…·ä½“æ‰§è¡Œæ­¥éª¤è¯·å‚è€ƒ&lt;a href=&quot;https://github.com/godpan/kafka-word-count&quot;&gt;æˆ³è¿™é‡Œkafka-word-count&lt;/a&gt;ä¸Šçš„è¯´æ˜ã€‚&lt;/p&gt;

&lt;h3&gt;6.å¯åŠ¨æ¶ˆè´¹è€…è¿›ç¨‹&lt;/h3&gt;

&lt;p&gt;æœ€åæˆ‘ä»¬å¯åŠ¨æ¶ˆè´¹è€…è¿›ç¨‹ï¼Œå¹¶åœ¨ç”Ÿäº§è€…ä¸­è¾“å…¥ä¸€äº›å•è¯ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/media/images/2018/03/kafka-word-count-input.png&quot; alt=&quot;kafka-word-count-input&quot;&gt;&lt;/p&gt;

&lt;p&gt;æœ€åæˆ‘ä»¬å¯ä»¥åœ¨æ¶ˆè´¹è€…è¿›ç¨‹ä¸­çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;bin/kafka-console-consumer.sh &lt;span class=&quot;nt&quot;&gt;--topic&lt;/span&gt; kafka-word-count-output &lt;span class=&quot;nt&quot;&gt;--from-beginning&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--bootstrap-server&lt;/span&gt; localhost:9092  &lt;span class=&quot;nt&quot;&gt;--property&lt;/span&gt; print.key&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/media/images/2018/03/kafka-word-count-output.png&quot; alt=&quot;kafka-word-count-output&quot;&gt;&lt;/p&gt;

&lt;h2&gt;æ€»ç»“&lt;/h2&gt;

&lt;p&gt;æœ¬ç¯‡æ–‡ç« ä¸»è¦æ˜¯è®²è§£äº†Kafkaçš„åŸºæœ¬è¿è¡Œè¿‡ç¨‹å’Œä¸€äº›åŸºç¡€æ“ä½œï¼Œä½†è¿™æ˜¯æˆ‘ä»¬å­¦ä¹ ä¸€ä¸ªä¸œè¥¿å¿…ä¸å¯å°‘çš„ä¸€æ­¥ï¼Œåªæœ‰æŠŠåŸºç¡€æ‰å®å¥½ï¼Œæ‰èƒ½æ›´æ·±å…¥çš„å»äº†è§£å®ƒï¼Œç†è§£å®ƒä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡ï¼Œæˆ‘åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¹Ÿé‡åˆ°å¾ˆå¤šéº»çƒ¦ï¼Œæ‰€ä»¥è¿˜æ˜¯å¸Œæœ›å¤§å®¶èƒ½å¤Ÿè‡ªå·±åŠ¨æ‰‹å»å®è·µä¸€ä¸‹ï¼Œæœ€ç»ˆèƒ½æ”¶è·æ›´å¤šã€‚&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Gitåˆ é™¤æœ¬åœ°åˆ†æ”¯ï¼ˆæ‰¹é‡åˆ é™¤ï¼‰</title>
   <link href="/2018/03/20/git-small-skill.html"/>
   <updated>2018-03-20T00:00:00+08:00</updated>
   <id>urn:uuid:85cc4b63-e9f0-4454-8ca7-fbdsdc2a2fad</id>
   <content type="html">&lt;p&gt;åˆ†äº«ä¸€ä¸ªå°æŠ€å·§ï¼Œæˆ‘ä»¬åœ¨å¾ˆå¤šæ—¶å€™éœ€è¦åˆ é™¤ä¸€äº›æœ¬åœ°æ— ç”¨åˆ†æ”¯ï¼Œå‡å¦‚æˆ‘ä»¬æƒ³è¦åˆ é™¤å…·ä½“åˆ†æ”¯ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåšï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;git branch &lt;span class=&quot;nt&quot;&gt;-D&lt;/span&gt; branchName
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä½†æ˜¯æœ‰äº›æ—¶å€™æˆ‘ä»¬è¦åˆ é™¤å¾ˆå¤šåˆ†æ”¯ï¼Œæ¯”å¦‚é™¤äº†masterå¤–çš„æ‰€æœ‰åˆ†æ”¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåšï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;git checkout master
git branch | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'master'&lt;/span&gt; | xargs git branch &lt;span class=&quot;nt&quot;&gt;-D&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å…·ä½“æ‰§è¡Œæ­¥éª¤æ˜¯ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;åˆ‡æ¢åˆ°masteråˆ†æ”¯&lt;/li&gt;
&lt;li&gt;å°†git branchçš„ç»“æœè¿›è¡Œç­›é€‰ï¼Œé™¤å»master&lt;/li&gt;
&lt;li&gt;å°†å¤„ç†åçš„ç»“æœä½œä¸ºgit branch -Dçš„å‚æ•°æ¥è¿›è¡Œåˆ é™¤åˆ†æ”¯&lt;/li&gt;
&lt;/ol&gt;
</content>
 </entry>
 
 <entry>
   <title>Kafkaå­¦ä¹ ç¬”è®°ï¼ˆä¸€ï¼‰ ï¼šä¸ºä»€ä¹ˆéœ€è¦Kafkaï¼Ÿ</title>
   <link href="/2018/03/05/learning-kafka-1.html"/>
   <updated>2018-03-05T00:00:00+08:00</updated>
   <id>urn:uuid:85cc4b63-e9f0-4454-8ca7-fbdsdc2a2fad</id>
   <content type="html">&lt;p&gt;æˆ‘ä»¬åœ¨å­¦ä¹ ä¸€ä¸ªä¸œè¥¿çš„æ—¶å€™ï¼Œå¾€å¾€åªæœ‰çœŸæ­£äº†è§£å®ƒèƒŒåçš„å«ä¹‰ï¼Œæ‰èƒ½ä¸€æ­¥ä¸€æ­¥çš„æŒæ¡å®ƒï¼Œç›´åˆ°è¿ç­¹å¸·å¹„ã€‚å¯¹äºKafkaæ¥è¯´ï¼Œæˆ‘ä¹Ÿæ˜¯ä¸€ä¸ªå°ç™½ï¼Œæœ¬ç¯‡æ–‡ç« æˆ‘å°±ä»¥ä¸€ä¸ªå°ç™½çš„è§’åº¦æ¥åˆæ¢ä¸€ä¸‹Kafkaï¼Œæœ¬ç¯‡æ–‡ç« åŸºäºå®˜æ–¹æ–‡æ¡£ï¼Œé¡ºä¾¿è¯´ä¸€å¥å®˜æ–¹æ–‡æ¡£çœŸçš„å¾ˆé‡è¦ï¼Œä¸”è¯»ä¸”çæƒœã€‚&lt;/p&gt;

&lt;h2&gt;èƒŒæ™¯&lt;/h2&gt;

&lt;p&gt;Kafkaæœ€æ—©æ˜¯ç”±LinkedInå…¬å¸å¼€å‘çš„ï¼Œä½œä¸ºå…¶è‡ªèº«ä¸šåŠ¡æ¶ˆæ¯å¤„ç†çš„åŸºç¡€ï¼ŒåLinkedInå…¬å¸å°†Kafkaæèµ ç»™Apacheï¼Œç°åœ¨å·²ç»æˆä¸ºApacheçš„ä¸€ä¸ªé¡¶çº§é¡¹ç›®äº†ï¼ŒKafkaä½œä¸ºä¸€ä¸ªé«˜ååçš„åˆ†å¸ƒå¼çš„æ¶ˆæ¯ç³»ç»Ÿï¼Œç›®å‰å·²ç»è¢«å¾ˆå¤šå…¬å¸åº”ç”¨åœ¨å®é™…çš„ä¸šåŠ¡ä¸­äº†ï¼Œå¹¶ä¸”ä¸è®¸å¤šæ•°æ®å¤„ç†æ¡†æ¶ç›¸ç»“åˆï¼Œæ¯”å¦‚Hadoopï¼ŒSparkç­‰ã€‚&lt;/p&gt;

&lt;h3&gt;æ¶ˆæ¯ç³»ç»Ÿ&lt;/h3&gt;

&lt;p&gt;åœ¨å®é™…çš„ä¸šåŠ¡éœ€æ±‚ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¤„ç†å„ç§å„æ ·çš„æ¶ˆæ¯ï¼Œæ¯”å¦‚Page View,æ—¥å¿—ï¼Œè¯·æ±‚ç­‰ï¼Œé‚£ä¹ˆä¸€ä¸ªå¥½çš„æ¶ˆæ¯ç³»ç»Ÿåº”è¯¥æ‹¥æœ‰å“ªäº›åŠŸèƒ½å‘¢ï¼Ÿ&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æ‹¥æœ‰æ¶ˆæ¯å‘å¸ƒå’Œè®¢é˜…çš„åŠŸèƒ½ï¼Œç±»ä¼¼äºæ¶ˆæ¯é˜Ÿåˆ—æˆ–è€…ä¼ä¸šæ¶ˆæ¯ä¼ é€ç³»ç»Ÿï¼›&lt;/li&gt;
&lt;li&gt;èƒ½å­˜å‚¨æ¶ˆæ¯æµï¼Œå¹¶å…·å¤‡å®¹é”™æ€§ï¼›&lt;/li&gt;
&lt;li&gt;èƒ½å¤Ÿå®æ—¶çš„å¤„ç†æ¶ˆæ¯ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä»¥ä¸Š3ç‚¹æ˜¯ä½œä¸ºä¸€ä¸ªå¥½çš„æ¶ˆæ¯ç³»ç»Ÿçš„æœ€åŸºæœ¬çš„èƒ½åŠ›ã€‚&lt;/p&gt;

&lt;p&gt;é‚£ä¹ˆKafkaä¸ºä»€ä¹ˆä¼šè¯ç”Ÿå‘¢ï¼Ÿ&lt;/p&gt;

&lt;p&gt;å…¶å®åœ¨æˆ‘ä»¬å·¥ä½œä¸­ï¼Œç›¸ä¿¡æœ‰å¾ˆå¤šä¹Ÿæ¥è§¦è¿‡æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç”šè‡³è‡ªå·±ä¹Ÿå†™è¿‡ç®€å•çš„æ¶ˆæ¯ç³»ç»Ÿï¼Œå®ƒæœ€åŸºæœ¬åº”è¯¥æ‹¥æœ‰å‘å¸ƒ/è®¢é˜…çš„åŠŸèƒ½ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/media/images/2018/03/simple-message-system.png&quot; alt=&quot;simple-message-system&quot;&gt;&lt;/p&gt;

&lt;p&gt;å…¶ä¸­æ¶ˆè´¹è€…Aä¸æ¶ˆè´¹è€…Béƒ½è®¢é˜…äº†æ¶ˆæ¯æºAå’Œæ¶ˆæ¯æºBï¼Œè¿™ç§æ¨¡å¼å¾ˆç®€å•ï¼Œä½†æ˜¯ç›¸å¯¹æ¥è¯´ä¹Ÿæœ‰å¼Šç«¯ï¼Œæ¯”å¦‚ä»¥ä¸‹ä¸¤ç‚¹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;è¯¥æ¨¡å¼ä¸‹æ¶ˆè´¹è€…éœ€è¦å®æ—¶å»å¤„ç†æ¶ˆæ¯ï¼Œå› ä¸ºè¿™é‡Œæ¶ˆæ¯æºå’Œæ¶ˆè´¹è€…éƒ½ä¸ä¼šç»´æŠ¤ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆç»´æŠ¤ä»£ä»·å¤ªå¤§ï¼‰ï¼Œè¿™å°†ä¼šå¯¼è‡´æ¶ˆè´¹è€…è‹¥æ˜¯æš‚æ—¶æ²¡æœ‰èƒ½åŠ›æ¶ˆè´¹ï¼Œåˆ™æ¶ˆæ¯ä¼šä¸¢å¤±ï¼Œå½“ç„¶ä¹Ÿå°±ä¸èƒ½è·å¾—å†å²çš„æ¶ˆæ¯ï¼›&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯æºéœ€è¦ç»´æŠ¤åŸæœ¬ä¸å±äºå®ƒçš„å·¥ä½œï¼Œæ¯”å¦‚ç»´æŠ¤è®¢é˜…è€…ï¼ˆæ¶ˆè´¹è€…ï¼‰çš„ä¿¡æ¯ï¼Œå‘å¤šä¸ªæ¶ˆè´¹è€…å‘é€æ¶ˆæ¯ï¼Œäº¦æˆ–è€…æœ‰äº›è¿˜éœ€è¦å¤„ç†æ¶ˆæ¯åé¦ˆï¼Œè¿™æ˜¯åŸæœ¬çº¯ç²¹çš„æ¶ˆæ¯æºå°±ä¼šå˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å½“ç„¶è¿™äº›é—®é¢˜éƒ½æ˜¯å¯ä»¥æ”¹è¿›çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥åœ¨æ¶ˆæ¯æºå’Œæ¶ˆè´¹è€…ä¸­é—´å¢åŠ ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/media/images/2018/03/simple-message-queue-system.png&quot; alt=&quot;simple-message-queue-system&quot;&gt;&lt;/p&gt;

&lt;p&gt;ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œç°åœ¨æ¶ˆæ¯æºåªéœ€è¦å°†æ¶ˆæ¯å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­å°±è¡Œï¼Œè‡³äºå…¶ä»–å°±å°†ç»™æ¶ˆæ¯é˜Ÿåˆ—å»å®Œæˆï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¶ˆæ¯é˜Ÿåˆ—æŒä¹…åŒ–æ¶ˆæ¯ï¼Œä¸»åŠ¨æ¨æ¶ˆæ¯ç»™å·²ç»è®¢é˜…äº†è¯¥æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆè¿™ç§æ¨¡å¼è¿˜æœ‰ä»€ä¹ˆç¼ºç‚¹å—ï¼Ÿ&lt;/p&gt;

&lt;p&gt;ç­”æ¡ˆæ˜¯æœ‰ï¼Œä¸Šå›¾åªæ˜¯ä¸¤ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œæˆ‘ä»¬ç»´æŠ¤èµ·æ¥å¹¶ä¸å›°éš¾ï¼Œä½†æ˜¯å¦‚æœæœ‰æˆç™¾ä¸Šåƒä¸ªå‘¢ï¼Ÿé‚£ä¸å¾—ggï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæ¶ˆæ¯é˜Ÿåˆ—çš„åŠŸèƒ½éƒ½å¾ˆç±»ä¼¼ï¼Œæ— éå°±æ˜¯æŒä¹…åŒ–æ¶ˆæ¯ï¼Œæ¨é€æ¶ˆæ¯ï¼Œç»™å‡ºåé¦ˆç­‰åŠŸèƒ½ï¼Œç»“æ„ä¹Ÿéå¸¸ç±»ä¼¼ï¼Œä¸»è¦æ˜¯æ¶ˆæ¯å†…å®¹ï¼Œå½“ç„¶å¦‚æœè¦é€šç”¨åŒ–ï¼Œæ¶ˆæ¯ç»“æ„ä¹Ÿè¦å°½å¯èƒ½é€šç”¨åŒ–ï¼Œä¸å…·ä½“å¹³å°å…·ä½“è¯­è¨€æ— å…³ï¼Œæ¯”å¦‚ç”¨JSONæ ¼å¼ç­‰ï¼Œæ‰€æœ‰æˆ‘ä»¬å¯ä»¥æ¼”å˜å‡ºä»¥ä¸‹çš„æ¶ˆæ¯ç³»ç»Ÿï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/media/images/2018/03/message-system.png&quot; alt=&quot;message-system&quot;&gt;&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªæ–¹å¼çœ‹èµ·æ¥åªæ˜¯æŠŠä¸Šé¢çš„é˜Ÿåˆ—åˆå¹¶åˆ°äº†ä¸€èµ·ï¼Œå…¶å®å¹¶ä¸é‚£ä¹ˆç®€å•ï¼Œå› ä¸ºè¿™ä¸ªæ¶ˆæ¯é˜Ÿåˆ—é›†åˆè¦å…·å¤‡ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;èƒ½ç»Ÿä¸€ç®¡ç†æ‰€æœ‰çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¸æ˜¯ç‰¹æ®Šéœ€æ±‚ä¸éœ€è¦å¼€å‘è€…è‡ªå·±å»ç»´æŠ¤ï¼›&lt;/li&gt;
&lt;li&gt;é«˜æ•ˆç‡çš„å­˜å‚¨æ¶ˆæ¯ï¼›&lt;/li&gt;
&lt;li&gt;æ¶ˆè´¹è€…èƒ½å¿«é€Ÿçš„æ‰¾åˆ°æƒ³è¦æ¶ˆè´¹çš„æ¶ˆæ¯ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å½“ç„¶è¿™äº›åªæ˜¯æœ€åŸºæœ¬çš„åŠŸèƒ½ï¼Œè¿˜æœ‰æ¯”å¦‚å¤šèŠ‚ç‚¹å®¹é”™ï¼Œæ•°æ®å¤‡ä»½ç­‰ï¼Œä¸€ä¸ªå¥½çš„æ¶ˆæ¯ç³»ç»Ÿéœ€è¦å¤„ç†çš„ä¸œè¥¿éå¸¸å¤šï¼Œå¾ˆåº†å¹¸ï¼ŒKafkaå¸®æˆ‘ä»¬åšåˆ°äº†ã€‚&lt;/p&gt;

&lt;h3&gt;Kafka&lt;/h3&gt;

&lt;p&gt;åœ¨å…·ä½“äº†è§£Kafkaçš„ç»†èŠ‚å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹å®ƒçš„ä¸€äº›åŸºæœ¬æ¦‚å¿µï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Kafkaæ˜¯è¿è¡Œåœ¨ä¸€ä¸ªé›†ç¾¤ä¸Šï¼Œæ‰€ä»¥å®ƒå¯ä»¥æ‹¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡èŠ‚ç‚¹ï¼›&lt;/li&gt;
&lt;li&gt;Kafkaé›†ç¾¤å°†æ¶ˆæ¯å­˜å‚¨åœ¨ç‰¹å®šçš„æ–‡ä»¶ä¸­ï¼Œå¯¹å¤–è¡¨ç°ä¸ºTopicsï¼›&lt;/li&gt;
&lt;li&gt;æ¯æ¡æ¶ˆæ¯è®°å½•éƒ½åŒ…å«ä¸€ä¸ªkey,æ¶ˆæ¯å†…å®¹ä»¥åŠæ—¶é—´æˆ³ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä»ä¸Šé¢å‡ ç‚¹æˆ‘ä»¬å¤§è‡´å¯ä»¥æ¨æµ‹Kafkaæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æ¶ˆæ¯å­˜å‚¨ç³»ç»Ÿï¼Œé‚£ä¹ˆå®ƒå°±ä»…ä»…è¿™ä¹ˆç‚¹åŠŸèƒ½å—ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹ä¸‹é¢ã€‚&lt;/p&gt;

&lt;p&gt;Kafkaä¸ºäº†æ‹¥æœ‰æ›´å¼ºå¤§çš„åŠŸèƒ½ï¼Œæä¾›äº†å››å¤§æ ¸å¿ƒæ¥å£ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt; Producer APIå…è®¸äº†åº”ç”¨å¯ä»¥å‘Kafkaä¸­çš„topicså‘å¸ƒæ¶ˆæ¯ï¼›&lt;/li&gt;
&lt;li&gt; Consumer APIå…è®¸äº†åº”ç”¨å¯ä»¥è®¢é˜…Kafkaä¸­çš„topics,å¹¶æ¶ˆè´¹æ¶ˆæ¯ï¼›&lt;/li&gt;
&lt;li&gt; Streams APIå…è®¸åº”ç”¨å¯ä»¥ä½œä¸ºæ¶ˆæ¯æµçš„å¤„ç†è€…ï¼Œæ¯”å¦‚å¯ä»¥ä»topicAä¸­æ¶ˆè´¹æ¶ˆæ¯ï¼Œå¤„ç†çš„ç»“æœå‘å¸ƒåˆ°topicBä¸­ï¼›&lt;/li&gt;
&lt;li&gt; Connector APIæä¾›Kafkaä¸ç°æœ‰çš„åº”ç”¨æˆ–ç³»ç»Ÿé€‚é…åŠŸèƒ½ï¼Œæ¯”å¦‚ä¸æ•°æ®åº“è¿æ¥å™¨å¯ä»¥æ•è·è¡¨ç»“æ„çš„å˜åŒ–ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å®ƒä»¬ä¸Kafkaé›†ç¾¤çš„å…³ç³»å¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/media/images/2018/03/kafka-apis.png&quot; alt=&quot;kafka-apis&quot;&gt;&lt;/p&gt;

&lt;p&gt;åœ¨äº†è§£äº†Kafkaçš„ä¸€äº›åŸºæœ¬æ¦‚å¿µåï¼Œæˆ‘ä»¬å…·ä½“æ¥çœ‹çœ‹å®ƒçš„ä¸€äº›ç»„æˆéƒ¨åˆ†ã€‚&lt;/p&gt;

&lt;h4&gt;Topics&lt;/h4&gt;

&lt;p&gt;é¡¾åæ€ä¹‰Topicsæ˜¯ä¸€äº›ä¸»é¢˜çš„é›†åˆï¼Œæ›´é€šä¿—çš„è¯´Topicå°±åƒä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œç”Ÿäº§è€…å¯ä»¥å‘å…¶å†™å…¥æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…å¯ä»¥ä»ä¸­è¯»å–æ¶ˆæ¯ï¼Œä¸€ä¸ªTopicæ”¯æŒå¤šä¸ªç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…åŒæ—¶è®¢é˜…å®ƒï¼Œæ‰€ä»¥å…¶æ‰©å±•æ€§å¾ˆå¥½ã€‚Topicåˆå¯ä»¥ç”±ä¸€ä¸ªæˆ–å¤šä¸ªpartitionï¼ˆåˆ†åŒºï¼‰ç»„æˆï¼Œæ¯”å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/media/images/2018/03/log-anatomy.png&quot; alt=&quot;log-anatomy&quot;&gt;&lt;/p&gt;

&lt;p&gt;å…¶ä¸­æ¯ä¸ªpartitionä¸­çš„æ¶ˆæ¯æ˜¯æœ‰åºçš„ï¼Œä½†ç›¸äº’ä¹‹é—´çš„é¡ºåºå°±ä¸èƒ½ä¿è¯äº†ï¼Œè‹¥Topicæœ‰å¤šä¸ªpartitionï¼Œç”Ÿäº§è€…çš„æ¶ˆæ¯å¯ä»¥æŒ‡å®šæˆ–è€…ç”±ç³»ç»Ÿæ ¹æ®ç®—æ³•åˆ†é…åˆ°æŒ‡å®šåˆ†åŒºï¼Œè‹¥ä½ éœ€è¦æ‰€æœ‰æ¶ˆæ¯éƒ½æ˜¯æœ‰åºçš„ï¼Œé‚£ä¹ˆä½ æœ€å¥½åªç”¨ä¸€ä¸ªåˆ†åŒºã€‚å¦å¤–partitionæ”¯æŒæ¶ˆæ¯ä½ç§»è¯»å–ï¼Œæ¶ˆæ¯ä½ç§»æœ‰æ¶ˆè´¹è€…è‡ªèº«ç®¡ç†ï¼Œæ¯”å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/media/images/2018/03/log-consumer.png&quot; alt=&quot;log-consumer&quot;&gt;&lt;/p&gt;

&lt;p&gt;ç”±ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œä¸åŒæ¶ˆè´¹è€…å¯¹åŒä¸€åˆ†åŒºçš„æ¶ˆæ¯è¯»å–äº’ä¸å¹²æ‰°ï¼Œæ¶ˆè´¹è€…å¯ä»¥é€šè¿‡è®¾ç½®æ¶ˆæ¯ä½ç§»ï¼ˆoffsetï¼‰æ¥æ§åˆ¶è‡ªå·±æƒ³è¦è·å–çš„æ•°æ®ï¼Œæ¯”å¦‚å¯ä»¥ä»å¤´è¯»å–ï¼Œæœ€æ–°æ•°æ®è¯»å–ï¼Œé‡è¯»è¯»å–ç­‰åŠŸèƒ½ã€‚&lt;/p&gt;

&lt;p&gt;å…³äºTopicçš„åˆ†åŒºç­–ç•¥ä»¥åŠä¸æ¶ˆè´¹è€…é—´å¹³è¡¡åç»­æ–‡ç« ä¼šç»§ç»­æ·±å…¥è®²è§£ã€‚&lt;/p&gt;

&lt;h4&gt;Distribution&lt;/h4&gt;

&lt;p&gt;ä¸Šæ–‡è¯´åˆ°è¿‡ï¼ŒKafkaæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æ¶ˆæ¯ç³»ç»Ÿï¼Œæ‰€ä»¥å½“æˆ‘ä»¬é…ç½®äº†å¤šä¸ªKafka ServerèŠ‚ç‚¹åï¼Œå®ƒå°±æ‹¥æœ‰åˆ†å¸ƒå¼çš„èƒ½åŠ›ï¼Œæ¯”å¦‚å®¹é”™ç­‰ï¼Œpartitionä¼šè¢«åˆ†å¸ƒåœ¨å„ä¸ªServerèŠ‚ç‚¹ä¸Šï¼ŒåŒæ—¶å®ƒä»¬ä¸­é—´åˆæœ‰ä¸€ä¸ªleaderï¼Œå®ƒä¼šå¤„ç†æ‰€æœ‰çš„è¯»å†™è¯·æ±‚ï¼Œå…¶ä»–followersä¼šå¤åˆ¶leaderä¸Šçš„æ•°æ®ä¿¡æ¯ï¼Œä¸€æ—¦å½“leaderå› ä¸ºæŸäº›æ•…éšœè€Œæ— æ³•æä¾›æœåŠ¡åï¼Œå°±ä¼šæœ‰ä¸€ä¸ªfollowerè¢«æ¨ä¸¾å‡ºæ¥æˆä¸ºæ–°çš„leaderæ¥å¤„ç†è¿™äº›è¯·æ±‚ã€‚&lt;/p&gt;

&lt;h4&gt;Geo-Replication&lt;/h4&gt;

&lt;p&gt;å¼‚åœ°å¤‡ä»½æ˜¯ä½œä¸ºä¸»æµåˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºç¡€åŠŸèƒ½ï¼Œç”¨äºé›†ç¾¤ä¸­æ•°æ®çš„å¤‡ä»½å’Œæ¢å¤ï¼ŒKafkaåˆ©ç”¨MirrorMakeræ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œç”¨æˆ·åªéœ€ç®€å•çš„è¿›è¡Œç›¸åº”é…ç½®å³å¯ã€‚&lt;/p&gt;

&lt;h4&gt;Producers&lt;/h4&gt;

&lt;p&gt;Producersä½œä¸ºæ¶ˆæ¯çš„ç”Ÿäº§è€…ï¼Œå¯ä»¥è‡ªå·±æŒ‡å®šå°†æ¶ˆæ¯å‘å¸ƒåˆ°è®¢é˜…Topicä¸­çš„æŒ‡å®šåˆ†åŒºï¼Œç­–ç•¥å¯ä»¥è‡ªå·±æŒ‡å®šï¼Œæ¯”å¦‚è¯­ä¹‰æˆ–è€…ç»“æ„ç±»ä¼¼çš„æ¶ˆæ¯å‘å¸ƒåœ¨åŒä¸€åˆ†åŒºï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”±ç³»ç»Ÿå¾ªç¯å‘å¸ƒåœ¨æ¯ä¸€ä¸ªåˆ†åŒºä¸Šã€‚&lt;/p&gt;

&lt;h4&gt;Consumers&lt;/h4&gt;

&lt;p&gt;Consumersæ˜¯ä¸€ç¾¤æ¶ˆè´¹è€…çš„é›†åˆï¼Œå¯ä»¥ç§°ä¹‹ä¸ºæ¶ˆè´¹è€…ç»„ï¼Œæ˜¯ä¸€ç§æ›´é«˜å±‚æ¬¡çš„çš„æŠ½è±¡ï¼Œå‘Topicè®¢é˜…æ¶ˆè´¹æ¶ˆæ¯çš„å•ä½æ˜¯Consumersï¼Œå½“ç„¶å®ƒå…¶ä¸­ä¹Ÿå¯ä»¥åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…ï¼ˆconsumerï¼‰ã€‚ä¸‹é¢æ˜¯å…³äºconsumerçš„ä¸¤æ¡åŸåˆ™ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å‡å¦‚æ‰€æœ‰æ¶ˆè´¹è€…éƒ½åœ¨åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„ä¸­ï¼Œé‚£ä¹ˆå®ƒä»¬å°†ååŒæ¶ˆè´¹è®¢é˜…Topicçš„éƒ¨åˆ†æ¶ˆæ¯ï¼ˆæ ¹æ®åˆ†åŒºä¸æ¶ˆè´¹è€…çš„æ•°é‡åˆ†é…ï¼‰ï¼Œä¿å­˜è´Ÿè½½å¹³è¡¡ï¼›&lt;/li&gt;
&lt;li&gt;å‡å¦‚æ‰€æœ‰æ¶ˆè´¹è€…éƒ½åœ¨ä¸åŒçš„æ¶ˆè´¹è€…ç»„ä¸­ï¼Œå¹¶ä¸”è®¢é˜…äº†åŒä¸ªTopicï¼Œé‚£ä¹ˆå®ƒä»¬å°†å¯ä»¥æ¶ˆè´¹Topicçš„æ‰€æœ‰æ¶ˆæ¯ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå¸®åŠ©å¤§å®¶ç†è§£ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/media/images/2018/03/consumer-groups.png&quot; alt=&quot;consumer-groups&quot;&gt;&lt;/p&gt;

&lt;p&gt;ä¸Šå›¾ä¸­æœ‰ä¸¤ä¸ªServerèŠ‚ç‚¹ï¼Œæœ‰ä¸€ä¸ªTopicè¢«åˆ†ä¸ºå››ä¸ªåˆ†åŒºï¼ˆP0-P4)åˆ†åˆ«è¢«åˆ†é…åœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå¦å¤–è¿˜æœ‰ä¸¤ä¸ªæ¶ˆè´¹è€…ç»„ï¼ˆGAï¼ŒGBï¼‰ï¼Œå…¶ä¸­GAæœ‰ä¸¤ä¸ªæ¶ˆè´¹è€…å®ä¾‹ï¼ŒGBæœ‰å››ä¸ªæ¶ˆè´¹è€…å®ä¾‹ã€‚&lt;/p&gt;

&lt;p&gt;ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œé¦–å…ˆè®¢é˜…Topicçš„å•ä½æ˜¯æ¶ˆè´¹è€…ç»„ï¼Œå¦å¤–æˆ‘ä»¬å‘ç°Topicä¸­çš„æ¶ˆæ¯æ ¹æ®ä¸€å®šè§„åˆ™å°†æ¶ˆæ¯æ¨é€ç»™å…·ä½“æ¶ˆè´¹è€…ï¼Œä¸»è¦åŸåˆ™å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;è‹¥æ¶ˆè´¹è€…æ•°å°äºpartitionæ•°ï¼Œä¸”æ¶ˆè´¹è€…æ•°ä¸ºä¸€ä¸ªï¼Œé‚£ä¹ˆå®ƒå°±æ¶ˆè´¹æ‰€æœ‰æ¶ˆæ¯ï¼›&lt;/li&gt;
&lt;li&gt;è‹¥æ¶ˆè´¹è€…æ•°å°äºpartitionæ•°ï¼Œå‡è®¾æ¶ˆè´¹è€…æ•°ä¸ºNï¼Œpartitionæ•°ä¸ºMï¼Œé‚£ä¹ˆæ¯ä¸ªæ¶ˆè´¹è€…èƒ½æ¶ˆè´¹çš„åˆ†åŒºæ•°ä¸ºM/Næˆ–M/N+1ï¼›&lt;/li&gt;
&lt;li&gt;è‹¥æ¶ˆè´¹è€…æ•°ç­‰äºpartitionæ•°ï¼Œé‚£ä¹ˆæ¯ä¸ªæ¶ˆè´¹è€…éƒ½ä¼šå‡ç­‰åˆ†é…åˆ°ä¸€ä¸ªåˆ†åŒºçš„æ¶ˆæ¯ï¼›&lt;/li&gt;
&lt;li&gt;è‹¥æ¶ˆè´¹è€…æ•°å¤§äºpartitionæ•°ï¼Œåˆ™å°†ä¼šå‡ºç°éƒ¨åˆ†æ¶ˆè´¹è€…å¾—ä¸åˆ°æ¶ˆæ¯åˆ†åŒºï¼Œå‡ºç°ç©ºé—²çš„æƒ…å†µï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ€»çš„æ¥è¯´ï¼ŒKafkaä¼šæ ¹æ®æ¶ˆè´¹è€…ç»„çš„æƒ…å†µå‡è¡¡åˆ†é…æ¶ˆæ¯ï¼Œæ¯”å¦‚æœ‰æ¶ˆæ¯ç€å®ä¾‹å®•æœºï¼Œäº¦æˆ–è€…æœ‰æ–°çš„æ¶ˆè´¹è€…åŠ å…¥ç­‰æƒ…å†µã€‚&lt;/p&gt;

&lt;h4&gt;Guarantees&lt;/h4&gt;

&lt;p&gt;kafkaä½œä¸ºä¸€ä¸ªé«˜æ°´å‡†çš„ç³»ç»Ÿï¼Œæä¾›äº†ä»¥ä¸‹çš„ä¿è¯ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æ¶ˆæ¯çš„æ·»åŠ æ˜¯æœ‰åºçš„ï¼Œç”Ÿäº§è€…è¶Šæ—©å‘è®¢é˜…çš„Topicå‘é€çš„æ¶ˆæ¯ï¼Œä¼šæ›´æ—©çš„è¢«æ·»åŠ åˆ°Topicä¸­ï¼Œå½“ç„¶å®ƒä»¬å¯èƒ½è¢«åˆ†é…åˆ°ä¸åŒçš„åˆ†åŒºï¼›&lt;/li&gt;
&lt;li&gt;æ¶ˆè´¹è€…åœ¨æ¶ˆè´¹Topicåˆ†åŒºä¸­çš„æ¶ˆæ¯æ—¶æ˜¯æœ‰åºçš„ï¼›&lt;/li&gt;
&lt;li&gt;å¯¹äºæœ‰Nä¸ªå¤åˆ¶èŠ‚ç‚¹çš„Topicï¼Œç³»ç»Ÿå¯ä»¥æœ€å¤šå®¹å¿N-1ä¸ªèŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œè€Œä¸ä¸¢å¤±ä»»ä½•æäº¤ç»™è¯¥Topicçš„æ¶ˆæ¯ä¸¢å¤±ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç›¸å…³è¿™äº›ç‚¹çš„ç»†èŠ‚ï¼Œæˆ‘å‡†å¤‡å†åç»­æ–‡ç« ä¸­å†æ…¢æ…¢æ·±å…¥ã€‚&lt;/p&gt;

&lt;h3&gt;Kafka as a Messaging System&lt;/h3&gt;

&lt;p&gt;è¯´äº†è¿™ä¹ˆå¤šï¼Œå‰é¢ä¹Ÿè®²äº†æ¶ˆæ¯ç³»ç»Ÿçš„æ¼”å˜è¿‡ç¨‹ï¼Œé‚£ä¹ˆKafkaç›¸æ¯”å…¶ä»–çš„æ¶ˆæ¯ç³»ç»Ÿä¼˜åŠ¿å…·ä½“åœ¨å“ªé‡Œï¼Ÿ
ä¼ ç»Ÿçš„æ¶ˆæ¯ç³»ç»Ÿæ¨¡å‹ä¸»è¦æœ‰ä¸¤ç§ï¼šæ¶ˆæ¯é˜Ÿåˆ—å’Œå‘å¸ƒ/è®¢é˜…ã€‚&lt;/p&gt;

&lt;p&gt;1.æ¶ˆæ¯é˜Ÿåˆ—&lt;/p&gt;

&lt;p&gt;ç‰¹æ€§|æè¿°
---|---
è¡¨ç°å½¢å¼ | ä¸€ç»„æ¶ˆè´¹è€…ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ï¼Œæ¶ˆæ¯ä¼šè¢«æ¨é€ç»™ç»„ä¸­çš„æŸä¸€ä¸ªæ¶ˆè´¹è€…
ä¼˜åŠ¿ | æ°´å¹³æ‰©å±•ï¼Œå¯ä»¥å°†æ¶ˆæ¯æ•°æ®åˆ†å¼€å¤„ç†
åŠ£åŠ¿ | æ¶ˆæ¯é˜Ÿåˆ—ä¸æ˜¯å¤šç”¨æˆ·çš„ï¼Œå½“ä¸€æ¡æ¶ˆæ¯è®°å½•è¢«ä¸€ä¸ªè¿›ç¨‹è¯»å–åï¼Œæ¶ˆæ¯ä¾¿ä¼šä¸¢å¤±&lt;/p&gt;

&lt;p&gt;2.å‘å¸ƒ/è®¢é˜…&lt;/p&gt;

&lt;p&gt;ç‰¹æ€§|æè¿°
---|---
è¡¨ç°å½¢å¼ | æ¶ˆæ¯ä¼šå¹¿æ’­å‘é€ç»™æ‰€æœ‰æ¶ˆè´¹è€…
ä¼˜åŠ¿ | å¯ä»¥å¤šè¿›ç¨‹å…±äº«æ¶ˆæ¯
åŠ£åŠ¿ | æ¯ä¸ªæ¶ˆè´¹è€…éƒ½ä¼šè·å¾—æ‰€æœ‰æ¶ˆæ¯ï¼Œæ— æ³•é€šè¿‡æ·»åŠ æ¶ˆè´¹è¿›ç¨‹æé«˜å¤„ç†æ•ˆç‡&lt;/p&gt;

&lt;p&gt;ä»ä¸Šé¢ä¸¤ä¸ªè¡¨ä¸­å¯ä»¥çœ‹å‡ºä¸¤ç§ä¼ ç»Ÿçš„æ¶ˆæ¯ç³»ç»Ÿæ¨¡å‹çš„ä¼˜ç¼ºç‚¹ï¼Œæ‰€ä»¥Kafkaåœ¨å‰äººçš„è‚©è†€ä¸Šè¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¸æ”¶ä»–ä»¬çš„ä¼˜ç‚¹ï¼Œä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹ä¸¤æ–¹é¢ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;é€šè¿‡Topicæ–¹å¼æ¥è¾¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—çš„åŠŸèƒ½&lt;/li&gt;
&lt;li&gt;é€šè¿‡æ¶ˆè´¹è€…ç»„è¿™ç§æ–¹å¼æ¥è¾¾åˆ°å‘å¸ƒ/è®¢é˜…çš„åŠŸèƒ½&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Kafkaé€šè¿‡ç»“åˆè¿™ä¸¤ç‚¹ï¼ˆè¿™ä¸¤ç‚¹çš„å…·ä½“æè¿°æŸ¥çœ‹ä¸Šé¢ç« èŠ‚ï¼‰ï¼Œå®Œç¾çš„è§£å†³äº†å®ƒä»¬ä¸¤è€…æ¨¡å¼çš„ç¼ºç‚¹ã€‚&lt;/p&gt;

&lt;h3&gt;Kafka as a Storage System&lt;/h3&gt;

&lt;p&gt;å­˜å‚¨æ¶ˆæ¯ä¹Ÿæ˜¯æ¶ˆæ¯ç³»ç»Ÿçš„ä¸€å¤§åŠŸèƒ½ï¼ŒKafkaç›¸å¯¹æ™®é€šçš„æ¶ˆæ¯é˜Ÿåˆ—å­˜å‚¨æ¥è¯´ï¼Œå®ƒçš„è¡¨ç°å®åœ¨å¥½çš„å¤ªå¤šï¼Œé¦–å…ˆKafkaæ”¯æŒå†™å…¥ç¡®è®¤ï¼Œä¿è¯æ¶ˆæ¯å†™å…¥çš„æ­£ç¡®æ€§å’Œè¿ç»­æ€§ï¼ŒåŒæ—¶Kafkaè¿˜ä¼šå¯¹å†™å…¥ç£ç›˜çš„æ•°æ®è¿›è¡Œå¤åˆ¶å¤‡ä»½ï¼Œæ¥å®ç°å®¹é”™ï¼Œå¦å¤–Kafkaå¯¹ç£ç›˜çš„ä½¿ç”¨ç»“æ„æ˜¯ä¸€è‡´çš„ï¼Œå°±è¯´è¯´ä¸ç®¡ä½ çš„æœåŠ¡å™¨ç›®å‰ç£ç›˜å­˜å‚¨çš„æ¶ˆæ¯æ•°æ®æœ‰å¤šå°‘ï¼Œå®ƒæ·»åŠ æ¶ˆæ¯æ•°æ®çš„æ•ˆç‡æ˜¯ç›¸åŒçš„ã€‚&lt;/p&gt;

&lt;p&gt;Kafkaçš„å­˜å‚¨æœºåˆ¶å¾ˆå¥½çš„æ”¯æŒæ¶ˆè´¹è€…å¯ä»¥éšæ„æ§åˆ¶è‡ªèº«æ‰€éœ€è¦è¯»å–çš„æ•°æ®ï¼Œåœ¨å¾ˆå¤šæ—¶å€™ä½ ä¹Ÿå¯ä»¥å°†Kafkaä½œä¸ºä¸€ä¸ªé«˜æ€§èƒ½ï¼Œä½å»¶è¿Ÿçš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚&lt;/p&gt;

&lt;h3&gt;Kafka for Stream Processing&lt;/h3&gt;

&lt;p&gt;Kafkaä½œä¸ºä¸€ä¸ªå®Œç¾ä¸»ä¹‰ä»£è¡¨è€…ï¼Œå…‰æœ‰æ™®é€šçš„è¯»å†™ï¼Œå­˜å‚¨ç­‰åŠŸèƒ½æ˜¯ä¸å¤Ÿçš„ï¼Œå®ƒè¿˜æä¾›äº†å®æ—¶å¤„ç†æ¶ˆæ¯æµçš„æ¥å£ã€‚&lt;/p&gt;

&lt;p&gt;å¾ˆå¤šæ—¶å€™åŸå§‹çš„æ•°æ®å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œæˆ‘ä»¬æƒ³è¦çš„æ˜¯ç»è¿‡å¤„ç†åçš„æ•°æ®ç»“æœï¼Œæ¯”å¦‚é€šè¿‡ä¸€å¤©çš„æœç´¢æ•°æ®å¾—å‡ºå½“å¤©çš„æœç´¢çƒ­ç‚¹ç­‰ï¼Œä½ å¯ä»¥åˆ©ç”¨Streams APIæ¥å®ç°è‡ªå·±æƒ³è¦çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ä»è¾“å…¥Topicä¸­è·å–æ•°æ®ï¼Œç„¶åå†å‘å¸ƒåˆ°å…·ä½“çš„è¾“å‡ºTopicä¸­ã€‚&lt;/p&gt;

&lt;p&gt;Kafkaçš„æµå¤„ç†å¯ä»¥è§£å†³è¯¸å¦‚å¤„ç†æ— åºæ•°æ®ã€æ•°æ®çš„å¤æ‚è½¬æ¢ç­‰é—®é¢˜ã€‚&lt;/p&gt;

&lt;h2&gt;æ€»ç»“&lt;/h2&gt;

&lt;p&gt;æ¶ˆæ¯ä¼ é€’ã€å­˜å‚¨ã€æµå¤„ç†è¿™ä¹ˆåŠŸèƒ½å•ä¸€æ¥çœ‹ç¡®å®å¾ˆæ™®é€šï¼Œä½†å¦‚ä½•æŠŠå®ƒä»¬å®Œç¾çš„ç»“åˆåˆ°ä¸€èµ·ï¼Œå°±æ˜¯ä¸€ç§ä¼˜é›…çš„ä½“ç°ï¼ŒKafkaåšåˆ°äº†è¿™ä¸€ç‚¹ã€‚&lt;/p&gt;

&lt;p&gt;ç›¸æ¯”HDFSåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿï¼Œè™½ç„¶å®ƒèƒ½æ”¯æŒé«˜æ•ˆå­˜å‚¨å¹¶ä¸”æ‰¹å¤„ç†æ•°æ®ï¼Œä½†æ˜¯å®ƒåªæ”¯æŒå¤„ç†è¿‡å»çš„å†å²æ•°æ®ã€‚&lt;/p&gt;

&lt;p&gt;ç›¸æ¯”æ™®é€šçš„æ¶ˆæ¯ç³»ç»Ÿæ¥è¯´ï¼Œè™½ç„¶èƒ½å¤„ç†ç°åœ¨è‡³æœªæ¥çš„æ•°æ®ï¼Œä½†æ˜¯å®ƒå¹¶ä¸æ²¡æœ‰å­˜å‚¨å†å²çš„æ•°æ®ã€‚&lt;/p&gt;

&lt;p&gt;Kafkaé›†ä¼—å®¶ä¹‹æ‰€é•¿ï¼Œä½¿æ•´ä¸ªç³»ç»Ÿèƒ½å…¼é¡¾å„æ–¹é¢çš„éœ€æ±‚ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªè¯æ¥è¯´ï¼š â€œå®Œç¾â€ï¼&lt;/p&gt;

&lt;p&gt;æœ¬æ–‡ä»æ¶ˆæ¯ç³»ç»Ÿçš„æ¼”å˜è®²èµ·ï¼Œåˆ°Kafkaçš„å…·ä½“ç»„æˆï¼Œæœ€ååˆ°Kafkaçš„ä¸‰å¤§ç‰¹æ€§ï¼Œæ—¨åœ¨å¸®åŠ©å¤§å®¶èƒ½å¤Ÿå¤§æ¦‚çš„äº†è§£Kafkaæ˜¯ä»€ä¹ˆçš„ï¼Œåˆ°åº•æœ‰ä»€ä¹ˆä½œç”¨ï¼Œå½“ç„¶è¿™åªæ˜¯ä¸€ä¸ªå°ç™½çš„ç®€å•ç†è§£ï¼Œå¦‚æœ‰å†™å¾—ä¸å¯¹çš„åœ°æ–¹ï¼Œå¸Œæœ›å¤§å®¶èƒ½å¤ŸæŒ‡å‡ºï¼Œä¸èƒœæ„Ÿæ¿€ã€‚&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>MySQLé©±åŠ¨æ¶æ„è®¾è®¡</title>
   <link href="/2017/12/10/mysql-parse-architecture.html"/>
   <updated>2017-12-10T00:00:00+08:00</updated>
   <id>urn:uuid:8d2f2b63-g930-3d54-8ca7-fbgbds2a4fge</id>
   <content type="html">&lt;p&gt;ä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬è®²äº†MySQLç½‘ç»œåè®®åˆ†æï¼ŒåŒ…æ‹¬å¦‚ä½•ä¸MySQLè¿›è¡Œé€šä¿¡ï¼Œæ•°æ®åŒ…çš„æ ¼å¼ç­‰å†…å®¹ï¼Œä»Šå¤©æˆ‘ä¸»è¦ä¼šè®²è®²å¦‚ä½•è®¾è®¡ä¸€ä¸ªMySQLè§£æåŒ…ç±»åº“ï¼ˆç±»ä¼¼mysql-connector-xxxå±±å¯¨ç‰ˆ)ï¼Œæœ¬ç¯‡æ–‡ç« ä¸å…·å¤‡å®é™…ä½¿ç”¨æ„ä¹‰ï¼Œæ›´å¤šçš„æ˜¯ä¸€ç§æ¶æ„çš„è®¾è®¡çš„å°è¯•ä»¥åŠå¯ä»¥å¸®åŠ©å¤§å®¶ç†è§£ä¸€äº›ç›¸åº”ç¬¬ä¸‰æ–¹åŒ…çš„è®¾è®¡ï¼Œä¸ºæœªæ¥æ›´ä»å®¹çš„åº”å¯¹å·¥ä½œä¸­é‡åˆ°çš„é—®é¢˜ã€‚&lt;/p&gt;

&lt;h2&gt;æ–‡ç« æ¦‚è¿°&lt;/h2&gt;

&lt;p&gt;æˆ‘ä¼šä»æœ€å¼€å§‹çš„æ•°æ®åº“è¿æ¥åˆ°æœ€ç»ˆçš„æ•°æ®è·å–ä¸€ç³»åˆ—æ­¥éª¤çš„è®²è§£ï¼Œè¾…åŠ©ç¤ºä¾‹ä»£ç ç”¨Javaç¼–å†™ï¼Œæœ¬æ–‡çš„ä¸»è¦å‡ ä¸ªæ–¹é¢åˆ†åˆ«æ˜¯ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æ•°æ®åŒ…æ¨¡å‹ç±»è®¾è®¡&lt;/li&gt;
&lt;li&gt;æ•°æ®åŒ…è§£æç±»è®¾è®¡&lt;/li&gt;
&lt;li&gt;ç›¸å…³ç½‘ç»œä¼ è¾“ç±»è®¾è®¡&lt;/li&gt;
&lt;li&gt;ç›¸å…³ç¼–ç å·¥å…·ç±»è®¾è®¡&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;æ•°æ®åŒ…æ¨¡å‹ç±»è®¾è®¡&lt;/h3&gt;

&lt;p&gt;æ•°æ®åŒ…æ¨¡å‹ç±»è®¾è®¡ä¸»è¦æ˜¯å°†æ•°æ®åº“ä¼ è¾“ç»™æˆ‘ä»¬çš„æ•°æ®åŒ…è§£ææˆæˆ‘ä»¬ç¨‹åºä¸­çš„æ¨¡å‹ç±»ï¼Œå¥½æ¯”ä½ å®é™…ä¸šåŠ¡ä¸­å»ºç«‹çš„JavaBeanï¼Œè¿™äº›ç±»çš„ç»“æ„ä¾èµ–äºä¸Šä¸€ç¯‡æ–‡ç« ä¸­è§£æçš„æ•°æ®åŒ…å†…å®¹ï¼Œç›¸å…³ç»†èŠ‚è¯·å‚è€ƒä¸Šç¯‡æ–‡ç« &lt;a href=&quot;http://www.godpan.me/2017/11/10/mysql-protocol.html&quot;&gt;MySQLç½‘ç»œåè®®åˆ†æ&lt;/a&gt;,æ ¹æ®å…·ä½“çš„æ•°æ®å†…å®¹æˆ‘ä»¬å¯ä»¥æ„å»ºä»¥ä¸‹æ¨¡å‹ç±»ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;EOFï¼ˆæ ‡å¿—ç±»ï¼‰&lt;/li&gt;
&lt;li&gt;Errorï¼ˆé”™è¯¯ç±»ï¼‰&lt;/li&gt;
&lt;li&gt;Fieldï¼ˆæ•°æ®åˆ—ä¿¡æ¯ç±»ï¼‰&lt;/li&gt;
&lt;li&gt;Handshake ï¼ˆåˆå§‹åŒ–ç±»ï¼‰&lt;/li&gt;
&lt;li&gt;Okï¼ˆOkç±»ï¼‰&lt;/li&gt;
&lt;li&gt;Parameterï¼ˆé”™è¯¯ç±»ï¼‰&lt;/li&gt;
&lt;li&gt;PSOKï¼ˆé¢„å¤„ç†æ‰§è¡ŒOKç±»ï¼‰&lt;/li&gt;
&lt;li&gt;ResultSetHeaderï¼ˆæŸ¥è¯¢ç»“æœé›†å¤´éƒ¨ç±»ï¼‰&lt;/li&gt;
&lt;li&gt;RowDataï¼ˆå…·ä½“åˆ—æ•°æ®ç»“æ„ç±»ï¼‰&lt;/li&gt;
&lt;li&gt;RowDataBinaryï¼ˆBinaryæ•°æ®ç»“æ„ç±»ï¼‰&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç›¸ä¿¡çœ‹è¿‡æˆ‘å‰ç¯‡æ–‡ç« çš„åŒå­¦ï¼Œå¯¹ä¸Šé¢å¾ˆå¤šç±»åº”è¯¥æ¯”è¾ƒç†Ÿæ‚‰äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªOKä¸ºä»¥ä¸‹ç»“æ„ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;OK&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Packet&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;affectedRows&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//å½±å“è¡Œæ•°&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;insertId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//è‡ªå¢id&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;serverStatus&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//æœåŠ¡å™¨çŠ¶æ€&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//é¢å¤–ä¿¡æ¯&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å…¶ä»–ä¸€äº›ç›¸å…³ç±»çš„ç»“æ„æˆ‘è¿™è¾¹å°±ä¸åœ¨è´´å‡ºäº†ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å‚è€ƒmysql-connector-javaåŒ…æºç ï¼Œæˆ–è€…çœ‹æˆ‘çš„&lt;a href=&quot;https://github.com/godpan/java-connection-mysql&quot;&gt;githubé¡¹ç›®&lt;/a&gt;ä¹Ÿè¡Œï¼ˆæ¬ç –æœ‰ç‚¹ä¸å¥½æ„æ€...ï¼‰,è¿™éƒ¨åˆ†å†…å®¹æ˜¯æ€ä¹ˆè§£æçš„åŸºç¡€ç»“æ„ï¼Œå……åˆ†æŒæ¡æœ‰åŠ©äºåç»­çš„ç†è§£ã€‚&lt;/p&gt;

&lt;h3&gt;æ•°æ®åŒ…è§£æç±»è®¾è®¡&lt;/h3&gt;

&lt;p&gt;å‡è®¾æˆ‘ä»¬ç°åœ¨å·²ç»å†™å¥½äº†è§£æåçš„æ•°æ®åŒ…æ¨¡å‹ç±»ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆå°†æœ€åŸå§‹çš„å­—èŠ‚æ•°æ®è½¬æ¢æˆè¿™äº›ç±»å‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬åˆ†æè§£æçš„è¿‡ç¨‹ä¸­éœ€è¦å“ªäº›ä¸œè¥¿ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;éœ€è¦çŸ¥é“è§£æåŒ…çš„ç±»å‹ï¼›&lt;/li&gt;
&lt;li&gt;åŒ…çš„å¤§å°ï¼›&lt;/li&gt;
&lt;li&gt;åŒ…ç»“æ„å­—æ®µå®šä¹‰é•¿åº¦ï¼Œå½“å‰è§£ææ•°æ®å—ä½ç½®ï¼›&lt;/li&gt;
&lt;li&gt;ä¸´æ—¶Buffer&lt;/li&gt;
&lt;li&gt;è§£æç»“æœå­˜å‚¨&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è¿™äº›å…ƒç´ æ˜¯è§£æä¸»è¦çš„éœ€è¦çš„ä¸»è¦ç»“æ„ï¼Œå¯èƒ½è¿˜æœ‰ä¸€äº›å…¶ä»–çš„å†…å®¹è¿™é‡Œå°±ä¸é˜è¿°äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®¾è®¡ä¸‹é¢çš„è§£æç±»ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Parser&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;waitFor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LinkedList&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//æ¥ä¸‹å»è¦è§£æçš„åŒ…ç±»å‹&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dataIdx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//å½“å‰è§£ææ•°æ®åŒ…æ•°æ®å—çš„ç´¢å¼•&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ByteBuffer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ByteBuffer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;allocate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;65536&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//ä¸´æ—¶Buffer&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;packetSize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//åŒ…å¤§å°&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;itemSize&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//å½“å‰è§£ææ•°æ®åŒ…æ•°æ®å—çš„å¤§å°&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Packet&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;packet&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//è§£æç»“æœ&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä¸Šé¢çš„å±æ€§éƒ½æ˜¯è§£æè¿‡ç¨‹éœ€è¦åˆå§‹å€¼ï¼Œä¸­é—´å˜é‡ï¼Œç»“æœç­‰ï¼Œé™¤äº†è¿™äº›å±æ€§å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æœ‰å°†Bufferä¸­æ•°æ®è½¬æ¢ä¸ºæˆ‘ä»¬éœ€è¦æ•°æ®çš„æ–¹æ³•ï¼Œæ ¹æ®MySQLåè®®ä¸­çš„ç¼–ç æ–¹å¼ï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªæ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;readNullTerminated&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ByteBuffer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;//å¯¹åº”NullTerminatedStringï¼ˆNullç»“å°¾æ–¹å¼ï¼‰: å­—ç¬¦ä¸²ä»¥é‡åˆ°Nullä½œä¸ºç»“æŸæ ‡å¿—ï¼Œç›¸åº”çš„å­—èŠ‚ä¸º00ã€‚&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;readLengthCodedBinary&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ByteBuffer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//å¯¹åº”LengthEncodedIntegerç¼–ç æ–¹å¼ï¼Œæ ¹æ®ç¬¬ä¸€ä¸ªå­—èŠ‚åŒºåˆ†æ•°æ®æ‰€å çš„å­—èŠ‚é•¿åº¦&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;readLengthCodedString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ByteBuffer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//å¯¹åº”LengthEncodedStringç¼–ç æ–¹å¼ï¼Œå­—ç¬¦ä¸²çš„å€¼æ ¹æ®nteger + Valueç»„æˆï¼Œé€šè¿‡è®¡ç®—Integerçš„å€¼æ¥è·å–Valueçš„å…·ä½“çš„é•¿åº¦ã€‚&lt;/span&gt;
     &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;   

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æœ‰äº†ä»¥ä¸Šçš„å±æ€§å’Œç›¸åº”æ–¹æ³•åï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥å°†æœåŠ¡å™¨ä¼ æ¥æ•°æ®åŒ…è§£ææˆæˆ‘ä»¬æƒ³è¦çš„æ•°æ®äº†ã€‚&lt;/p&gt;

&lt;h3&gt;ç›¸å…³ç½‘ç»œä¼ è¾“ç±»è®¾è®¡&lt;/h3&gt;

&lt;p&gt;æ•´ç†çš„ç½‘ç»œä¼ è¾“ç±»å…¶å®å°±æ˜¯æˆ‘ä»¬å¸¸è§Connectionç±»ï¼Œå®ƒæ˜¯ç¨‹åºä¸­ä¸æ•°æ®åº“æœåŠ¡å™¨è¿›è¡Œäº¤äº’çš„æœ€é‡è¦çš„ç±»ï¼Œæˆ‘ä»¬å¯ä»¥æè¿°ä¸€ä¸‹å®ƒæœ‰ä»¥ä¸‹çš„å‡ ç‚¹åŠŸèƒ½ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;1.å»ºç«‹æ•°æ®åº“è¿æ¥ï¼›&lt;/li&gt;
&lt;li&gt;2.æ£€éªŒç”¨æˆ·ï¼Œç™»å½•ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;3.æ‰§è¡Œç›¸åº”çš„æ•°æ®åº“å‘½ä»¤ï¼Œå¢åˆ æ”¹æŸ¥ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;4.æ¥æ”¶æ•°æ®åº“ä¼ æ¥çš„æ•°æ®åŒ…ï¼Œå¹¶åˆ©ç”¨Parserç±»è¿›è¡Œè§£æï¼›&lt;/li&gt;
&lt;li&gt;5.å…³é—­æ•°æ®åº“è¿æ¥ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;åŸºäºè¿™äº›éœ€æ±‚æˆ‘ä»¬å¯ä»¥æ„å»ºå‡ºå¦‚ä¸‹çš„Connectionç±»ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MysqlConnection&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Handshake&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handshake&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//æ¡æ‰‹åˆå§‹åŒ…ç±»&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ByteBuffer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ByteBuffer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;allocate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;65536&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;Â &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//å‘é€ç»™æœåŠ¡ç«¯çš„æ•°æ®Buffer&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ByteBuffer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ByteBuffer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;allocate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;65536&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// æ¥æ”¶çš„æ•°æ®Buffer&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SocketChannel&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;channel&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//å¼‚æ­¥IOä¼ è¾“é€šé“&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Parser&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;parser&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Parser&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//è§£æç±»&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//æ•°æ®åº“æœåŠ¡å™¨host&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//æ•°æ®åº“æœåŠ¡å™¨ç«¯å£&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//æ•°æ®åº“ç”¨æˆ·å&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//æ•°æ®åº“å¯†ç &lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;database&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//è¿æ¥å…·ä½“çš„æ•°æ®åº“&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Selector&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//æ³¨å†Œchannelçš„selector&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;connectionId&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0L&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//è¿æ¥id&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¿™äº›å±æ€§ç›¸åº”å¯¹æ•°æ®åº“é©±åŠ¨ç¨å¾®æœ‰æ‰€äº†è§£çš„äººéƒ½éå¸¸ç†Ÿæ‚‰ï¼Œå› ä¸ºå¹³å¸¸å†™ç¨‹åºç»å¸¸è·Ÿä»–ä»¬æ‰“äº¤é“ï¼Œæœ‰äº†ä¸Šé¢è¿™äº›å±æ€§ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€äº›æ–¹æ³•ï¼Œæ¯”å¦‚è¿æ¥æ•°æ®åº“ï¼Œæ‰§è¡Œå‘½ä»¤ï¼Œè¯»å–æ•°æ®ï¼Œå…³é—­æ•°æ®åº“ç­‰æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥å®šä¹‰ä»¥ä¸‹çš„ä¸€äº›æ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//è¿æ¥æ•°æ®åº“&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;auth&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//æ ¡éªŒè´¦æˆ·&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;query&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//æ‰§è¡Œæ™®é€šæŸ¥è¯¢&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;update&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//æ‰§è¡Œæ™®é€šæ›´æ–°&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;    
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;executeQuery&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//æ‰§è¡Œé¢„å¤„ç†æŸ¥è¯¢&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;executeUpdate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//æ‰§è¡Œé¢„å¤„ç†æ›´æ–°&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;read&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//è¯»å–é€šé“ä¸­çš„æ•°æ®&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;send&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//å‘æœåŠ¡å™¨å‘é€æ•°æ®&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//å…³é—­æ•°æ®åº“&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¿™éƒ½æ˜¯ä¸€äº›å¿…è¦ä¸”å¸¸ç”¨çš„æ–¹æ³•ï¼Œç›¸ä¿¡å¾ˆå¤šäººåœ¨å®é™…å¼€å‘ä¸­éƒ½æœ‰æ‰€ä½¿ç”¨ï¼Œæœ‰äº†ä»¥ä¸Šçš„ä¸€äº›å±æ€§å’Œæ–¹æ³•åæˆ‘ä»¬å°±å¯ä»¥æ­å»ºå‡ºä¸€ä¸ªConnectionç±»çš„åŸºæœ¬æ¨¡å‹ï¼Œè‡³äºå…¶ä»–ä¸€äº›å¯¹è±¡ï¼Œæ¯”å¦‚æ•°æ®åº“è¿æ¥æ± ï¼Œé¢„å¤„ç†å¯¹è±¡éƒ½æ˜¯åŸºäºæœ€åŸºç¡€çš„Connectionã€‚&lt;/p&gt;

&lt;h3&gt;ç›¸å…³ç¼–ç å·¥å…·ç±»è®¾è®¡&lt;/h3&gt;

&lt;p&gt;å…¶å®ä¸Šé¢çš„ä¸€äº›ç±»ä¸æ–¹æ³•ï¼Œå·²ç»èƒ½ç»„è£…æˆä¸€ä¸ªç®€å•çš„ä¸æ•°æ®åº“äº¤äº’çš„é©±åŠ¨ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“ï¼Œæˆ‘ä»¬å‘æ•°æ®åº“æœåŠ¡å™¨å‘é€æŒ‡ä»¤çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯å‘æˆ‘ä»¬ç›´æ¥åœ¨æ•°æ®åº“ç»ˆç«¯å†™SQLæ‰§è¡Œé‚£ä¹ˆç®€å•ï¼Œè€Œæ˜¯éœ€è¦æ ¹æ®æ•°æ®åº“çš„ç›¸åº”åè®®å°†æˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„SQLç¿»è¯‘æˆç›¸åº”çš„å­—èŠ‚æµå†å‘é€ç»™æ•°æ®åº“æœåŠ¡ç«¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»æœ‰ç›¸å…³çš„ç¼–ç å·¥å…·ç±»ï¼Œæ¯”å¦‚Longç±»å‹ç¼–ç ï¼ŒNULLå€¼ç¼–ç ç­‰ç­‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å†™ç›¸åº”çš„ç¼–ç ç±»æé«˜æˆ‘ä»¬å¯¹SQLç¼–ç çš„æ•ˆç‡ï¼Œå®ƒåº”è¯¥å…·æœ‰ä»¥ä¸‹çš„åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;public static void longEncoded(){ //longç±»å‹ç¼–ç 
    ...
}

public static void nullTerminatedStringEncoded() { //nullTerminatedStringç¼–ç 
    ...
}
public static void lengthEncodedStringEncoded() { //lengthEncodedStringç¼–ç 
    ...
}

private static void dateEncoded () { //Dateç±»å‹ç¼–ç 
    ...
}

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;é€šå¸¸æ¥è¯´ï¼Œä¸Šé¢è¿™å››ç§ç¼–ç æ–¹å¼å¯ä»¥å®ç°å¤§éƒ¨åˆ†åœºæ™¯çš„SQLç¼–ç äº†ï¼Œæ–¹æ³•çš„å…·ä½“å®ç°å–å†³äºå®é™…ä¸­ç¨‹åºçš„æ•°æ®ç±»å‹å’Œç¼–ç åè®®å¯å‚è€ƒæˆ‘çš„ä¸Šä¸€ç¯‡æ–‡ç« ã€‚&lt;/p&gt;

&lt;h2&gt;æ€»ç»“&lt;/h2&gt;

&lt;p&gt;è¿™ç¯‡æ–‡ç« ä¸»è¦è®²è§£äº†å¦‚ä½•å»è®¾è®¡ä¸€ä¸ªç®€å•çš„æ•°æ®åº“é©±åŠ¨ï¼Œå®ƒæœ€åŸºæœ¬åº”è¯¥å…·å¤‡äº›ä»€ä¹ˆï¼Œå„ä¸ªæ¨¡å—é—´åˆæ˜¯æ€ä¹ˆæ­é…çš„ï¼Œè¿™äº›å†…å®¹ä¸ä»…ä»…è®©æˆ‘ä»¬äº†è§£ä¸æ•°æ®åº“é€šä¿¡çš„æ­¥éª¤ï¼Œä¹Ÿå¯ä»¥è®©æˆ‘ä»¬å¯¹ç›®å‰ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹æ•°æ®åº“é©±åŠ¨æœ‰æ›´æ·±å…¥çš„äº†è§£ï¼Œæœ€åæˆ‘ä¼šç”»ä¸€å¼ å›¾é‡Œæ¢³ç†äº†ä¸€ä¸‹æ‰€æœ‰æ¨¡å—é—´çš„è”ç³»ï¼Œå¸®åŠ©å¤§å®¶ç†è§£ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/media/images/2018/01/mysql-connection.png&quot; alt=&quot;mysql-connection&quot;&gt;&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>MySQLç½‘ç»œåè®®åˆ†æ</title>
   <link href="/2017/11/10/mysql-protocol.html"/>
   <updated>2017-11-10T00:00:00+08:00</updated>
   <id>urn:uuid:8d2f2b63-g930-3d54-8ca7-fbgbds2a4fge</id>
   <content type="html">&lt;p&gt;MySQLå¯¹å¤§å®¶æ¥è¯´ï¼Œéƒ½åº”è¯¥å¾ˆç†Ÿæ‚‰äº†ï¼Œä»å¤§å­¦é‡Œçš„è¯¾ç¨‹åˆ°å®é™…å·¥ä½œä¸­æ•°æ®çš„å­˜å‚¨æŸ¥è¯¢ï¼Œå¾ˆå¤šæ—¶å€™éƒ½éœ€è¦ç”¨åˆ°æ•°æ®åº“ï¼Œå¾ˆå¤šäººä¹Ÿå†™è¿‡ä¸æ•°æ®åº“äº¤äº’çš„ç¨‹åºï¼Œåœ¨Javaä¸­ä½ å¯èƒ½ä¸€å¼€å§‹ä¼šä½¿ç”¨åŸç”Ÿmysql-connector-javaæ¥è¿›è¡Œæ“ä½œï¼Œåæ¥ä½ ä¼šæ¥è§¦åˆ°Hibernateï¼ŒMybatisç­‰ORMæ¡†æ¶ï¼Œå…¶å®å®ƒä»¬åº•å±‚ä¹Ÿæ˜¯åŸºäºmysql-connector-javaï¼Œä½†å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¹¶ä¸æ¸…æ¥šç¨‹åºæ˜¯æ€ä¹ˆè·Ÿæ•°æ®åº“å…·ä½“äº¤äº’çš„ï¼Œæ¯”å¦‚æ‰§è¡Œä¸€ä¸ªSQLæŸ¥è¯¢ï¼Œç¨‹åºæ˜¯å¦‚ä½•ä»MySQLä¸­è·å–æ•°æ®çš„å‘¢ï¼Ÿä»Šå¤©å°±è®©æˆ‘ä»¬æ¥çœ‹çœ‹æœ€åŸºç¡€çš„MySQLç½‘ç»œåè®®åˆ†æã€‚&lt;/p&gt;

&lt;h1&gt;å¼•è¨€&lt;/h1&gt;

&lt;p&gt;é˜…è¯»æœ¬æ–‡ä¹‹å‰ä½ éœ€è¦å¯¹ç½‘ç»œåè®®éœ€è¦æœ‰åŸºæœ¬çš„äº†è§£ï¼Œæ¯”å¦‚ä¸¤å°æœºå­ä¹‹é—´çš„æ•°æ®æ˜¯å¦‚ä½•é€šä¿¡çš„ï¼Œç¡¬ä»¶å±‚å¯ä»¥æš‚æ—¶ä¸éœ€äº†è§£ï¼Œä½†ç½‘ç»œå±‚å’Œä¼ è¾“å±‚çš„åè®®è¦æœ‰ä¸€å®šçš„ç†è§£ï¼Œæ¯”å¦‚IPæ•°æ®åŒ…ï¼ŒTCP/IPåè®®ï¼ŒUDPåè®®ç­‰ç›¸å…³æ¦‚å¿µï¼Œæœ‰äº†è¿™äº›åŸºç¡€ï¼Œæœ‰åˆ©äºä½ é˜…è¯»æœ¬æ–‡ã€‚&lt;/p&gt;

&lt;h1&gt;èƒŒæ™¯&lt;/h1&gt;

&lt;p&gt;åœ¨å†å²æ‚ ä¹…çš„æ—¶ä»£ï¼Œæ•°æ®åº“åªä½œä¸ºå•æœºå­˜å‚¨ï¼Œä¹Ÿä¸æ€ä¹ˆéœ€è¦ä¸ç¨‹åºè¿›è¡Œäº¤äº’çš„æ—¶å€™çš„é¦–ï¼Œå®ƒçš„ç½‘ç»œé€šä¿¡å¹¶ä¸æ˜¯é‚£ä¹ˆé‡è¦ï¼Œä½†éšç€æ—¶ä»£çš„å‘å±•ï¼Œæ•°æ®åº“ä¸å†åªæ˜¯å•çº¯çš„ä½œä¸ºä¸€ä¸ªæ•°æ®çš„ä»“åº“äº†ï¼Œå®ƒéœ€è¦æä¾›ä¸å¤–ç•Œçš„äº¤äº’ï¼Œæ¯”å¦‚è¿œç¨‹è¿æ¥ï¼Œç¨‹åºæ“ä½œæ•°æ®åº“ç­‰ï¼Œè¿™æ—¶å€™ä¸€ä»½è§„èŒƒçš„ç½‘ç»œé€šä¿¡çš„åè®®å°±éå¸¸é‡è¦äº†ï¼Œæ¯”å¦‚å®ƒæ˜¯å¦‚ä½•æ ¡éªŒæƒé™ï¼Œå¦‚ä½•è§£æSQLè¯­å¥ï¼Œå¦‚ä½•è¿”å›æ‰§è¡Œç»“æœéƒ½éœ€è¦ç”¨åˆ°ç›¸åº”çš„åè®®ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¹¶ä¸éœ€è¦æ¥è§¦è¿™äº›å†…å®¹ï¼Œå› ä¸ºå®ƒå¤ªåº•å±‚äº†ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨æŠŠå®ƒä»¬å°è£…å¥½çš„ç¬¬ä¸‰æ–¹åŒ…å°±å¯ä»¥äº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å»å­¦ä¹ å®ƒçš„ç½‘ç»œåè®®å‘¢ï¼Ÿç¡®å®å¯¹äºä¸€å¼€å§‹å­¦ä¹ ç¼–ç¨‹çš„äººæ¥è¯´ï¼Œè¿™æœ‰ç‚¹æ“ä¹‹è¿‡æ€¥ï¼Œåè€Œæœ‰æ—¶å€™ä¼šé€‚å¾—å…¶åï¼Œä½†å½“ä½ å¯¹è¿™ä¸€æ–¹é¢æœ‰äº†ä¸€å®šçš„äº†è§£ä¹‹åï¼Œä½ ä¾¿ä¼šè¿«ä¸åŠå¾…å¾—æƒ³å»æ¢ç´¢æ›´æ·±å±‚çš„å¥¥ç§˜ï¼Œå»äº†è§£å¹¶å­¦ä¹ æˆ‘ä»¬å¹³å¸¸ç”¨çš„ç¬¬ä¸‰æ–¹ç±»åº“æ˜¯æ€ä¹ˆå»å®ç°ï¼Œæ˜ç™½å®ƒçš„åº•å±‚åŸç†ï¼Œç”šè‡³å¯¹ä¸€äº›è«åå…¶å¦™çš„bugä¹Ÿä¸ä¼šå†å®³æ€•ã€‚&lt;/p&gt;

&lt;h1&gt;MySQLè¿æ¥æ–¹å¼&lt;/h1&gt;

&lt;p&gt;åˆ†æåè®®ï¼Œæˆ‘ä»¬é¦–å…ˆè¦äº†è§£å¦‚ä½•ä¸æ•°æ®åº“è¿æ¥ï¼Œè¯´åˆ°MySQLè¿æ¥æ–¹å¼ï¼Œå¤§å®¶çªç„¶å¯èƒ½æœ‰ç‚¹æ‡µï¼Œå…¶å®å®ƒä¸€ç›´ä¼´éšç€æˆ‘ä»¬ï¼Œæ¯”å¦‚æˆ‘ä»¬ç¬¬ä¸€æ¬¡è£…æ•°æ®åº“å®Œæˆåæ‰§è¡Œçš„ç¬¬ä¸€æ¬¡ç™»å½•ï¼Œæ¯”å¦‚ä½ æ²¡æœ‰è®¾ç½®å¯†ç ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span class=&quot;n&quot;&gt;mysql&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uroot&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¿™æ˜¯æœ€åŸºæœ¬çš„ä¸€ç§æ•°æ®åº“è¿æ¥æ–¹å¼ï¼Œé‚£ä¹ˆMySQLè¿æ¥æ–¹å¼åˆ°åº•æœ‰å‡ ç§å‘¢ï¼Ÿåˆ°MySQL5.7ä¸ºæ­¢ï¼Œæ€»å…±æœ‰äº”ç§ï¼Œåˆ†åˆ«æ˜¯TCP/IPï¼ŒTLS/SSLï¼ŒUnix Socketsï¼ŒShared Memoryï¼ŒNamed pipesï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹è¿™äº”ç§çš„åŒºåˆ«ï¼š&lt;/p&gt;

&lt;p&gt;æ–¹å¼|é»˜è®¤å¼€å¯|æ”¯æŒç³»ç»Ÿ|åªæ”¯æŒæœ¬æœº|å¦‚ä½•å¼€å¯|å‚æ•°é…ç½®
---|---|---|---|---|---
TCP/IP | æ˜¯ | æ‰€æœ‰ç³»ç»Ÿ | å¦ |--skip-networking=yes/no. | --port&lt;br&gt;--bind-address
TLS/SSL | æ˜¯ | æ‰€æœ‰ç³»ç»Ÿï¼ˆåŸºäºTCP/IP)ä¹‹ä¸Š | å¦ |--ssl=yes/no. | --ssl-* options
Unix Sockets | æ˜¯ | ç±»Unixç³»ç»Ÿ | æ˜¯ | è®¾ç½®--socket=&lt;empty\&gt; æ¥å…³é—­. | --socket=socket path
Shared Memory | å¦ | Windowsç³»ç»Ÿ | æ˜¯ |--shared-memory=on/off. | --shared-memory-base-name=&lt;name\&gt;
Named pipes | å¦ | Windowsç³»ç»Ÿ | å¦ |--enable-named-pipe=on/off. |  --socket=&lt;name\&gt;&lt;/p&gt;

&lt;p&gt;ä»ä¸Šè¡¨ä¸­æˆ‘ä»¬å¯ä»¥æ¸…æ™°çœ‹å‡ºæ¯ç§è¿æ¥æ–¹å¼çš„åŒºåˆ«ï¼Œæ¥ä¸‹é‡Œæˆ‘ä¼šå…·ä½“è¯´æ˜å‡ ç§è¿æ¥æ˜¯æ€ä¹ˆæ“ä½œçš„ï¼Œç”±äºæˆ‘çš„æœºå­æ˜¯Mac OSç³»ç»Ÿï¼Œè¿™é‡Œåªæ¨¡æ‹ŸéWindowsç³»ç»Ÿä¸‹çš„ä¸‰ç§æ–¹å¼,å› ä¸ºè¿™ä¸‰ç§æ–¹å¼éƒ½æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œæˆ‘ä»¬ä¸éœ€è¦è¿›è¡Œä»»ä½•é…ç½®ï¼š&lt;/p&gt;

&lt;h2&gt;1.Unix Socketsï¼š&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span class=&quot;n&quot;&gt;mysql&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uroot&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è‹¥ä½ åœ¨æœ¬æœºä½¿ç”¨è¿™ç§æ–¹å¼è¿æ¥MySQLæ•°æ®åº“çš„è¯ï¼Œå®ƒé»˜è®¤ä¼šä½¿ç”¨Unix Socketsã€‚&lt;/p&gt;

&lt;h2&gt;2.TCP/IPï¼š&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span class=&quot;n&quot;&gt;mysql&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;--protocol=tcp -uroot&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;mysql&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;P3306&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h127&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uroot&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¿æ¥çš„æ—¶å€™æˆ‘ä»¬æŒ‡å®šè¿æ¥åè®®ï¼Œæˆ–è€…æŒ‡å®šç›¸åº”çš„IPåŠç«¯å£ï¼Œæˆ‘ä»¬çš„è¿æ¥æ–¹å¼å°±å˜æˆäº†TCP/IPæ–¹å¼ã€‚&lt;/p&gt;

&lt;h2&gt;3.TLS/SSLï¼š&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span class=&quot;n&quot;&gt;mysql&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;--protocol=tcp -uroot --ssl=on&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;mysql&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;P3306&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;h127&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uroot&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;--ssl=on&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä¸Šè¡¨è¯´è¿‡ï¼ŒTLS/SSLæ˜¯åŸºäºTCP/IPçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€å†æŒ‡å®šæ‰“å¼€sslé…ç½®å³å¯ã€‚&lt;/p&gt;

&lt;p&gt;ç„¶åæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹è¯­å¥æ¥æŸ¥è¯¢ç›®å‰æ•°æ®åº“çš„è¿æ¥æƒ…å†µï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;DISTINCT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;connection_type&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;performance_schema&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;threads&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;where&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;connection_type&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•é€‰æ‹©è¿æ¥æ–¹å¼å‘¢ï¼Ÿä¸ªäººæ€»ç»“äº†ä»¥ä¸‹å‡ ä¸ªåŸåˆ™ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;è‹¥æ˜¯ä½ èƒ½ç¡®å®šç¨‹åºå’Œæ•°æ®åº“åœ¨åŒä¸€å°æœºå­(ç±»Unixç³»ç»Ÿ)ä¸Šï¼Œæ¨èä½¿ç”¨Unix Socketsï¼Œå› ä¸ºå®ƒæ•ˆç‡æ›´é«˜ï¼›&lt;/li&gt;
&lt;li&gt;è‹¥æ•°æ®åº“åˆ†å¸ƒåœ¨ä¸åŒçš„æœºå­ä¸Šï¼Œä¸”èƒ½ç¡®ä¿è¿æ¥å®‰å…¨æˆ–è€…å®‰å…¨æ€§è¦æ±‚ä¸æ˜¯é‚£ä¹ˆé«˜ï¼Œæ¨èä½¿ç”¨TCP/IPï¼Œåä¹‹ä½¿ç”¨TLS/SSLï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;h1&gt;MySQLæ•°æ®åŒ…&lt;/h1&gt;

&lt;p&gt;é€šä¿¡ä¸­æœ€é‡è¦çš„å°±æ˜¯æ•°æ®ï¼Œé‚£ä¹ˆç¨‹åºæ˜¯å¦‚ä½•å’ŒMySQL Serverè¿›è¡Œé€šä¿¡ï¼Œå¹¶äº¤äº’æ•°æ®çš„å‘¢ï¼Ÿæ¯”å¦‚å¦‚ä½•éªŒè¯è´¦æˆ·ï¼Œå‘é€æŸ¥è¯¢è¯­å¥ï¼Œè¿”å›æ‰§è¡Œç»“æœç­‰ï¼Œæˆ‘å…ˆç”»ä¸€ä¸ªæµç¨‹å›¾æ¥æ¨¡æ‹Ÿä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹ï¼Œå¸®åŠ©å¤§å®¶ç†è§£ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/media/images/2017/11/mysql-process.png&quot; alt=&quot;mysql-process&quot;&gt;&lt;/p&gt;

&lt;p&gt;æ•´ä¸ªè¿‡ç¨‹ç›¸å¯¹æ¥è¯´è¿˜æ˜¯æ¯”è¾ƒæ¸…æ™°çš„ï¼Œæˆ‘ä»¬å¯¹è¿æ¥è¯·æ±‚å’Œæ–­å¼€è¯·æ±‚ä¸éœ€è¦è¿‡åˆ†å…³å¿ƒï¼Œåªéœ€è¦äº†è§£è¿™ä¸€ç‚¹å°±å¯ä»¥äº†ï¼Œé‡è¦çš„æ˜¯å…¶ä»–å‡ ç‚¹ï¼Œé‚£ä¹ˆåœ¨è¿™å‡ æ­¥ä¸­ï¼Œæ•°æ®æ˜¯æ€ä¹ˆè¿›è¡Œäº¤äº’çš„å‘¢ï¼Ÿ&lt;/p&gt;

&lt;p&gt;å…¶å®ä¸»è¦å°±æ˜¯ä¸¤æ­¥ï¼Œ&lt;strong&gt;Clientå°†æ‰§è¡Œå‘½ä»¤ç¼–ç æˆServerè¦æ±‚çš„æ ¼å¼ä¼ è¾“ç»™Serverç«¯æ‰§è¡Œï¼ŒServerç«¯å°†æ‰§è¡Œç»“æœä¼ è¾“ç»™Clientç«¯ï¼ŒClientç«¯å†æ ¹æ®ç›¸åº”çš„æ•°æ®åŒ…æ ¼å¼è§£æè·å¾—æ‰€éœ€çš„æ•°æ®&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;h2&gt;1.åŸºæœ¬æ•°æ®ç±»å‹&lt;/h2&gt;

&lt;p&gt;è™½ç„¶ç½‘ç»œä¸­çš„æ•°æ®æ˜¯ç”¨å­—èŠ‚ä¼ è¾“çš„ï¼Œä½†å®ƒèƒŒåçš„æ•°æ®æºéƒ½æ˜¯æœ‰ç±»å‹çš„æ•°æ®ï¼ŒMySQLåè®®ä¹Ÿæœ‰åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œå¥½æ¯”Javaä¸­çš„8ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼Œä½†MySQLåè®®ä¸­ç®€å•çš„å¤šï¼Œå®ƒåªæœ‰ä¸¤ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼Œåˆ†åˆ«ä¸ºInteger(æ•´å‹)ï¼ŒString(å­—ç¬¦ä¸²)ï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹è¿™ä¸¤ç§ç±»å‹ã€‚&lt;/p&gt;

&lt;h3&gt;Integer(æ•´å‹)&lt;/h3&gt;

&lt;p&gt;é¦–å…ˆIntegeråœ¨MySQLåè®®ä¸­æœ‰ä¸¤ç§ç¼–ç æ–¹å¼ï¼Œåˆ†åˆ«ä¸ºFixedLengthIntegerå’ŒLengthEncodedInteger
,å…¶ä¸­å‰è€…ç”¨äºå­˜å‚¨æ— ç¬¦å·å®šé•¿æ•´æ•°ï¼Œå®é™…ä¸­ä½¿ç”¨çš„ä¸å¤šï¼Œè¿™é‡Œç€é‡è®²ä¸€ä¸‹åè€…ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨LengthEncodedIntegerç¼–ç çš„æ•´æ•°å¯èƒ½ä¼šä½¿ç”¨1, 3, 4, æˆ–è€…9 ä¸ªå­—èŠ‚ï¼Œå…·ä½“ä½¿ç”¨å­—èŠ‚å–å†³äºæ•°å€¼çš„å¤§å°ï¼Œä¸‹è¡¨æ˜¯ä¸åŒçš„æ•°æ®é•¿åº¦çš„æ•´æ•°æ‰€ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼š&lt;/p&gt;

&lt;p&gt;æœ€å°å€¼ï¼ˆåŒ…å«ï¼‰|æœ€å¤§å€¼ï¼ˆä¸åŒ…å«ï¼‰|å­˜å‚¨æ–¹å¼
---|---|---|
0 |251| 1ä¸ªå­—èŠ‚
251 |2^16| 3ä¸ªå­—èŠ‚(0xFC + 2ä¸ªå­—èŠ‚å…·ä½“æ•°æ®)
2^16 |2^24| 4ä¸ªå­—èŠ‚(0xFD + 3ä¸ªå­—èŠ‚å…·ä½“æ•°æ®)
2^24 |2^64| 9ä¸ªå­—èŠ‚(0xFE + 8ä¸ªå­—èŠ‚å…·ä½“æ•°æ®)&lt;/p&gt;

&lt;p&gt;ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¯”å¦‚1024çš„ç¼–ç ä¸ºï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;0xFC 0x00 0x04
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å…¶ä¸­0xä»£è¡¨16è¿›åˆ¶ï¼Œå®é™…æ•°æ®ä¼ è¾“ä¸­å¹¶æ²¡æœ‰è¯¥æ ‡è¯†ï¼Œç¬¬ä¸€ä½ä»£è¡¨è¿™æ˜¯ä¸€ä¸ª251~2^16ä¹‹é—´çš„æ•°å€¼ï¼Œæ‰€ä»¥åé¢ä¸¤ä½ä¸ºæ•°å€¼å…·ä½“çš„å€¼ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯å°ç«¯å­—èŠ‚åºï¼ŒMySQLé»˜è®¤ä½¿ç”¨çš„ä¹Ÿæ˜¯è¿™ç§ç¼–ç æ¬¡åºï¼Œæ‰€ä»¥è¿™é‡Œ1024æ˜¯0x00 0x04ï¼Œå­—èŠ‚åºç›¸å…³çŸ¥è¯†å¯ä»¥å‚è€ƒï¼š&lt;a href=&quot;https://www.ruanyifeng.com/blog/2016/11/byte-order.html&quot;&gt;ç†è§£å­—èŠ‚åº&lt;/a&gt;ï¼Œåˆ°è¿™é‡Œå¤§å®¶åº”è¯¥å¯¹è¿™ç§ç¼–ç æ ¼å¼æœ‰äº†ä¸€å®šçš„äº†è§£äº†ï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹Stringã€‚&lt;/p&gt;

&lt;h3&gt;String(å­—ç¬¦ä¸²)&lt;/h3&gt;

&lt;p&gt;Stringçš„ç¼–ç æ ¼å¼ç›¸å¯¹Integeræ¥è¯´ä¼šå¤æ‚ä¸€ç‚¹ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;FixedLengthStringï¼ˆå®šé•¿æ–¹å¼ï¼‰ï¼šéœ€å…ˆçŸ¥é“Stringçš„é•¿åº¦ï¼ŒMySQLä¸­çš„ä¸€ä¸ªä¾‹å­å°±æ˜¯ERR_PacketåŒ…ï¼ˆåç»­ä¼šè®²åˆ°ï¼‰å°±ä½¿ç”¨äº†è¿™ç§ç¼–ç æ–¹å¼ï¼Œå› ä¸ºå®ƒçš„é•¿åº¦å›ºå®šï¼Œç”¨5ä¸ªå­—èŠ‚å­˜å‚¨æ‰€æœ‰æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;NullTerminatedStringï¼ˆNullç»“å°¾æ–¹å¼ï¼‰: å­—ç¬¦ä¸²ä»¥é‡åˆ°Nullä½œä¸ºç»“æŸæ ‡å¿—ï¼Œç›¸åº”çš„å­—èŠ‚ä¸º00ã€‚&lt;/li&gt;
&lt;li&gt;VariableLengthStringï¼ˆåŠ¨æ€è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦æ–¹å¼ï¼‰: å­—ç¬¦ä¸²çš„é•¿åº¦å–å†³äºå…¶ä»–å˜é‡è®¡ç®—è€Œå®šï¼Œæ¯”å¦‚ä¸€ä¸ªå­—ç¬¦ä¸²ç”±Integer + Valueç»„æˆï¼Œæˆ‘ä»¬é€šè¿‡è®¡ç®—Integerçš„å€¼æ¥è·å–Valueçš„å…·ä½“çš„é•¿åº¦ã€‚&lt;/li&gt;
&lt;li&gt;LengthEncodedStringï¼ˆæŒ‡å®šå­—ç¬¦ä¸²é•¿åº¦æ–¹å¼ï¼‰ï¼š ä¸VariableLengthStringåŸç†ç›¸ä¼¼ï¼Œæ˜¯å®ƒçš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå…·ä½“ä¾‹å­å°±æ˜¯æˆ‘ä¸Šæ¡ä¸¾çš„è¿™ä¸ªä¾‹å­ã€‚&lt;/li&gt;
&lt;li&gt;RestOfPacketStringï¼ˆåŒ…æœ«ç«¯å­—ç¬¦ä¸²æ–¹å¼ï¼‰ï¼šä¸€ä¸ªåŒ…æœ«ç«¯çš„å­—ç¬¦ä¸²ï¼Œå¯æ ¹æ®åŒ…çš„æ€»é•¿åº¦é‡‘å’Œå½“å‰ä½ç½®å¾—åˆ°å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå®é™…ä¸­å¹¶ä¸å¸¸ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ€»çš„æ¥è¯´Stringçš„ç¼–ç æ ¼å¼ç§ç±»ç›¸å¯¹æ¯”è¾ƒå¤šï¼Œä¸åŒæ–¹å¼ä¹‹é—´çš„åŒºåˆ«ä¹Ÿæ¯”è¾ƒå¤§ï¼Œè‹¥è¦æ·±åˆ»ç†è§£è¿˜éœ€ä»å®é™…çš„ä¾‹å­é‡Œå»å­¦ä¹ ï¼Œåç»­æ–‡ç« ä¸­æˆ‘ä¼šå†™å‡ ä¸ªdemoå¸¦å¤§å®¶ä¸€èµ·å»æ¢ç´¢ã€‚&lt;/p&gt;

&lt;h2&gt;2.åŸºæœ¬æ•°æ®åŒ…æ ¼å¼&lt;/h2&gt;

&lt;p&gt;æ•°æ®åŒ…æ ¼å¼ä¹Ÿä¸»è¦åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯Serverç«¯å‘Clientç«¯å‘é€çš„æ•°æ®åŒ…æ ¼å¼ï¼Œå¦ä¸€ç§åˆ™æ˜¯Clientå‘Serverç«¯å‘é€çš„æ•°æ®åŒ…ã€‚&lt;/p&gt;

&lt;h3&gt;Server to Client&lt;/h3&gt;

&lt;p&gt;Serverå‘Clientå‘é€çš„æ•°æ®åŒ…æœ‰ä¸¤ä¸ªåŸåˆ™ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æ¯ä¸ªæ•°æ®åŒ…å¤§å°ä¸èƒ½è¶…è¿‡2^24å­—èŠ‚(16MB);&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªæ•°æ®åŒ…å‰éƒ½éœ€è¦åŠ ä¸Šæ•°æ®åŒ…ä¿¡æ¯ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ¯ä¸ªåŒ…çš„åŸºæœ¬æ ¼å¼ï¼š&lt;/p&gt;

&lt;p&gt;Type |Name|Description
---|---|---|
int&lt;3&gt; |payload&lt;em&gt;length(åŒ…æ•°æ®é•¿åº¦)| å…·ä½“æ•°æ®åŒ…çš„å†…å®¹é•¿åº¦ï¼Œä»å‡ºå»å¤´éƒ¨å››ä¸ªå­—èŠ‚åå¼€å§‹çš„å†…å®¹
int&lt;1&gt; |sequence&lt;/em&gt;id(åŒ…åºåˆ—id)| æ¯ä¸ªåŒ…çš„åºåˆ—idï¼Œæ€»æ•°æ®å†…å®¹å¤§äº16MBæ—¶éœ€è¦ç”¨ï¼Œä»0å¼€å§‹ï¼Œä¾æ¬¡å¢åŠ ï¼Œæ–°çš„å‘½ä»¤æ‰§è¡Œä¼šé‡è½½ä¸º0
string |payload(å…·ä½“æ•°æ®)| åŒ…ä¸­é™¤å»å¤´éƒ¨åçš„å…·ä½“æ•°æ®å†…å®¹&lt;/p&gt;

&lt;p&gt;ä¸¾ä¸ªåˆ—å­ï¼š&lt;/p&gt;

&lt;p&gt;ä¾‹å­ |è§£é‡Š
---|---|
    01 00 00 00 01| &lt;li&gt;payload&lt;em&gt;length: 1&lt;/li&gt; &lt;li&gt;sequence&lt;/em&gt;id: 0x00&lt;/li&gt;&lt;li&gt;payload: 0x01&lt;/li&gt;&lt;/p&gt;

&lt;p&gt;è‹¥æ˜¯æ•°æ®å†…å®¹å¤§äºæˆ–è€…ç­‰äº2^24-1ä¸ªå­—èŠ‚ï¼Œå°†ä¼šæ‹†åˆ†å‘é€ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚å‘é€16 777 215 (2^24-1) å­—èŠ‚çš„å†…å®¹ï¼Œåˆ™ä¼šæŒ‰ä¸€ä¸‹è¿™ç§æ–¹å¼å‘é€ &lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;ff ff ff 00 ...
00 00 00 01
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªæ•°æ®åŒ…æ»¡è½½ï¼Œç¬¬äºŒä¸ªæ•°æ®åŒ…æ˜¯ä¸€ä¸ªç©ºæ•°æ®åŒ…ï¼ˆä¸€ç§ä¸´ç•Œæƒ…å†µï¼‰ã€‚&lt;/p&gt;

&lt;h3&gt;Client to Server&lt;/h3&gt;

&lt;p&gt;Clientå‘Serverç«¯å‘é€çš„æ ¼å¼ç›¸å¯¹æ¥è¯´å°±ç®€å•ä¸€ç‚¹äº†&lt;/p&gt;

&lt;p&gt;Type |Name|Description
---|---|---|
int&lt;1&gt; |æ‰§è¡Œå‘½ä»¤| æ‰§è¡Œçš„æ“ä½œï¼Œæ¯”å¦‚åˆ‡æ¢æ•°æ®åº“ï¼ŒæŸ¥è¯¢è¡¨ç­‰æ“ä½œ
string |å‚æ•°| å‘½ä»¤ç›¸åº”çš„å‚æ•°&lt;/p&gt;

&lt;p&gt;å‘½ä»¤åˆ—è¡¨ï¼ˆæ‘˜æŠ„è‡ªèƒ¡æ¡ƒå¤¹å­çš„åšå®¢ï¼‰ï¼š&lt;/p&gt;

&lt;p&gt;ç±»å‹å€¼ |å‘½ä»¤|åŠŸèƒ½
---|---|---|
0x00|    COM&lt;em&gt;SLEEP|   ï¼ˆå†…éƒ¨çº¿ç¨‹çŠ¶æ€)
0x01|    COM&lt;/em&gt;QUIT |   å…³é—­è¿æ¥
0x02|    COM&lt;em&gt;INIT&lt;/em&gt;DB | åˆ‡æ¢æ•°æ®åº“&lt;br&gt;
0x03|    COM&lt;em&gt;QUERY   |SQLæŸ¥è¯¢è¯·æ±‚ 
0x04|   COM&lt;/em&gt;FIELD&lt;em&gt;LIST|  è·å–æ•°æ®è¡¨å­—æ®µä¿¡æ¯&lt;br&gt;
0x05|    COM&lt;/em&gt;CREATE&lt;em&gt;DB |  åˆ›å»ºæ•°æ®åº“
0x06|    COM&lt;/em&gt;DROP&lt;em&gt;DB| åˆ é™¤æ•°æ®åº“&lt;br&gt;
0x07|    COM&lt;/em&gt;REFRESH| æ¸…é™¤ç¼“å­˜&lt;br&gt;
0x08|   COM&lt;em&gt;SHUTDOWN |   åœæ­¢æœåŠ¡å™¨ 
0x09|    COM&lt;/em&gt;STATISTICS|  è·å–æœåŠ¡å™¨ç»Ÿè®¡ä¿¡æ¯ 
0x0A|    COM&lt;em&gt;PROCESS&lt;/em&gt;INFO|    è·å–å½“å‰è¿æ¥çš„åˆ—è¡¨
0x0B|    COM&lt;em&gt;CONNECT| ï¼ˆå†…éƒ¨çº¿ç¨‹çŠ¶æ€)
0x0C|    COM&lt;/em&gt;PROCESS&lt;em&gt;KILL|    ä¸­æ–­æŸä¸ªè¿æ¥
0x0D|    COM&lt;/em&gt;DEBUG|   ä¿å­˜æœåŠ¡å™¨è°ƒè¯•ä¿¡æ¯ 
0x0E|    COM&lt;em&gt;PING|    æµ‹è¯•è¿é€šæ€§ 
0x0F|    COM&lt;/em&gt;TIME|    ï¼ˆå†…éƒ¨çº¿ç¨‹çŠ¶æ€ï¼‰ 
0x10|    COM&lt;em&gt;DELAYED&lt;/em&gt;INSERT|  ï¼ˆå†…éƒ¨çº¿ç¨‹çŠ¶æ€ï¼‰&lt;br&gt;
0x11|    COM&lt;em&gt;CHANGE&lt;/em&gt;USER| é‡æ–°ç™»é™†ï¼ˆä¸æ–­è¿æ¥ï¼‰
0x12|    COM&lt;em&gt;BINLOG&lt;/em&gt;DUMP| è·å–äºŒè¿›åˆ¶æ—¥å¿—ä¿¡æ¯
0x13|    COM&lt;em&gt;TABLE&lt;/em&gt;DUMP|  è·å–æ•°æ®è¡¨ç»“æ„ä¿¡æ¯
0x14|    COM&lt;em&gt;CONNECT&lt;/em&gt;OUT| ï¼ˆå†…éƒ¨çº¿ç¨‹çŠ¶æ€)
0x15|    COM&lt;em&gt;REGISTER&lt;/em&gt;SLAVE|  ä»æœåŠ¡å™¨å‘ä¸»æœåŠ¡å™¨è¿›è¡Œæ³¨å†Œ 
0x16|    COM&lt;em&gt;STMT&lt;/em&gt;PREPARE|    é¢„å¤„ç†SQLè¯­å¥ 
0x17|    COM&lt;em&gt;STMT&lt;/em&gt;EXECUTE|    æ‰§è¡Œé¢„å¤„ç†è¯­å¥ 
0x18|    COM&lt;em&gt;STMT&lt;/em&gt;SEND&lt;em&gt;LONG&lt;/em&gt;DATA| å‘é€BLOBç±»å‹çš„æ•°æ® 
0x19|    COM&lt;em&gt;STMT&lt;/em&gt;CLOSE|  é”€æ¯é¢„å¤„ç†è¯­å¥ 
0x1A|    COM&lt;em&gt;STMT&lt;/em&gt;RESET|  æ¸…é™¤é¢„å¤„ç†è¯­å¥å‚æ•°ç¼“å­˜ 
0x1B|    COM&lt;em&gt;SET&lt;/em&gt;OPTION|  è®¾ç½®è¯­å¥é€‰é¡¹&lt;br&gt;
0x1C|    COM&lt;em&gt;STMT&lt;/em&gt;FETCH|  è·å–é¢„å¤„ç†è¯­å¥çš„æ‰§è¡Œç»“æœ &lt;/p&gt;

&lt;p&gt;è¿™é‡Œè·ä¸€ä¸ªå¸¸è§çš„çš„ä¾‹å­ï¼Œæ¯”å¦‚åˆ‡æ¢æ•°æ®åº“ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-mysql&quot; data-lang=&quot;mysql&quot;&gt;use godpan
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ç›¸åº”çš„æŠ¥æ–‡æ ¼å¼åˆ™ä¸ºï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;0x02 0x67 0x6f 0x64 0x70 0x61 0x6e
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å…¶ä¸­0x02ä»£è¡¨åˆ‡æ¢æ•°æ®åº“å‘½ä»¤ï¼Œåé¢çš„å­—èŠ‚åˆ™ä¸ºgodpançš„16è¿›åˆ¶è¡¨è¾¾ã€‚&lt;/p&gt;

&lt;h2&gt;æ•°æ®åŒ…ç±»å‹&lt;/h2&gt;

&lt;p&gt;æœ‰äº†ä»¥ä¸Šçš„åŸºç¡€ï¼Œæˆ‘ä»¬åŸºæœ¬çŸ¥é“çš„ä¸MySQLé€šä¿¡ä¹‹é—´çš„æ–¹å¼ä»¥åŠæ•°æ®æ ¼å¼ï¼Œé‚£ä¹ˆä¸å…¶é€šä¿¡é—´åˆ°åº•æœ‰å“ªå‡ ç§æ•°æ®åŒ…å‘¢ï¼Ÿæ¥ä¸‹å»çš„å†…å®¹æ˜¯å»ºç«‹åœ¨MySQL4.1ç‰ˆæœ¬ä»¥åï¼Œä¹‹å‰ç‰ˆæœ¬çš„æ•°æ®åŒ…ç±»å‹è¿™é‡Œä¸å†è®ºè¿°ã€‚&lt;/p&gt;

&lt;p&gt;è¿™é‡Œä¸»è¦åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œç¬¬ä¸€ä¸ªé˜¶æ®µæ˜¯æ•°æ®åº“è´¦æˆ·è®¤è¯é˜¶æ®µï¼Œç¬¬äºŒä¸ªé˜¶æ®µåˆ™æ˜¯æ‰§è¡Œå…·ä½“å‘½ä»¤é˜¶æ®µï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å‰è€…ã€‚&lt;/p&gt;

&lt;h3&gt;æ•°æ®åº“è´¦æˆ·è®¤è¯é˜¶æ®µ&lt;/h3&gt;

&lt;p&gt;è¿™ä¸ªé˜¶æ®µå°±æ˜¯æˆ‘ä»¬å¹³å¸¸æ‰€è¯´çš„ç™»å½•ï¼Œä¸»è¦æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;1.Clientä¸Serverè¿›è¡Œè¿æ¥&lt;/li&gt;
&lt;li&gt;2.Serverå‘Clientå‘é€Handshake packet&lt;/li&gt;
&lt;li&gt;3.Clientä¸Serverå‘é€Auth packet&lt;/li&gt;
&lt;li&gt;4.Serverå‘Clientå‘é€OK packetæˆ–è€…ERR packet&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è¿™é‡Œæˆ‘ä»¬æ¥çœ‹ä¸€çœ‹ä¸Šé¢çš„Handshake packetå’ŒAuth packetï¼ŒOK packetå’ŒERR packetæ”¾åœ¨å¦ä¸€ä¸ªé˜¶æ®µå†™ã€‚&lt;/p&gt;

&lt;h4&gt;Handshake packet&lt;/h4&gt;

&lt;p&gt;Handshake packetæ˜¯ç”±Serverå‘Clientå‘é€çš„åˆå§‹åŒ–åŒ…ï¼Œå› ä¸ºæ‰€æœ‰ä»Serverå‘Clientç«¯å‘é€çš„åŒ…éƒ½æ˜¯ä¸€æ ·çš„æ ¼å¼ï¼Œæ‰€ä»¥å‰é¢çš„å››ä¸ªå­—èŠ‚æ˜¯åŒ…å¤´ï¼Œå‰ä¸‰ä½ä»£è¡¨Handshake packetå…·ä½“å†…å®¹çš„æ•°æ®ï¼Œå¦å¤–åŒ…åºåˆ—å·ä¸º0ï¼Œå¾ˆæ˜¾ç„¶è¿™ä¸ªåŒ…å†…å®¹å°äº16MBï¼Œä¸‹é¢æ˜¯Handshake packetå…·ä½“å†…å®¹çš„æ ¼å¼ï¼š&lt;/p&gt;

&lt;p&gt;ç›¸å¯¹åŒ…å†…å®¹çš„ä½ç½® |é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰|åç§°|æè¿°
---|---|---|---
0 | 1 | åè®®ç‰ˆæœ¬ |åè®®ç‰ˆæœ¬çš„ç‰ˆæœ¬å·ï¼Œé€šå¸¸ä¸º10ï¼ˆ0x0Aï¼‰
1 | len = strlen (server_version) + 1 | æ•°æ®åº“ç‰ˆæœ¬ | ä½¿ç”¨å‰é¢çš„NullTerminatedStringæ ¼å¼ç¼–ç ï¼Œé•¿åº¦ä¸ºæ•°æ®åº“ç‰ˆæœ¬å­—ç¬¦ä¸²çš„é•¿åº¦åŠ ä¸Šæ ‡ç¤ºç»“æŸçš„çš„ä¸€ä¸ªå­—èŠ‚
len + 1 | 4 | çº¿ç¨‹ID |æ­¤æ¬¡è¿æ¥MySQL Serverå¯åŠ¨çš„çº¿ç¨‹ID
len + 5 | 8 + 1ï¼ˆ0x00è¡¨ç¤ºç»“æŸ) | æŒ‘æˆ˜éšæœºæ•°ï¼ˆç¬¬ä¸€éƒ¨åˆ†ï¼‰ |ç”¨äºåç»­è´¦æˆ·å¯†ç éªŒè¯
len + 14 | 2 | åè®®åå•† | ç”¨äºä¸å®¢æˆ·ç«¯åå•†é€šè®¯æ–¹å¼
len + 16 | 1 | ç¼–ç æ ¼å¼ |æ ‡è¯†æ•°æ®åº“ç›®å‰çš„ç¼–ç æ–¹å¼
len + 17 | 2 | æœåŠ¡å™¨çŠ¶æ€ |ç”¨äºè¡¨ç¤ºæœåŠ¡å™¨çŠ¶æ€ï¼Œæ¯”å¦‚æ˜¯å¦æ˜¯äº‹åŠ¡æ¨¡å¼æˆ–è€…è‡ªåŠ¨æäº¤æ¨¡å¼
len + 19 | 13 | ä¿ç•™å­—èŠ‚ |æœªæ¥å¯èƒ½ä¼šç”¨åˆ°ï¼Œé¢„ç•™å­—èŠ‚
len + 32 | 12 + 1ï¼ˆ0x00è¡¨ç¤ºç»“æŸ) | æŒ‘æˆ˜éšæœºæ•°ï¼ˆç¬¬äºŒéƒ¨åˆ†ï¼‰ |ç”¨äºåç»­è´¦æˆ·å¯†ç éªŒè¯&lt;/p&gt;

&lt;p&gt;ä¸Šè¡¨å°±æ˜¯æ•´ä¸ªHandshake packetçš„è¿™ä¸ªåŒ…ç»“æ„ï¼Œå±æ€§çš„å«ä¹‰ä»¥åŠè§„èŒƒéƒ½æœ‰ç›¸åº”çš„è¯´æ˜ï¼Œä¸‹é¢æ˜¯æˆ‘æœ¬æœºè§£æçš„æŸæ¬¡è¿æ¥æ•°æ®åº“çš„Handshake packetåŒ…ï¼Œä»…ä¾›å‚è€ƒï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;{protocolVersion=10, serverVersion='5.7.13', threadId=4055, scramble=[49, 97, 80, 3, 35, 118, 45, 15, 5, 118, 9, 11, 124, 93, 93, 5, 31, 47, 111, 109, 0, 0, 0, 0, 0], serverCapabilities=65535, serverLanguage=33, serverStatus=2}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;Auth packet&lt;/h4&gt;

&lt;p&gt;Auth packetæ˜¯ç”±Clientå‘Serverå‘é€çš„è®¤è¯åŒ…ï¼Œç”¨äºéªŒè¯æ•°æ®åº“è´¦æˆ·ç™»å½•ï¼Œç›¸åº”å†…å®¹çš„æ ¼å¼ï¼š&lt;/p&gt;

&lt;p&gt;ç›¸å¯¹åŒ…å†…å®¹çš„ä½ç½® |é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰|åç§°|æè¿°
---|---|---|---
0 | 4 | åè®®åå•† | ç”¨äºä¸æœåŠ¡ç«¯åå•†é€šè®¯æ–¹å¼
4 | 4 | æ¶ˆæ¯æœ€é•¿é•¿åº¦ | å®¢æˆ·ç«¯å¯ä»¥å‘é€æˆ–æ¥æ”¶çš„æœ€é•¿é•¿åº¦ï¼Œ0è¡¨ç¤ºä¸åšä»»ä½•é™åˆ¶
8 | 1 | å­—ç¬¦ç¼–ç  | å®¢æœç«¯å­—ç¬¦ç¼–ç æ–¹å¼
9 | 23 | ä¿ç•™å­—èŠ‚ | æœªæ¥å¯èƒ½ä¼šç”¨åˆ°ï¼Œé¢„ç•™å­—èŠ‚ï¼Œç”¨0ä»£æ›¿
    32 |ä¸å®š| è®¤è¯å­—ç¬¦ä¸² | ä¸»è¦æœ‰ä¸‰éƒ¨åˆ†å†…å®¹&lt;br&gt; &lt;li&gt;ç”¨æˆ·åï¼šNullTerminatedStringæ ¼å¼ç¼–ç &lt;/li&gt;&lt;li&gt;åŠ å¯†åçš„å¯†ç ï¼šLengthEncodedStringæ ¼å¼ç¼–ç &lt;/li&gt;&lt;li&gt;æ•°æ®åº“åç§°ï¼ˆå¯é€‰ï¼‰ï¼šNullTerminatedStringæ ¼å¼ç¼–ç &lt;/li&gt;&lt;/p&gt;

&lt;p&gt;è¿™éƒ¨åˆ†å†…å®¹æ˜¯ç”±å®¢æˆ·ç«¯è‡ªå·±ç”Ÿæˆï¼Œæ‰€ä»¥è¯´å¦‚æœæˆ‘ä»¬å¦‚æœè¦å†™ä¸€ä¸ªç¨‹åºè¿æ¥æ•°æ®åº“ï¼Œé‚£ä¹ˆè¿™ä¸ªåŒ…å°±å¾—æŒ‰ç…§è¿™ä¸ªæ ¼å¼ï¼Œä¸ç„¶æœåŠ¡ç«¯å°†ä¼šæ— æ³•è¯†åˆ«ã€‚&lt;/p&gt;

&lt;h3&gt;å‘½ä»¤æ‰§è¡Œé˜¶æ®µ&lt;/h3&gt;

&lt;p&gt;åœ¨æˆ‘ä»¬æ­£ç¡®è¿æ¥æ•°æ®åº“åï¼Œæˆ‘ä»¬å°±è¦æ‰§è¡Œç›¸åº”çš„å‘½ä»¤äº†ï¼Œæ¯”å¦‚åˆ‡æ¢æ•°æ®åº“ï¼Œæ‰§è¡ŒCRUDæ“ä½œç­‰ï¼Œè¿™ä¸ªé˜¶æ®µä¸»è¦åˆ†ä¸ºä¸¤æ­¥ï¼ŒClientå‘é€å‘½ä»¤ï¼ˆä¸Šæ–‡å·²ç»ç»™å‡ºï¼Œä¸‹é¢ä¸å†è®¨è®ºï¼‰ï¼ŒServerç«¯æ¥æ”¶å‘½ä»¤æ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œæˆ‘ä»¬ä¸»è¦å…³å¿ƒServerç«¯å‘æˆ‘ä»¬å‘é€æ•°æ®åŒ…ï¼Œå¯åˆ†ä¸º4ç±»å’Œä¸€ä¸ªæœ€åŸºç¡€çš„æŠ¥æ–‡ç»“æ„Data Fieldï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Data Fieldï¼šåŒ…æ•°æ®çš„ä¸€ä¸ªåŸºç¡€ç»“æ„ï¼›&lt;/li&gt;
&lt;li&gt;OKåŒ…(åŒ…æ‹¬PREPARE_OK)ï¼šServerç«¯å‘é€æ­£ç¡®å¤„ç†ä¿¡æ¯çš„åŒ…ï¼ŒåŒ…å¤´æ ‡è¯†ä¸º0x00ï¼›&lt;/li&gt;
&lt;li&gt;ErroråŒ…ï¼š Serverç«¯å‘é€é”™è¯¯ä¿¡æ¯çš„åŒ…ï¼ŒåŒ…å¤´æ ‡è¯†ä¸º0xFFï¼›&lt;/li&gt;
&lt;li&gt;EOFåŒ…ï¼šç”¨äºServerå‘Clientå‘é€ç»“æŸåŒ…ï¼ŒåŒ…å¤´æ ‡è¯†ä¸º0xFEï¼›&lt;/li&gt;
&lt;li&gt;Result SetåŒ…ï¼šç”¨äºServerå‘Clientå‘é€çš„æŸ¥è¯¢ç»“æœåŒ…ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;h4&gt;Data Field&lt;/h4&gt;

&lt;p&gt;Data Fieldæ˜¯Serverå›åº”åŒ…é‡Œçš„ä¸€ä¸ªæ ¸å¿ƒï¼Œä¸»è¦æ˜¯æ•°æ®çš„ä¸€ç§ç¼–ç ç»“æ„ï¼Œè·Ÿæˆ‘ä¹‹å‰è®²çš„LengthEncodedIntegerå’ŒLengthEncodedStringå¾ˆç±»ä¼¼ï¼Œä¹Ÿä¸»è¦åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†&lt;/p&gt;

&lt;p&gt;æœ€å°æ•°æ®é•¿åº¦ï¼ˆåŒ…å«ï¼‰|æœ€å¤§æ•°æ®é•¿åº¦ï¼ˆä¸åŒ…å«ï¼‰|æ•°æ®é•¿åº¦|æ ¼å¼
---|---|---|
1 |251| 1ä¸ªå­—èŠ‚|1å­—èŠ‚ + å…·ä½“æ•°æ®
251 |2^16| 2ä¸ªå­—èŠ‚ | 0xFC + 2ä¸ªå­—èŠ‚æ•°æ®é•¿åº¦ + å…·ä½“æ•°æ®
2^16 |2^24| 4ä¸ªå­—èŠ‚ | 0xFD + 4ä¸ªå­—èŠ‚æ•°æ®é•¿åº¦ + å…·ä½“æ•°æ®
2^24 |2^64| 8ä¸ªå­—èŠ‚ | 0xFE + 8ä¸ªå­—èŠ‚æ•°æ®é•¿åº¦ + å…·ä½“æ•°æ®
NULL | NULL | 0ä¸ªå­—èŠ‚ | 0xFB&lt;/p&gt;

&lt;p&gt;è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯å¦‚æœå‡ºç°0xFBï¼ˆ251ï¼‰å¼€å¤´è¯´æ˜è¿™ä¸ªæ•°æ®å¯¹åº”çš„æ˜¯MySQLä¸­çš„NULLã€‚&lt;/p&gt;

&lt;h4&gt;OK åŒ…&lt;/h4&gt;

&lt;p&gt;æ™®é€šçš„OKåŒ…ï¼ˆPREPARE_OKåŒ…åé¢ä¼šè®²åˆ°ï¼‰ä¼šåœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µä¸‹äº§ç”Ÿï¼Œç”±Serverå‘é€ç»™ç›¸åº”çš„æ¥æ”¶æ–¹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;COM_PING: è¿æ¥æˆ–è€…æµ‹è¯•æ•°æ®åº“&lt;/li&gt;
&lt;li&gt;COM_QUERYï¼š ä¸éœ€è¦æŸ¥è¯¢ç»“æœé›†çš„æ“ä½œï¼Œæ¯”å¦‚INSERT, UPDATE, or ALTER TABLE&lt;/li&gt;
&lt;li&gt;COM_REFRESHï¼š æ•°æ®åˆ·æ–°&lt;/li&gt;
&lt;li&gt;COM&lt;em&gt;REGISTER&lt;/em&gt;SLAVEï¼š æ³¨å†Œä»æœåŠ¡å™¨&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;OK åŒ…çš„ä¸»è¦ç»“æ„ï¼š&lt;/p&gt;

&lt;p&gt;ç›¸å¯¹åŒ…å†…å®¹çš„ä½ç½® |é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰|åç§°|æè¿°
---|---|---|---
0 | 1 | åŒ…å¤´æ ‡è¯† |0x00 ä»£è¡¨è¿™æ˜¯ä¸€ä¸ªOK åŒ…
1 | rows&lt;em&gt;len | å½±å“è¡Œæ•° | ç›¸åº”æ“ä½œå½±å“çš„è¡Œæ•°ï¼Œæ¯”å¦‚ä¸€ä¸ªUpdateæ“ä½œçš„è®°å½•æ˜¯5æ¡ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼å°±ä¸º5
1 + rows&lt;/em&gt;len | id&lt;em&gt;len | è‡ªå¢id |æ’å…¥ä¸€æ¡è®°å½•æ—¶ï¼Œå¦‚æœæ˜¯è‡ªå¢idçš„è¯ï¼Œè¿”å›çš„idå€¼
1 + rows&lt;/em&gt;len + id&lt;em&gt;len | 2 | æœåŠ¡å™¨çŠ¶æ€ |ç”¨äºè¡¨ç¤ºæœåŠ¡å™¨çŠ¶æ€ï¼Œæ¯”å¦‚æ˜¯å¦æ˜¯äº‹åŠ¡æ¨¡å¼æˆ–è€…è‡ªåŠ¨æäº¤æ¨¡å¼
3 + rows&lt;/em&gt;len + id&lt;em&gt;len | 2 | è­¦å‘Šæ•° |ä¸Šæ¬¡å‘½ä»¤å¼•èµ·çš„è­¦å‘Šæ•°
5 + rows&lt;/em&gt;len + id&lt;em&gt;len | msg&lt;/em&gt;len | é¢å¤–ä¿¡æ¯ |æ­¤æ¬¡æ“ä½œçš„ä¸€äº›é¢å¤–ä¿¡æ¯&lt;/p&gt;

&lt;p&gt;ä¸‹é¢æ˜¯æˆ‘æœ¬æœºè§£æçš„æŸæ¬¡æ­£ç¡®è¿æ¥æ•°æ®åº“åçš„OK packetåŒ…ï¼Œä»…ä¾›å‚è€ƒï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;OK{affectedRows=0, insertId=0, serverStatus=2, message='....'}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;Error åŒ…&lt;/h4&gt;

&lt;p&gt;é¡¾åæ€ä¹‰Error åŒ…å°±æ˜¯å½“å‡ºç°é”™è¯¯çš„æ—¶å€™è¿”å›çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è´¦æˆ·éªŒè¯ä¸é€šè¿‡ï¼ŒæŸ¥è¯¢å‘½ä»¤ä¸åˆæ³•ï¼Œéç©ºå­—æ®µæœªæŒ‡å®šå€¼ç­‰ç›¸å…³æ“ä½œï¼ŒServerç«¯éƒ½ä¼šå‘Clientç«¯å‘é€Error åŒ…ã€‚&lt;/p&gt;

&lt;p&gt;Error åŒ…çš„ä¸»è¦ç»“æ„ï¼š&lt;/p&gt;

&lt;p&gt;ç›¸å¯¹åŒ…å†…å®¹çš„ä½ç½® |é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰|åç§°|æè¿°
---|---|---|---
0 | 1 | åŒ…å¤´æ ‡è¯† |0xFF ä»£è¡¨è¿™æ˜¯ä¸€ä¸ªError åŒ…
1 | 2 | é”™è¯¯ä»£ç  |è¯¥é”™è¯¯çš„ç›¸åº”é”™è¯¯ä»£ç 
3 | 1 | æ ‡è¯†ä½ |SQLæ‰§è¡ŒçŠ¶æ€æ ‡è¯†ä½ï¼Œç”¨&amp;#39;#&amp;#39;è¿›è¡Œæ ‡è¯†
4 | 5 | æ‰§è¡ŒçŠ¶æ€ |SQLçš„å…·ä½“æ‰§è¡ŒçŠ¶æ€
9 | msg_len | é”™è¯¯ä¿¡æ¯ |å…·ä½“çš„é”™è¯¯ä¿¡æ¯&lt;/p&gt;

&lt;p&gt;æ¯”å¦‚æˆ‘ä»¬ç°åœ¨å·²ç»è¿æ¥äº†æ•°æ®åº“ï¼Œæ‰§è¡Œ&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;use test_database;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä½†æ˜¯æˆ‘ä»¬æ•°æ®åº“ä¸­å¹¶æ²¡æœ‰test_databaseè¿™ä¸ªæ•°æ®åº“ï¼Œæˆ‘ä»¬å°†ä¼šå¾—åˆ°ç›¸åº”çš„é”™è¯¯ä¿¡æ¯ï¼Œä¸‹é¢æ˜¯æˆ‘æœ¬æœºè§£æçš„Error packetåŒ…ï¼Œä»…ä¾›å‚è€ƒï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;Error{errno=1046, sqlState='3D000', message='No database selected'}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;EOF Packet&lt;/h4&gt;

&lt;p&gt;EOF Packetæ˜¯ç”¨äºæ ‡è¯†æŸä¸ªé˜¶æ®µæ•°æ®ç»“æŸçš„æ ‡å¿—åŒ…ï¼Œä¼šåœ¨ä¸€ä¸‹å‡ ç§æƒ…å†µä¸­äº§ç”Ÿï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ç»“æœé›†ä¸­å­—æ®µä¿¡æ¯ç»“æŸçš„æ—¶å€™ï¼›&lt;/li&gt;
&lt;li&gt;ç»“æœé›†ä¸­åˆ—ä¿¡æ¯ç»“æŸçš„æ—¶å€™ï¼›&lt;/li&gt;
&lt;li&gt;æœåŠ¡å™¨ç¡®è®¤åœæ­¢æœåŠ¡çš„æ—¶å€™ï¼›&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯å‘é€COM&lt;em&gt;SET&lt;/em&gt;OPTION and COM_DEBUGå‘½ä»¤åï¼ŒæœåŠ¡å™¨å›åº”çš„æ—¶å€™ï¼›&lt;/li&gt;
&lt;li&gt;æœåŠ¡å™¨è¯·æ±‚ä½¿ç”¨MySQL4.1ç‰ˆæœ¬ä¹‹å‰çš„è®¤è¯æ–¹å¼çš„æ—¶å€™ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;EOF åŒ…çš„ä¸»è¦ç»“æ„ï¼š&lt;/p&gt;

&lt;p&gt;ç›¸å¯¹åŒ…å†…å®¹çš„ä½ç½® |é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰|åç§°|æè¿°
---|---|---|---
0 | 1 | åŒ…å¤´æ ‡è¯† |0xFE ä»£è¡¨è¿™æ˜¯ä¸€ä¸ªEOF åŒ…
1 | 2 | è­¦å‘Šæ•° |ä¸Šæ¬¡å‘½ä»¤å¼•èµ·çš„è­¦å‘Šæ•°
3 | 2 | æœåŠ¡å™¨çŠ¶æ€ &lt;/p&gt;

&lt;p&gt;è¿™é‡Œè¦æ³¨æ„çš„ä¸€ç‚¹ï¼Œæˆ‘ä»¬ä¸Šé¢åˆ†æäº†Data Fieldçš„ç»“æ„ï¼Œå‘ç°å®ƒæ˜¯ç”¨0xFEä½œä¸ºé•¿åº¦éœ€è¦8ä¸ªå­—èŠ‚ç¼–ç å€¼å¾—æ ‡è¯†å¤´ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨åˆ¤æ–­ä¸€ä¸ªåŒ…æ˜¯å¦æ˜¯EOF åŒ…çš„æ—¶å€™ï¼Œéœ€è¦ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æ ‡è¯†å¤´ï¼ˆç¬¬ä¸€ä¸ªå­—èŠ‚ï¼‰ä¸º0xFEï¼›&lt;/li&gt;
&lt;li&gt;åŒ…çš„æ€»é•¿åº¦å°äº9ä¸ªå­—èŠ‚ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;h4&gt;Result SetåŒ…&lt;/h4&gt;

&lt;p&gt;Result SetåŒ…äº§ç”Ÿäºæˆ‘ä»¬æ¯æ¬¡æ•°æ®åº“æ‰§è¡Œéœ€è¦è¿”å›ç»“æœé›†çš„æ—¶å€™ï¼ŒServerç«¯å‘é€ç»™æˆ‘ä»¬çš„åŒ…ï¼Œæ¯”å¦‚å¹³å¸¸çš„SELECT,SHOWç­‰å‘½ä»¤ï¼ŒResult SetåŒ…ç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹äº”ä¸ªæ–¹é¢ï¼š&lt;/p&gt;

&lt;p&gt;å†…å®¹ |å«ä¹‰
---|---
Result Set Header | è¿”å›æ•°æ®çš„åˆ—æ•°é‡
Field | è¿”å›æ•°æ®çš„åˆ—ä¿¡æ¯ï¼ˆå¤šä¸ªï¼‰
EOF   | åˆ—ç»“æŸ
Row Data | è¡Œæ•°æ®ï¼ˆå¤šä¸ªï¼‰
EOF | æ•°æ®ç»“æŸ&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬é€ä¸ªæ¥åˆ†æï¼Œé¦–å…ˆæˆ‘ä»¬æ¥çœ‹Result Set Headerã€‚&lt;/p&gt;

&lt;h5&gt;Result Set Header&lt;/h5&gt;

&lt;p&gt;Result Set Headerè¡¨ç¤ºè¿”å›æ•°æ®çš„åˆ—æ•°é‡ä»¥åŠä¸€äº›é¢å¤–çš„ä¿¡æ¯ï¼Œå…¶ä¸»è¦ç»“æ„ä¸ºï¼š&lt;/p&gt;

&lt;p&gt;é•¿åº¦ |å«ä¹‰
---|---
1-9å­—èŠ‚ | æ•°æ®çš„åˆ—æ•°é‡ï¼ˆLengthEncodedIntegerç¼–ç æ ¼å¼ï¼‰
1-9å­—èŠ‚ | é¢å¤–ä¿¡æ¯ï¼ˆLengthEncodedIntegerç¼–ç æ ¼å¼ï¼‰&lt;/p&gt;

&lt;h5&gt;Field&lt;/h5&gt;

&lt;p&gt;Fieldè¡¨ç¤ºResult Setä¸­æ•°æ®åˆ—çš„å…·ä½“ä¿¡æ¯ï¼Œå¯å‡ºç°å¤šæ¬¡ï¼Œå…·ä½“æ¬¡æ•°å–å†³äºResult Set Headerä¸­æ•°æ®çš„åˆ—æ•°é‡ï¼Œå®ƒçš„ä¸»è¦ç»“æ„ä¸ºï¼š&lt;/p&gt;

&lt;p&gt;é•¿åº¦ |å«ä¹‰
---|---
4 | é€šå¸¸ä¸ºASCIIzå­—ç¬¦ä¸²def
n | æ•°æ®åº“åç§°ï¼ˆData Fieldï¼‰
n | å‡å¦‚æŸ¥è¯¢æŒ‡å®šäº†è¡¨åˆ«åï¼Œå°±æ˜¯è¡¨åˆ«åï¼ˆData Fieldï¼‰
n | åŸå§‹çš„è¡¨åï¼ˆData Fieldï¼‰
n | å‡å¦‚æŸ¥è¯¢æŒ‡å®šäº†åˆ—åˆ«åï¼Œå°±æ˜¯åˆ—åˆ«åï¼ˆData Fieldï¼‰
n | åŸå§‹çš„åˆ—åï¼ˆData Fieldï¼‰
1 | æ ‡è¯†ä½ï¼Œé€šå¸¸ä¸º12ï¼Œè¡¨ç¤ºæ¥ä¸‹å»çš„12ä¸ªå­—èŠ‚æ˜¯å…·ä½“çš„fieldå†…å®¹
2 | fieldçš„ç¼–ç 
4 | fieldçš„é•¿åº¦
1 | fieldçš„ç±»å‹
2 | fieldçš„æ ‡è¯†
2 | fieldå€¼çš„çš„å°æ•°ç‚¹ç²¾åº¦
2 | é¢„ç•™å­—èŠ‚
n | å¯é€‰å…ƒç´ ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è¡¨ç¤ºè¯¥fieldçš„é»˜è®¤å€¼&lt;/p&gt;

&lt;p&gt;å…¶ä¸­fieldçš„ç±»å‹ä¸æ ‡è¯†å…·ä½“å®šä¹‰å’Œå¯¹åº”å˜é‡å«ä¹‰å¯å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š&lt;a href=&quot;http://hutaow.com/blog/2013/11/06/mysql-protocol-analysis/#428-com_shutdown&quot;&gt;MySQLåè®®åˆ†æ&lt;/a&gt;&lt;/p&gt;

&lt;h5&gt;EOF åŒ…&lt;/h5&gt;

&lt;p&gt;è¿™é‡Œçš„EOFåŒ…æ˜¯æ ‡è¯†è¿™åˆ—ä¿¡æ¯çš„ç»“æŸï¼Œå…·ä½“ç»“æ„ä¿¡æ¯å‚è€ƒä¸Šé¢çš„EOFåŒ…è§£é‡Šã€‚&lt;/p&gt;

&lt;h5&gt;Row Data&lt;/h5&gt;

&lt;p&gt;Row Dataå«ç€çš„æ˜¯æˆ‘ä»¬éœ€è¦è·å–çš„æ•°æ®ï¼Œä¸€ä¸ªResult SetåŒ…é‡Œé¢åŒ…å«ç€å¤šä¸ªRow Dataç»“æ„(å¾—åˆ°çš„æ•°æ®å¯èƒ½å¤šè¡Œ)ï¼Œæ¯ä¸ªRow Dataä¸­åŒ…å«ç€å¤šä¸ªå­—æ®µå€¼ï¼Œå®ƒä»¬ä¹‹é—´æ²¡æœ‰é—´éš”ï¼Œæ¯”å¦‚æˆ‘ä»¬ç°åœ¨æŸ¥è¯¢åˆ°çš„æ•°æ®ä¸ºï¼ˆid: 1, name: godpan) é‚£ä¹ˆRow Dataå†…å®¹ä¸ºï¼ˆ1ï¼Œgodpan),è¿™ä¸¤ä¸ªå€¼æ˜¯è¿åœ¨ä¸€èµ·çš„ï¼Œå¯¹åº”çš„å€¼éƒ½ç”¨LengthEncodedStringç¼–ç ã€‚&lt;/p&gt;

&lt;h5&gt;EOF åŒ…&lt;/h5&gt;

&lt;p&gt;ç­‰å¾…Row Dataå‘é€å®Œä¹‹åï¼ŒServeræœ€åä¼šå‘Clientç«¯å‘é€ä¸€ä¸ªEOFåŒ…ï¼Œæ ‡è¯†æ‰€æœ‰çš„è¡Œæ•°æ®å·²ç»å‘é€å®Œæ¯•ã€‚&lt;/p&gt;

&lt;h4&gt;PREPARE_OKåŒ…&lt;/h4&gt;

&lt;p&gt;PREPARE&lt;em&gt;OKåŒ…äº§ç”Ÿåœ¨Clientç«¯å‘Serverå‘é€é¢„å¤„ç†SQLè¯­å¥ï¼ŒServerè¿›è¡Œæ­£ç¡®å›åº”çš„æ—¶å€™ï¼Œå¤§å®¶å†™å†™Javaçš„æ—¶å€™è‚¯å®šç”¨è¿‡PreparedStatementï¼Œè¿™é‡ŒPreparedStatementçš„åŠŸèƒ½å°±æ˜¯è¿›è¡ŒSQLçš„é¢„å¤„ç†ï¼Œé¢„å¤„ç†çš„ä¼˜ç‚¹æ¯”è¾ƒå¤šï¼Œæ¯”å¦‚æ•ˆç‡é«˜ï¼Œé˜²SQLæ³¨å…¥ç­‰ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±å»å­¦ä¹ ä¸‹ã€‚ä¸‹é¢æ˜¯PREPARE&lt;/em&gt;OKåŒ…çš„ç»“æ„ï¼š&lt;/p&gt;

&lt;p&gt;é•¿åº¦ |å«ä¹‰
---|---
1 | 0x00ï¼ˆæ ‡è¯†æ˜¯ä¸€ä¸ªOKåŒ…ï¼‰
4 | statement&lt;em&gt;handler&lt;/em&gt;idï¼ˆé¢„å¤„ç†è¯­å¥idï¼‰
2 | number of columns in result setï¼ˆç»“æœé›†ä¸­åˆ—çš„æ•°é‡ï¼‰
2 | number of parameters in queryï¼ˆæŸ¥è¯¢è¯­å¥ä¸­å‚æ•°çš„æ•°é‡ï¼‰
1 | 0x00 (å¡«å……å€¼)
2 | è­¦å‘Šæ•°&lt;/p&gt;

&lt;p&gt;æ¯”å¦‚æˆ‘ç°åœ¨æ‰§æ‰§è¡Œä¸‹é¢çš„è¯­å¥ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;n&quot;&gt;PreparedStatement&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ps&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;connection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;prepareStatement&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;SELECT * FROM `godpan_fans` where id=?&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ps&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setInteger&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ps&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;executeQuery&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¾—åˆ°ä¸‹é¢çš„PREPARE_OKåŒ…ï¼Œä»…ä¾›å‚è€ƒï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;PSOK{statementId=1, columns=5, parameters=1}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¦‚æœä¸Šé¢çš„columnså¤§äº0ï¼Œä»¥åŠparameterså¤§äº0ï¼Œåˆ™å°†æœ‰é¢å¤–çš„ä¸¤ä¸ªåŒ…ä¼ è¾“ï¼Œåˆ†åˆ«æ˜¯columnsçš„ä¿¡æ¯ä»¥åŠparametersçš„ä¿¡æ¯ï¼Œå¯¹åº”ä¿¡æ¯ç»“æ„ï¼š&lt;/p&gt;

&lt;p&gt;å†…å®¹ |å«ä¹‰
---|---
Field | columnsä¿¡æ¯ï¼ˆå¤šä¸ªï¼‰
EOF   | columnsä¿¡æ¯ç»“æŸ
Field | parametersï¼ˆå¤šä¸ªï¼‰
EOF | parametersç»“æŸ&lt;/p&gt;

&lt;p&gt;åˆ°æ­¤æ•´ä¸ªPREPARE_OKåŒ…å‘é€å®Œæ¯•ã€‚&lt;/p&gt;

&lt;h4&gt;Row Data Binary&lt;/h4&gt;

&lt;p&gt;è¿™ä¸ªåŒ…è·Ÿä¸Šé¢æåˆ°çš„Row DataåŒ…æœ‰ä»€ä¹ˆå·®åˆ«å‘¢ï¼Ÿä¸»è¦æœ‰ä¸¤ç‚¹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ç”¨ä¸åŒçš„æ–¹å¼å®šä¹‰NULLï¼›&lt;/li&gt;
&lt;li&gt;æ•°æ®ç¼–ç ä¸å†å•çº¯çš„ä½¿ç”¨LengthEncodedStringï¼Œè€Œæ˜¯æ ¹æ®æ•°æ®ç±»å‹çš„ä¸åŒè¿›è¡Œç›¸åº”çš„ç¼–ç ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;åé¢æˆ‘ä¼šåˆ†åˆ«è§£é‡Šè¿™ä¸¤ç‚¹ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å®ƒçš„ç»“æ„ï¼š&lt;/p&gt;

&lt;p&gt;ç›¸å¯¹åŒ…å†…å®¹çš„ä½ç½® |é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰|åç§°|æè¿°
---|---|---|---
0 | 1 | åŒ…å¤´æ ‡è¯† |0x00
1 | (col&lt;em&gt;count+7+2)/8 | Null Bit Map | å‰ä¸¤ä½ä¸ºé¢„ç•™å­—èŠ‚ï¼Œä¸»è¦ç”¨äºåŒºåˆ«ä¸å…¶ä»–çš„å‡ ç§åŒ…ï¼ˆOKï¼ŒERRORï¼ŒEOFï¼‰ï¼Œåœ¨MySQL 5ä¹‹åè¿™ä¸¤ä¸ªå­—èŠ‚éƒ½ä¸º0X00ï¼Œå…¶ä¸­col&lt;/em&gt;countä¸ºåˆ—çš„æ•°é‡
(col_count+7+2)/8 + 1 | n | column values | å…·ä½“çš„åˆ—å€¼ï¼Œé‡å¤å¤šæ¬¡ï¼Œæ ¹æ®å€¼ç±»å‹ç¼–ç &lt;/p&gt;

&lt;p&gt;ç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®ƒçš„ä¸¤ä¸ªç‰¹ç‚¹ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥çœ‹å®ƒæ˜¯å¦‚ä½•æ¥å®šä¹‰NULLçš„ï¼Œé¦–å…ˆæˆ‘ä»¬çœ‹åˆ°ä»–çš„ç»“æ„ä¸­æœ‰ä¸€ä¸ªNull Bit Mapï¼Œé™¤å»ä¸¤ä¸ªæ ‡è¯†ä½ï¼ŒçœŸæ­£ç”¨äºæ ‡è¯†æ•°æ®ä¿¡æ¯çš„å°±æ˜¯(col_count+7)/8ä½å­—èŠ‚ï¼Œè¿™é‡Œæˆ‘å…ˆç»™å‡ºç»“è®ºï¼Œåé¢å†ç»™å¤§å®¶å…·ä½“åˆ†æï¼š&lt;/p&gt;

&lt;p&gt;å‚æ•°ä¸ªæ•° |é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰|å…·ä½“å€¼èŒƒå›´|æè¿°
---|---|---|---
1-8 | 1 | -1, 2^nç»„åˆ | 1 = 2^0è¡¨ç¤ºç¬¬ä¸€ä¸ªå‚æ•°ä¸ºNULLï¼Œ3 = 2^0 + 2^1è¡¨ç¤ºç¬¬ä¸€ä¸ªå’Œç¬¬äºŒå‚æ•°ä¸ºNULL...&lt;/p&gt;

&lt;p&gt;ä¸Šé¢ç»™å‡ºäº†æ ‡è¯†NULLçš„åŸºæœ¬ç®—æ³•ï¼ŒåŸåˆ™æ˜¯å“ªä¸ªå‚æ•°ï¼ˆæ¬¡åºä¸ºn)ä¸ºNULLï¼Œåˆ™Null Bit Mapç›¸åº”çš„å€¼åŠ ä¸Š2^n,8ä¸ªå‚æ•°ä¸ºä¸€ä¸ªå‘¨æœŸï¼Œä»¥æ­¤ç±»æ¨ã€‚&lt;/p&gt;

&lt;p&gt;æ¥ç€æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç¬¬äºŒç‚¹ï¼Œæ˜¯å¦‚ä½•ç”¨å…·ä½“å€¼ç±»å‹æ¥å¯¹ç›¸åº”çš„å€¼è¿›è¡Œç¼–ç çš„ï¼Œè¿™é‡Œä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹ï¼Œæ—¶é—´ç±»å‹ï¼Œå­—ç¬¦ä¸²ç±»å‹ï¼›&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;åŸºæœ¬æ•°æ®ç±»å‹ï¼šæ¯”å¦‚TINYINTä½¿ç”¨ä¸€ä¸ªå­—èŠ‚ç¼–ç ï¼ŒFLOATä½¿ç”¨å››ä¸ªå­—èŠ‚ï¼ŒDOUBLEä½¿ç”¨8ä¸ªå­—èŠ‚ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;æ—¶é—´ç±»å‹ï¼šä½¿ç”¨ç±»ä¼¼LengthEncodedStringçš„ç¼–ç æ–¹å¼ç¼–ç ï¼Œå…·ä½“å¯å‚è€ƒ&lt;a href=&quot;https://dev.mysql.com/doc/dev/mysql-server/latest/PAGE_PROTOCOL.html&quot;&gt;MySQL_PROTOCOL&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;å­—ç¬¦ä¸²ç±»ï¼šä¸å±äºä¸Šé¢ä¸¤ç±»çš„éƒ½å±äºå­—ç¬¦ä¸²ç±»å‹ï¼Œä½¿ç”¨æ™®é€šçš„LengthEncodedStringï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;h4&gt;ExecuteåŒ…&lt;/h4&gt;

&lt;p&gt;ExecuteåŒ…é¡¾åæ€ä¹‰æ˜¯ä¸€ä¸ªæ‰§è¡ŒåŒ…ï¼Œå®ƒæ˜¯ç”±Clientç«¯å‘é€åˆ°Serverç«¯çš„ï¼Œä½†å®ƒå’Œæ™®é€šçš„å‘½ä»¤åˆæœ‰ç‚¹ä¸åŒï¼Œå®ƒä¸»è¦æ˜¯ç”¨æ¥æ‰§è¡Œé¢„å¤„ç†è¯­å¥ï¼Œå¹¶ä¼šæºå¸¦ç›¸åº”å‚æ•°ï¼Œå…·ä½“ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;é•¿åº¦ |å«ä¹‰
---|---
1 | COM&lt;em&gt;EXECUTEï¼ˆæ ‡è¯†æ˜¯ä¸€ä¸ªExecuteåŒ…ï¼‰
4 | é¢„å¤„ç†è¯­å¥id
1 | æ¸¸æ ‡ç±»å‹
4 | é¢„ç•™å­—èŠ‚
0 | æ¥ä¸‹å»çš„å†…å®¹åªæœ‰åœ¨æœ‰å‚æ•°çš„æƒ…å†µä¸‹
(param&lt;/em&gt;count+7)/8 | null&lt;em&gt;bit&lt;/em&gt;mapï¼ˆæè¿°å‚æ•°ä¸­NULLçš„æƒ…å†µï¼‰
1 | å‚æ•°ç»‘å®šæƒ…å†µ
n*2 | å‚æ•°ç±»å‹ï¼ˆä¾æ¬¡å­˜å‚¨ï¼‰
n | å‚æ•°å…·ä½“å€¼ï¼ˆéNULL)ï¼ˆä¾æ¬¡å­˜å‚¨ï¼Œä½¿ç”¨Row Data Binaryæ–¹å¼ç¼–ç ï¼‰&lt;/p&gt;

&lt;p&gt;ExecuteåŒ…ä»Clientç«¯å‘é€åˆ°Serverç«¯åå¯èƒ½ä¼šå¾—åˆ°ä»¥ä¸‹å‡ ä¸ªç»“æœï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;OKåŒ…&lt;/li&gt;
&lt;li&gt;ERRORåŒ…&lt;/li&gt;
&lt;li&gt;Result SetåŒ…ï¼ˆå¯èƒ½å¤šä¸ªï¼‰&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æˆ‘ä»¬éœ€è¦æ ¹æ®åŒ…çš„ä¸åŒç±»å‹æ¥è¿›è¡Œä¸åŒçš„å¤„ç†ã€‚&lt;/p&gt;

&lt;h2&gt;æ€»ç»“&lt;/h2&gt;

&lt;p&gt;æœ¬ç¯‡æ–‡ç« ä¸»è¦è®²è¿°äº†MySQLçš„è¿æ¥æ–¹å¼ï¼Œé€šä¿¡è¿‡ç¨‹åŠåè®®ï¼Œä»¥åŠä¼ è¾“åŒ…çš„åŸºæœ¬æ ¼å¼å’Œç›¸å…³ä¼ è¾“åŒ…çš„ç±»å‹ï¼Œå†…å®¹ç›¸å¯¹æ¥è¯´ï¼Œæ¯”è¾ƒå¤šä¹Ÿæ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä¹Ÿæ˜¯å°†è¿‘ä¸‰å‘¨æ‰å†™å®Œï¼Œä½†æ€»ä½“æŒ‰ç…§æˆ‘è‡ªå­¦çš„æ€è·¯èµ°ï¼Œä¸ä¼šå¤ªç»•ï¼Œæœ‰äº›ç‚¹å¯èƒ½éœ€è¦ç»†å¿ƒæ€è€ƒä¸‹ï¼Œå†™çš„æœ‰è¯¯çš„åœ°æ–¹ä¹Ÿå¸Œæœ›å¤§å®¶èƒ½æŒ‡æ­£ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ï¼Œåé¢å¯èƒ½ä¼šå†™å‡ ä¸ªå®ä¾‹å’Œå¤§å®¶ä¸€èµ·å­¦ä¹ ã€‚&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Java IOä¹‹NIO</title>
   <link href="/2017/11/05/java-nio.html"/>
   <updated>2017-11-05T00:00:00+08:00</updated>
   <id>urn:uuid:8d2f2b63-g930-3d54-8ca7-fbvbds2a4fge</id>
   <content type="html">&lt;p&gt;ä¸Šç¯‡è¯´äº†æœ€åŸºç¡€çš„äº”ç§IOæ¨¡å‹ï¼Œç›¸ä¿¡å¤§å®¶å¯¹IOç›¸å…³çš„æ¦‚å¿µåº”è¯¥æœ‰äº†ä¸€å®šçš„äº†è§£ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦è®²è®²åŸºäºå¤šè·¯å¤ç”¨IOçš„Java NIOã€‚&lt;/p&gt;

&lt;h3&gt;èƒŒæ™¯&lt;/h3&gt;

&lt;p&gt;Javaè¯ç”Ÿè‡³ä»Šï¼Œæœ‰å¥½å¤šç§IOæ¨¡å‹ï¼Œä»æœ€æ—©çš„Java IOåˆ°åæ¥çš„Java NIOä»¥åŠæœ€æ–°çš„Java AIOï¼Œæ¯ç§IOæ¨¡å‹éƒ½æœ‰å®ƒè‡ªå·±çš„ç‰¹ç‚¹ï¼Œè¯¦æƒ…è¯·çœ‹æˆ‘çš„ä¸Šç¯‡æ–‡ç« &lt;a href=&quot;https://godpan.me/2017/10/21/java-io.html&quot;&gt;Java IOåˆæ¢&lt;/a&gt;ï¼Œè€Œå…¶ä¸­çš„çš„Java NIOåº”ç”¨éå¸¸å¹¿æ³›ï¼Œå°¤å…¶æ˜¯åœ¨é«˜å¹¶å‘é¢†åŸŸï¼Œæ¯”å¦‚æˆ‘ä»¬å¸¸è§çš„Nettyï¼ŒMinaç­‰æ¡†æ¶ï¼Œéƒ½æ˜¯åŸºäºå®ƒå®ç°çš„ï¼Œç›¸ä¿¡å¤§å®¶éƒ½æœ‰æ‰€äº†è§£ï¼Œä¸‹é¢è®©æˆ‘ä»¬æ¥çœ‹çœ‹Java NIOçš„å…·ä½“æ¶æ„ã€‚&lt;/p&gt;

&lt;h3&gt;Java NIOæ¶æ„&lt;/h3&gt;

&lt;p&gt;å…¶å®Java NIOæ¨¡å‹ç›¸å¯¹æ¥è¯´ä¹Ÿè¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå®ƒçš„æ ¸å¿ƒä¸»è¦æœ‰ä¸‰ä¸ªï¼Œåˆ†åˆ«æ˜¯ï¼šSelectorã€Channelå’ŒBuffer,æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å®ƒä»¬ä¹‹é—´çš„å…³ç³»ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/media/images/2017/11/java-nio.png&quot; alt=&quot;java-nio&quot;&gt;&lt;/p&gt;

&lt;p&gt;å®ƒä»¬ä¹‹é—´çš„å…³ç³»å¾ˆæ¸…æ™°ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹åº”ç€ä¸€ä¸ªSelectorï¼Œä¸€ä¸ªSelectorå¯¹åº”ç€å¤šä¸ªChannelï¼Œä¸€ä¸ªChannelå¯¹åº”ç€ä¸€ä¸ªBufferï¼Œå½“ç„¶è¿™åªæ˜¯é€šå¸¸çš„åšæ³•ï¼Œä¸€ä¸ªChannelä¹Ÿå¯ä»¥å¯¹åº”å¤šä¸ªSelectorï¼Œä¸€ä¸ªChannelå¯¹åº”ç€å¤šä¸ªBufferã€‚&lt;/p&gt;

&lt;h4&gt;Selector&lt;/h4&gt;

&lt;p&gt;ä¸ªäººè®¤ä¸ºSelectoræ˜¯Java NIOçš„æœ€å¤§ç‰¹ç‚¹ï¼Œä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼Œä¼ ç»Ÿçš„Java IOåœ¨é¢å¯¹å¤§é‡IOè¯·æ±‚çš„æ—¶å€™æœ‰å¿ƒæ— åŠ›ï¼Œå› ä¸ºæ¯ä¸ªç»´æŠ¤æ¯ä¸€ä¸ªIOè¯·æ±‚éƒ½éœ€è¦ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™å¸¦æ¥çš„é—®é¢˜å°±æ˜¯ï¼Œç³»ç»Ÿèµ„æºè¢«æåº¦æ¶ˆè€—ï¼Œååé‡ç›´çº¿ä¸‹é™ï¼Œå¼•èµ·ç³»ç»Ÿç›¸å…³é—®é¢˜ï¼Œé‚£ä¹ˆJava NIOæ˜¯å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜çš„å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯Selectorï¼Œç®€å•æ¥è¯´å®ƒå¯¹åº”ç€å¤šè·¯IOå¤ç”¨ä¸­çš„ç›‘ç®¡è§’è‰²ï¼Œå®ƒè´Ÿè´£ç»Ÿä¸€ç®¡ç†IOè¯·æ±‚ï¼Œç›‘å¬ç›¸åº”çš„IOäº‹ä»¶ï¼Œå¹¶é€šçŸ¥å¯¹åº”çš„çº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œè¿™ç§æ¨¡å¼ä¸‹å°±æ— éœ€ä¸ºæ¯ä¸ªIOè¯·æ±‚å•ç‹¬åˆ†é…ä¸€ä¸ªçº¿ç¨‹ï¼Œå¦å¤–ä¹Ÿå‡å°‘çº¿ç¨‹å¤§é‡é˜»å¡ï¼Œèµ„æºåˆ©ç”¨ç‡ä¸‹é™çš„æƒ…å†µï¼Œæ‰€ä»¥è¯´Selectoræ˜¯Java NIOçš„ç²¾é«“ï¼Œåœ¨Javaä¸­æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// æ‰“å¼€æœåŠ¡å™¨å¥—æ¥å­—é€šé“&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ServerSocketChannel&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ssc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ServerSocketChannel&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// æœåŠ¡å™¨é…ç½®ä¸ºéé˜»å¡&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ssc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;configureBlocking&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// è¿›è¡ŒæœåŠ¡çš„ç»‘å®š&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ssc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;bind&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;InetSocketAddress&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;localhost&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8001&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// é€šè¿‡open()æ–¹æ³•æ‰¾åˆ°Selector&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Selector&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;selector&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Selector&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// æ³¨å†Œåˆ°selectorï¼Œç­‰å¾…è¿æ¥&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ssc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;register&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SelectionKey&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;OP_ACCEPT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;Channel&lt;/h4&gt;

&lt;p&gt;Channelæœ¬æ„æ˜¯é€šé“çš„æ„æ€ï¼Œç®€å•æ¥è¯´ï¼Œå®ƒåœ¨Java NIOä¸­è¡¨ç°çš„å°±æ˜¯ä¸€ä¸ªæ•°æ®é€šé“ï¼Œä½†æ˜¯è¿™ä¸ªé€šé“æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œé‚£å°±æ˜¯å®ƒæ˜¯åŒå‘çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä»é€šé“é‡Œæ¥æ”¶æ•°æ®ï¼Œä¹Ÿå¯ä»¥å‘é€šé“é‡Œå†™æ•°æ®ï¼Œä¸ç”¨åƒJava BIOé‚£æ ·ï¼Œè¯»æ•°æ®å’Œå†™æ•°æ®éœ€è¦ä¸åŒçš„æ•°æ®é€šé“ï¼Œæ¯”å¦‚æœ€å¸¸è§çš„Inputstreamå’ŒOutputstreamï¼Œä½†æ˜¯å®ƒä»¬éƒ½æ˜¯å•å‘çš„ï¼ŒChannelä½œä¸ºä¸€ç§å…¨æ–°çš„è®¾è®¡ï¼Œå®ƒå¸®åŠ©ç³»ç»Ÿä»¥ç›¸å¯¹å°çš„ä»£ä»·æ¥ä¿æŒIOè¯·æ±‚æ•°æ®ä¼ è¾“çš„å¤„ç†ï¼Œä½†æ˜¯å®ƒå¹¶ä¸çœŸæ­£å­˜æ”¾æ•°æ®ï¼Œå®ƒæ€»æ˜¯ç»“åˆç€ç¼“å­˜åŒºï¼ˆBufferï¼‰ä¸€èµ·ä½¿ç”¨ï¼Œå¦å¤–Channelä¸»è¦æœ‰ä»¥ä¸‹å››ç§ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;FileChannelï¼šè¯»å†™æ–‡ä»¶æ—¶ä½¿ç”¨çš„é€šé“&lt;/li&gt;
&lt;li&gt;DatagramChannelï¼šä¼ è¾“UDPè¿æ¥æ•°æ®æ—¶çš„é€šé“,ä¸Java IOä¸­çš„DatagramSocketå¯¹åº”&lt;/li&gt;
&lt;li&gt;SocketChannelï¼šä¼ è¾“TCPè¿æ¥æ•°æ®æ—¶çš„é€šé“ï¼Œä¸Java IOä¸­çš„Socketå¯¹åº”&lt;/li&gt;
&lt;li&gt;ServerSocketChannel: ç›‘å¬å¥—æ¥è¯è¿æ¥æ—¶çš„é€šé“ï¼Œä¸Java IOä¸­çš„ServerSocketå¯¹åº”&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å½“ç„¶å…¶ä¸­æœ€é‡è¦ä»¥åŠæœ€å¸¸ç”¨çš„å°±æ˜¯SocketChannelå’ŒServerSocketChannelï¼Œä¹Ÿæ˜¯Java NIOçš„ç²¾é«“ï¼ŒServerSocketChannelå¯ä»¥è®¾ç½®æˆéé˜»å¡æ¨¡å¼ï¼Œç„¶åç»“åˆSelectorå°±å¯ä»¥å®ç°å¤šè·¯å¤ç”¨IOï¼Œä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹ç®¡ç†å¤šä¸ªSocketè¿æ¥ï¼Œå…·ä½“ä½¿ç”¨å¯ä»¥å‚æ•°ä¸Šé¢çš„ä»£ç ã€‚&lt;/p&gt;

&lt;h4&gt;Buffer&lt;/h4&gt;

&lt;p&gt;é¡¾åæ€ä¹‰ï¼ŒBufferçš„å«ä¹‰æ˜¯ç¼“å†²åŒºï¼Œå®ƒåœ¨Java NIOä¸­çš„ä¸»è¦ä½œç”¨å°±æ˜¯ä½œä¸ºæ•°æ®çš„ç¼“å†²åŒºåŸŸï¼ŒBufferå¯¹åº”ç€æŸä¸€ä¸ªChannelï¼Œä»Channelä¸­è¯»å–æ•°æ®æˆ–è€…å‘Channelä¸­å†™æ•°æ®ï¼ŒBufferä¸æ•°ç»„å¾ˆç±»ä¼¼ï¼Œä½†æ˜¯å®ƒæä¾›äº†æ›´å¤šçš„ç‰¹æ€§ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹Bufferä¸­çš„æ•°æ®è¿›è¡Œæ“ä½œï¼Œåé¢æˆ‘ä¹Ÿä¼šä¸»è¦åˆ†æå®ƒçš„ä¸‰ä¸ªå±æ€§capacityï¼Œpositionå’Œlimitï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹Bufferåˆ†é…æ—¶çš„ç±»åˆ«ï¼ˆè¿™é‡Œä¸æ˜¯æŒ‡Bufferçš„å…·ä½“æ•°æ®ç±»å‹ï¼‰å³Direct Bufferå’ŒHeap Bufferï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¦æœ‰è¿™ä¸¤ç§ç±»åˆ«çš„Bufferå‘¢ï¼Ÿæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å®ƒä»¬çš„ç‰¹æ€§ï¼š&lt;/p&gt;

&lt;p&gt;Direct Bufferï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ç›´æ¥åˆ†é…åœ¨ç³»ç»Ÿå†…å­˜ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;ä¸éœ€è¦èŠ±è´¹å°†æ•°æ®åº“ä»å†…å­˜æ‹·è´åˆ°Javaå†…å­˜ä¸­çš„æˆæœ¬ï¼›&lt;/li&gt;
&lt;li&gt;è™½ç„¶Direct Bufferæ˜¯ç›´æ¥åˆ†é…ä¸­ç³»ç»Ÿå†…å­˜ä¸­çš„ï¼Œä½†å½“å®ƒè¢«é‡å¤åˆ©ç”¨æ—¶ï¼Œåªæœ‰çœŸæ­£éœ€è¦æ•°æ®çš„é‚£ä¸€é¡µæ•°æ®ä¼šè¢«è£…è½½åˆ°çœŸæ˜¯çš„å†…å­˜ä¸­ï¼Œå…¶å®ƒçš„è¿˜å­˜åœ¨åœ¨è™šæ‹Ÿå†…å­˜ä¸­ï¼Œä¸ä¼šé€ æˆå®é™…å†…å­˜çš„èµ„æºæµªè´¹ï¼›&lt;/li&gt;
&lt;li&gt;å¯ä»¥ç»“åˆç‰¹å®šçš„æœºå™¨ç ï¼Œä¸€æ¬¡å¯ä»¥æœ‰é¡ºåºçš„è¯»å–å¤šå­—èŠ‚å•å…ƒï¼›&lt;/li&gt;
&lt;li&gt;å› ä¸ºç›´æ¥åˆ†é…åœ¨ç³»ç»Ÿå†…å­˜ä¸­ï¼Œæ‰€ä»¥å®ƒä¸å—Java GCç®¡ç†ï¼Œä¸ä¼šè‡ªåŠ¨å›æ”¶ï¼›&lt;/li&gt;
&lt;li&gt;åˆ›å»ºä»¥åŠé”€æ¯çš„æˆæœ¬æ¯”è¾ƒé«˜ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Heap Bufferï¼š &lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;åˆ†é…åœ¨Java Heapï¼Œå—Java GCç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼Œä¸éœ€è¦é¢å¤–ç»´æŠ¤ï¼›&lt;/li&gt;
&lt;li&gt;åˆ›å»ºæˆæœ¬ç›¸å¯¹è¾ƒä½ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ ¹æ®å®ƒä»¬çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å¤§è‡´æ€»ç»“å‡ºå®ƒä»¬çš„é€‚ç”¨åœºæ™¯ï¼š&lt;/p&gt;

&lt;p&gt;å¦‚æœè¿™ä¸ªBufferå¯ä»¥é‡å¤åˆ©ç”¨ï¼Œè€Œä¸”ä½ ä¹Ÿæƒ³å¤šä¸ªå­—èŠ‚æ“ä½œï¼Œäº¦æˆ–è€…ä½ å¯¹æ€§èƒ½è¦æ±‚å¾ˆé«˜ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨Direct Bufferï¼Œä½†å…¶ç¼–ç ç›¸å¯¹æ¥è¯´ä¼šæ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦æ³¨æ„çš„ç‚¹ä¹Ÿæ›´å¤šï¼Œåä¹‹åˆ™ç”¨Heap Bufferï¼ŒBufferçš„ç›¸åº”åˆ›å»ºæ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;c1&quot;&gt;//åˆ›å»ºHeap Buffer&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ByteBuffer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;heapBuffer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ByteBuffer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;allocate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;//åˆ›å»ºDirect Buffer&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ByteBuffer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;directBuffer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ByteBuffer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;allocateDirect&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„ä¸‰ä¸ªå±æ€§ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Capacityï¼šé¡¾åæ€ä¹‰å®ƒçš„å«ä¹‰æ˜¯å®¹é‡ï¼Œä»£è¡¨ç€Bufferçš„æœ€å¤§å®¹é‡ï¼Œä¸æ•°ç»„çš„Sizeå¾ˆç±»ä¼¼ï¼Œåˆå§‹åŒ–ä¸å¯æ›´æ”¹ï¼Œé™¤éä½ æ”¹å˜çš„Bufferçš„ç»“æ„ï¼›&lt;/li&gt;
&lt;li&gt;Limitï¼šé¡¾åæ€ä¹‰å®ƒçš„å«ä¹‰æ˜¯ç•Œé™ï¼Œä»£è¡¨ç€Bufferçš„ç›®å‰å¯ä½¿ç”¨çš„æœ€å¤§é™åˆ¶ï¼Œå†™æ¨¡å¼ä¸‹ï¼Œä¸€èˆ¬Limitç­‰äºCapacityï¼Œè¯»æ¨¡å¼ä¸‹éœ€è¦ä½ è‡ªå·±æ§åˆ¶å®ƒçš„å€¼ç»“åˆpositionè¯»å–æƒ³è¦çš„æ•°æ®ï¼›&lt;/li&gt;
&lt;li&gt;Positionï¼šé¡¾åæ€ä¹‰å®ƒçš„å«ä¹‰æ˜¯ä½ç½®ï¼Œä»£è¡¨ç€Bufferç›®å‰æ“ä½œçš„ä½ç½®ï¼Œé€šä¿—æ¥è¯´ï¼Œå°±æ˜¯ä½ ä¸‹æ¬¡å¯¹Bufferè¿›è¡Œæ“ä½œçš„èµ·å§‹ä½ç½®ï¼›&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ¥ä¸‹æ¥æˆ‘ä¼šç”¨ä¸€ä¸ªå›¾è§£çš„åˆ—å­å¸®åŠ©å¤§å®¶ç†è§£,ç°åœ¨æˆ‘ä»¬å‡è®¾æœ‰ä¸€ä¸ªå®¹é‡ä¸º10çš„Bufferï¼Œæˆ‘ä»¬å…ˆå¾€é‡Œé¢å†™å…¥ä¸€å®šå­—èŠ‚çš„æ•°æ®ï¼Œç„¶åå†æ ¹æ®ç¼–ç è§„åˆ™ä»å…¶ä¸­è¯»å–æˆ‘ä»¬éœ€è¦çš„æ•°æ®ï¼š&lt;/p&gt;

&lt;p&gt;1.åˆå§‹Bufferï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;n&quot;&gt;ByteBuffer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ByteBuffer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;allocate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/media/images/2017/11/init-buffer.png&quot; alt=&quot;init-buffer&quot;&gt;&lt;/p&gt;

&lt;p&gt;2.å‘Bufferä¸­å†™å…¥ä¸¤ä¸ªå­—èŠ‚ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;my&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getBytes&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/media/images/2017/11/write-buffer-1.png&quot; alt=&quot;write-buffer-1&quot;&gt;&lt;/p&gt;

&lt;p&gt;3.å†Bufferä¸­å†™å…¥å››ä¸ªå­—èŠ‚ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;blog&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getBytes&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;/media/images/2017/11/write-buffer-2.png&quot; alt=&quot;write-buffer-2&quot;&gt;&lt;/p&gt;

&lt;p&gt;4.ç°åœ¨æˆ‘ä»¬éœ€è¦ä»Bufferä¸­è·å–æ•°æ®ï¼Œé¦–å…ˆæˆ‘ä»¬å…ˆå°†å†™æ¨¡å¼è½¬æ¢ä¸ºè¯»æ¨¡å¼ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;  &lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;flip&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æˆ‘ä»¬æ¥çœ‹çœ‹flip()æ–¹æ³•åˆ°åº•åšäº†ä»€ä¹ˆäº‹ï¼Ÿ&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Buffer&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;flip&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;limit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;position&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;position&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;mark&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä»æºç ä¸­å¯ä»¥çœ‹å‡ºï¼Œflipæ–¹æ³•æ ¹æ®Bufferç›®å‰çš„ç›¸åº”å±æ€§æ¥ä¿®æ”¹å¯¹åº”çš„å±æ€§ï¼Œæ‰€ä»¥flip()æ–¹æ³•ä¹‹åï¼ŒBufferç›®å‰çš„çŠ¶æ€ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/media/images/2017/11/read-buffer.png&quot; alt=&quot;read-buffer&quot;&gt;&lt;/p&gt;

&lt;p&gt;5.æ¥ç€æˆ‘ä»¬ä»Bufferä¸­è¯»å–æ•°æ®&lt;/p&gt;

&lt;p&gt;ä»Bufferä¸­è¯»å–æ•°æ®æœ‰å¤šç§æ–¹å¼ï¼Œæ¯”å¦‚get(),get(byte [])ç­‰ï¼Œç›¸å…³çš„å…·ä½“æ–¹æ³•ä½¿ç”¨å¯ä»¥å‚è€ƒBufferçš„å®˜æ–¹APIæ–‡æ¡£ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨æœ€ç®€å•çš„get()æ¥è·å–æ•°æ®:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;  &lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;byte&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æ­¤æ—¶Bufferçš„çŠ¶æ€å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/media/images/2017/11/read-buffer-2.png&quot; alt=&quot;read-buffer-2&quot;&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬å¯ä»¥æŒ‰ç…§è¿™ç§æ–¹å¼è¯»å–å®Œæˆ‘ä»¬æ‰€éœ€æ•°æ®ï¼Œæœ€ç»ˆè°ƒç”¨clear()æ–¹æ³•å°†Bufferç½®ä¸ºåˆå§‹çŠ¶æ€ã€‚&lt;/p&gt;

&lt;h3&gt;æ€»ç»“&lt;/h3&gt;

&lt;p&gt;è¿™ç¯‡æ–‡ç« ä¸»è¦è®²è§£äº†Java NIOä¸­é‡è¦çš„ä¸‰ä¸ªç»„æˆéƒ¨åˆ†ï¼Œåœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¹Ÿæ˜¯æ¯”è¾ƒé‡è¦çš„ï¼ŒæŒæ¡å®ƒä»¬ä¹‹é—´çš„å…³ç³»ï¼Œå¯ä»¥è®©ä½ å¯¹Java NIOçš„æ•´ä¸ªæ¶æ„æ›´åŠ ç†Ÿæ‚‰ï¼Œç†è§£ç›¸å¯¹æ¥è¯´ä¹Ÿä¼šæ›´åŠ æ·±åˆ»ï¼Œå¹¶åˆ†æäº†è¿™ç§æ¨¡å¼æ˜¯å¦‚ä½•ä¸å¤šè·¯å¤ç”¨IOæ¨¡å‹çš„æ˜ å°„ï¼Œäº†è§£Java NIOåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ä¼˜åŠ¿çš„åŸå› ã€‚&lt;/p&gt;
</content>
 </entry>
 
 
</feed>
