<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="author" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>æ³®å…³æ£®çš„ä¸ªäººåšå®¢</title>
    <link rel="shortcut icon" href="/media/favicon.ico">
<!--     <link href="/atom.xml" rel="alternate" title="æ³®" type="application/atom+xml" /> -->
<!--     <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css"> -->
    <link rel="stylesheet" href="/media/css/style.css">
  <!--   <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/retina.js/1.3.0/retina.min.js"></script> -->
    <link rel="stylesheet" href="/media/css/github.min.css">
    <script src="/media/js/highlight.min.js"></script>
    <script type="text/javascript"> hljs.initHighlightingOnLoad(); </script>
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?8ac3cc3bdb3696e1041a41874f47e7b4";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
    </script> 
    <!-- <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-7784116562520918",
        enable_page_level_ads: true
      });
    </script>      -->
  </head>
  <body>
      <div id="main" role="main">
        <header>
          <div id="header">
            <h1><a title="æ³®" class="" href="/">æ³®</a></h1>
          </div>
          <nav>
            
            <!-- <span><a title="Blog" href="/blog.html"><i class="fa fa-list-ul"></i></a></span> -->
            <span><a title="Blog" href="/blog.html">Blog</a></span>
            
            <!-- <span><a title="Tags" href="/tags.html"><i class="fa fa-tags"></i></a></span> -->
            <span><a title="Tags" href="/tags.html">Tags</a></span>
            
            <!-- <span><a title="About" href="/about.html"><i class="fa fa-user"></i></a></span> -->
            <span><a title="About" href="/about.html">About</a></span>
            
          </nav>
        </header>
        <div id="content">
        <article>
  <section class="title">
    <h2>Jekyllåšå®¢éƒ¨ç½²è¿ç§»åˆ°Linuxï¼ˆCentos7ï¼‰ä¸”æ”¯æŒhttpsæ•™ç¨‹ </h2>
  </section>
  <section class="meta">
  <span class="time">
    <time datetime="2019-09-15">2019-09-15</time>
  </span>
  
  <span class="tags">
    
    <a href="/tags.html#Jekyll" title="Jekyll">#Jekyll</a>
    
    <a href="/tags.html#https" title="https">#https</a>
    
  </span>
  <!-- BEGIN this would not work on any other domain -->
  <span
    class           = "like-wrapper"
    like-shortname  = ''
    like-identifier = 'urn:uuid:85cd4b63-e9f0-4459-8ca7-fbdsdc2a2fad'
    like-name       = 'Jekyllåšå®¢éƒ¨ç½²è¿ç§»åˆ°Linuxï¼ˆCentos7ï¼‰ä¸”æ”¯æŒhttpsæ•™ç¨‹'
    like-btn        = '&#xf087;'
    like-link       = '/2019/09/15/jekyll-deploy-linux-with-https.html'
    ></span>
  <script type="text/javascript">
    var l = document.createElement('script');
    l.type = 'text/javascript'; l.async = true; l.src = 'https://cdnjs.cloudflare.com/ajax/libs/soundplayer-widget/0.4.2/soundplayer-widget.min.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(l);
  </script>
  <!-- END this would not work on any other domain -->
  
  </section>
  <section class="post">
  <p>ä¹‹å‰ä¸€ç›´æŠŠåšå®¢æ‰˜ç®¡åˆ°Github pagesä¸Šï¼Œè™½ç„¶æ–¹ä¾¿ä½†æ˜¯ä¹Ÿæœ‰å‡ ä¸ªå¼Šç«¯ï¼Œæ¯”å¦‚ï¼š</p>

<ul>
<li>1.æœ‰æ—¶è®¿é—®é€Ÿåº¦è¿‡æ…¢</li>
<li>2.å›½å†…çš„ä¸€äº›æœç´¢å¼•æ“æ— æ³•æ£€ç´¢åˆ°</li>
</ul>

<p>åˆšå¥½è‡ªå·±æœ‰ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæ‰€ä»¥å‡†å¤‡å°†åšå®¢è¿ç§»åˆ°è‡ªå·±çš„æœåŠ¡å™¨ä¸Šï¼Œå½“ç„¶æ¨èå°†å†…å®¹åœ¨githubä¹Ÿä¿å­˜ä¸€ä»½ï¼Œä»¥é˜²ä¸‡ä¸€æ•°æ®ä¸¢å¤±ã€‚</p>

<p>æ“ä½œå‰æï¼š</p>

<p>1.ç”³è¯·ä¸€ä¸ªè‡ªå·±çš„æœåŠ¡å™¨å’ŒåŸŸå(å›½å†…çš„æœ‰äº›æœåŠ¡å™¨ç”¨80ç«¯å£éœ€è¦å¤‡æ¡ˆï¼Œå¦‚ä½¿ç”¨è¯·å…ˆå¤‡æ¡ˆ)
2.Jekyllåšå®¢å®‰è£…
3.æœ‰è‡ªå·±çš„github</p>

<h3>æ­¥éª¤</h3>

<h4>1.ç¼–è¯‘è‡ªå·±çš„åšå®¢</h4>

<p>æ‰§è¡Œå‘½ä»¤ï¼š</p>
<div class="highlight"><pre><code class="language-jekyll" data-lang="jekyll">jekyll build
</code></pre></div>
<p>jekyllå°†ç¼–è¯‘å®Œçš„æ–‡ä»¶æ”¾åœ¨å·¥ç¨‹çš„<em>_site</em>ç›®å½•ä¸‹ï¼Œéƒ¨ç½²çš„æ—¶å€™å¯ä»¥å•ç‹¬ä¸Šä¼ è¿™ä¸ªæ–‡ä»¶å¤¹å°±è¡Œï¼Œä½†è¿™é‡Œæˆ‘ä»¬ä¼šå°†è‡ªå·±çš„åšå®¢å·¥ç¨‹å­˜å‚¨åœ¨githubä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å·¥ç¨‹çš„æ‰€æœ‰å†…å®¹éƒ½ä¸Šä¼ åˆ°githubä¸Šäº†ã€‚</p>

<h4>2.ä¸Šä¼ åˆ°github</h4>

<p>å¦‚ä½•è·Ÿå°†é¡¹ç›®è·Ÿgithubä¸Šçš„Repositoriesç»‘å®šè¯·è‡ªè¡Œå‚è€ƒgoogleã€‚</p>

<p>æ‰§è¡Œå‘½ä»¤è¿›è¡Œä¸Šä¼ ï¼š</p>
<div class="highlight"><pre><code class="language-git" data-lang="git">git add -f *
git commit -m "update blog"
git push
</code></pre></div>
<h4>3.æœåŠ¡å™¨å®‰è£…gitå¹¶cloneå·¥ç¨‹é¡¹ç›®</h4>

<p>æ‰§è¡Œå‘½ä»¤ï¼š</p>
<div class="highlight"><pre><code class="language-shell" data-lang="shell">yum install git

//cloneä½ è‡ªå·±çš„é¡¹ç›®

git clone https://github.com/godpan/godpan.github.io.git
</code></pre></div>
<h4>4.å®‰è£…nginxå¹¶ä¿®æ”¹é…ç½®</h4>
<div class="highlight"><pre><code class="language-shell" data-lang="shell">yum install nginx
</code></pre></div>
<p>ä¿®æ”¹nginxé…ç½®</p>
<div class="highlight"><pre><code class="language-shell" data-lang="shell">vi /etc/nginx/nginx.conf

//ä¿®æ”¹ä»¥ä¸‹å†…å®¹ï¼Œå…¶ä»–ä¸å˜

user root<span class="p">;</span>

server <span class="o">{</span>
    listen       80 default_server<span class="p">;</span>
    listen       <span class="o">[</span>::]:80 default_server<span class="p">;</span>
    server_name  _<span class="p">;</span>
    root         /root/godpan.github.io/_site<span class="p">;</span> <span class="c">#åšå®¢_siteæ–‡ä»¶ç›®å½•</span>

    <span class="c"># Load configuration files for the default server block.</span>
    include /etc/nginx/default.d/<span class="k">*</span>.conf<span class="p">;</span>

    location / <span class="o">{</span>
    <span class="o">}</span>

    error_page 404 /404.html<span class="p">;</span>
        location <span class="o">=</span> /40x.html <span class="o">{</span>
    <span class="o">}</span>

    error_page 500 502 503 504 /50x.html<span class="p">;</span>
        location <span class="o">=</span> /50x.html <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>ä¿å­˜æ–‡ä»¶ï¼Œå¹¶å¯åŠ¨nginxå¹¶å¼€å¯80ç«¯å£</p>
<div class="highlight"><pre><code class="language-" data-lang="">systemctl start nginx

firewall-cmd --add-port=80/tcp --permanent
firewall-cmd --reload
</code></pre></div>
<p>ç„¶åç›´æ¥è®¿é—®ä½ æœåŠ¡å™¨çš„ipï¼Œä¸å‡ºæ„å¤–åº”è¯¥èƒ½ç›´æ¥çœ‹åˆ°ä½ è‡ªå·±åšå®¢çš„å†…å®¹äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å°†åŸŸåä¸ipç»‘å®šã€‚</p>

<h4>5.ç»‘å®šåŸŸå</h4>

<p>æˆ‘è¿™é‡Œæ“ä½œçš„æ˜¯é˜¿é‡Œäº‘ä¸Šçš„åŸŸåï¼Œä»…ä¾›å‚è€ƒï¼Œå…¶ä»–å¹³å°çš„è‡ªå·±æŒ‰ç…§è§„åˆ™è®¾ç½®ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p>

<p><img src="/media/images/2019/09/domain-settings.png" alt="domain-settings"></p>

<p>ç­‰åŸŸåç”Ÿæ•ˆï¼ˆé€šå¸¸ä¸è¶…è¿‡10åˆ†é’Ÿï¼‰å°±å¯ä»¥ç›´æ¥ç”¨åŸŸåè®¿é—®ä½ çš„åšå®¢äº†ã€‚</p>

<p>å¦‚æœä½ ä¸æƒ³ç»™ç½‘ç«™é…ç½®ä¸ºhttpsçš„è¯ï¼Œåˆ°è¿™é‡Œå°±å¤§åŠŸå‘Šæˆäº†ã€‚</p>

<h4>6.é…ç½®https</h4>

<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨Certbotæ¥ç”Ÿæˆhttpséœ€è¦çš„è¯ä¹¦ï¼Œå…ˆå®‰è£…Certbotï¼š</p>
<div class="highlight"><pre><code class="language-shell" data-lang="shell">yum install certbot
</code></pre></div>
<p>ç”Ÿæˆè¯ä¹¦ï¼š
<code>shell
certbot certonly --webroot -w /root/godpan.github.io/_site -d godpan.me -d www.godpan.me
</code>
è¯ä¹¦ç”Ÿæˆçš„ç›®å½•åœ¨ï¼š</p>
<div class="highlight"><pre><code class="language-shell" data-lang="shell">/etc/letsencrypt/live/godpan.me  <span class="c">#åé¢ä¸ºä½ è‡ªå·±çš„åŸŸå</span>
</code></pre></div>
<p>ä¿®æ”¹nginxå¯¹åº”çš„é…ç½®ï¼š</p>
<div class="highlight"><pre><code class="language-shell" data-lang="shell">vi /etc/nginx/nginx.conf

<span class="c">#ä¿®æ”¹443ç«¯å£å¯¹åº”çš„serverå†…å®¹ï¼š</span>

server <span class="o">{</span>
    listen       443 ssl http2 default_server<span class="p">;</span>
    listen       <span class="o">[</span>::]:443 ssl http2 default_server<span class="p">;</span>
    server_name  _<span class="p">;</span>
    root         /root/godpan.github.io/_site<span class="p">;</span> <span class="c">#åšå®¢_siteæ–‡ä»¶ç›®å½•</span>

    ssl_certificate <span class="s2">"/etc/letsencrypt/live/godpan.me/fullchain.pem"</span><span class="p">;</span>  <span class="c">#è¯ä¹¦çš„è·¯å¾„</span>
    ssl_certificate_key <span class="s2">"/etc/letsencrypt/live/godpan.me/privkey.pem"</span><span class="p">;</span> <span class="c">#è¯ä¹¦å¯†é’¥çš„è·¯å¾„</span>
    ssl_session_cache shared:SSL:1m<span class="p">;</span>
    ssl_session_timeout  10m<span class="p">;</span>
    ssl_ciphers HIGH:!aNULL:!MD5<span class="p">;</span>
    ssl_prefer_server_ciphers on<span class="p">;</span>

    <span class="c"># Load configuration files for the default server block.</span>
    include /etc/nginx/default.d/<span class="k">*</span>.conf<span class="p">;</span>

    location / <span class="o">{</span>
    <span class="o">}</span>

    error_page 404 /404.html<span class="p">;</span>
        location <span class="o">=</span> /40x.html <span class="o">{</span>
    <span class="o">}</span>

    error_page 500 502 503 504 /50x.html<span class="p">;</span>
        location <span class="o">=</span> /50x.html <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>å¼€å¯443ç«¯å£ï¼Œå¹¶é‡å¯nginxï¼š</p>
<div class="highlight"><pre><code class="language-shell" data-lang="shell">firewall-cmd <span class="nt">--add-port</span><span class="o">=</span>443/tcp <span class="nt">--permanent</span>
firewall-cmd <span class="nt">--reload</span>
systemctl restart nginx
</code></pre></div>
<p>è¿™æ—¶å€™ä½ å°±å¯ä»¥ç”¨httpsè®¿é—®ä½ çš„ç½‘ç«™äº†ï¼Œæ¯”å¦‚https://godpan.meï¼Œä½†å› ä¸ºcertbotè¯ä¹¦æœ‰3ä¸ªæœˆçš„æœ‰æ•ˆæœŸï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®šæ—¶å»æ›´æ–°è¯ä¹¦ï¼Œä¸è¿‡å®ƒæä¾›äº†æ›´æ–°è¯ä¹¦çš„å‘½ä»¤ï¼š
<code>
certbot renew
</code>
ä½†æ‰‹åŠ¨æ›´æ–°çš„è¯å¯ä»¥èƒ½ä¼šå¿˜ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ç³»ç»Ÿè‡ªèº«çš„å®šæ—¶ä»»åŠ¡å»æ›´æ–°ï¼š</p>

<p>åˆ›å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼š</p>
<div class="highlight"><pre><code class="language-shell" data-lang="shell">vi certbot-auto-renew-crontab

<span class="c">#è¾“å…¥ä»¥ä¸‹å†…å®¹è¿›è¡Œä¿å­˜ï¼Œå«ä¹‰æ˜¯æ¯ä¸ªæœˆç¬¬ä¸€å¤©çš„ä¸€ç‚¹å‡Œæ™¨ä¼šå»æ›´æ–°ä¸€æ¬¡è¯ä¹¦</span>

0 1 1 <span class="k">*</span> <span class="k">*</span> certbot renew <span class="nt">--pre-hook</span> <span class="s2">"systemctl stop nginx"</span> <span class="nt">--post-hook</span> <span class="s2">"systemctl start nginx"</span>
</code></pre></div>
<p>æœ€åæˆ‘ä»¬crontabæ¥å¯åŠ¨è¿™ä¸ªä»»åŠ¡ï¼š</p>
<div class="highlight"><pre><code class="language-shell" data-lang="shell">crontab certbot-auto-renew-crontab
</code></pre></div>
<p>è‡³æ­¤å¤§åŠŸå‘Šæˆï¼Œé™¤éä½ çš„æœåŠ¡å™¨å´©æºƒæˆ–è€…è¢«å°äº†ğŸ˜‚ğŸ˜‚ğŸ˜‚ã€‚</p>

  </section>
  
  <div class="divider">
    <span>
    
    <a href="/2019/07/15/kafka-producer-send-async-bug.html"><i class="fa fa-chevron-left"></i></a>
    
    </span>
    <!-- BEGIN comment icon
    <span><a href="javascript:leave_comment();" id="leave_comment_link"><i class="fa fa-comment-o"></i></a></span>
    <span><a href="javascript:collapse_comment();" id="collapse_comment_link" style="display:none;"><i class="fa fa-chevron-up"></i></a></span>
      END comment icon -->

    <span>
    
    <i class="fa fa-circle"></i>
    
    </span>
  </div>
  <span>æ–‡ç« å…è®¸è½¬è½½ã€ä½¿ç”¨ï¼Œä½†éœ€è¦ä¿ç•™é“¾æ¥æ–‡ç« ç½²å
      <a href="https://godpan.me">godpan.me</a>,å¦‚æœ‰å†™çš„ä¸å½“ä¹‹å¤„ï¼Œä¹Ÿæ¬¢è¿å¤§å®¶æŒ‡æ­£ï¼Œè”ç³»é‚®ç®±ï¼šgodpan.sen@gmail.com</span>

  <!-- BEGIN comment
  <section class="comment">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
      var disqus_shortname = '';
      var disqus_identifier = 'urn:uuid:85cd4b63-e9f0-4459-8ca7-fbdsdc2a2fad';

      function leave_comment() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          $("#leave_comment_link").css("display", "none");
          $("#collapse_comment_link").css("display", "");
      };
      function collapse_comment() {
          // document.getElementById("disqus_thread").innerHTML = '';
          $("#disqus_thread").slideUp(400, function() {
              $("#disqus_thread").empty();
              $("#leave_comment_link").css("display", "");
              $("#collapse_comment_link").css("display", "none");
              $("#disqus_thread").css("display", "");
          });
      };
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </section>
  END comment -->
  
</article>

        </div>
        <footer>
          <div>
            
            &copy; 2019  | powered by jekyll | themed by sext vi | <a href="https://github.com/godpan" title="github me">github</a>
          </div>
        </footer>
      </div> <!-- main -->
  </body>
</html>
