
---
title: MpVue微信小程序爬坑优化经历
layout: post
guid: urn:uuid:85cd4b63-e9f0-4459-8ca7-fbdsdc24tgy6
tags:
  - 小程序 Mpvue 前端优化
---

怪当初不小心上了Mpvue的车，司机已经弃车走了，但门被锁了暂时没法下车（短时间内无法做迁移），那么只能一条道走到黑，慢慢优化了，我们先来看一下目前遇到了哪些问题。

### 1.遇到的问题

- 1.页面初次渲染时间慢
- 2.复杂页面渲染后，部分机型（IOS低电量模式）点击反应缓慢甚至无法反应
- 3.页面图片过多，首次加载同时请求过多图片
- 4.长列表问题

### 2.问题的本质

除了第三点页面图片过多以外，其他问题的最终本质就是setData的数据量太大或者setData执行过于频繁，这些问题都会导致小程序页面渲染卡顿甚至失去响应，关于微信小程序data与页面渲染的关系请参考微信官网文档。

接下去就来分析一下哪些情况会导致以上这些问题，以及如何解决的。

### 3.问题发现与解决方案

#### 3.1 不恰当的使用Vuex

如果不是过于简单的业务，相信大家应该在工程里使用了Vuex，那么使用Vuex有什么弊端呢，因为受限于小程序的机制，mpvue将所有的computed的属性都编译到小程序的data中，如果这时我们使用mixin的方式来混入Vuex中的数据，则可能会导致一些问题，我们来看一个例子：
```javascript

```


1 除非必须字段，否则不使用vuex，饮用vuex使用mapState；
2 图片使用懒加载，直接在img添加lazy-load属性即可；
3 常量不需要在模版里使用的不要放在data里面
4 尽量不要用深嵌套组件，可以通过在一个组件引入外部js来解决内容过多的问题
5 不需要在模版里面使用的数据不要放在data里面，可以放在export default {} 以外
6 获取一些系统数据的操作不要多次调用，初次调用后可放在globalData中
7 巧妙globalData来解决小程序页面数据通信（不可滥用）